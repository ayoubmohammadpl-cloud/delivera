<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙˆØµÙŠÙ„ â€” ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚</title>

<!-- Firebase (compat) -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
    :root{--primary:#4285F4;--card-bg:#fff;--muted:#666;}
    body {
        font-family: Arial, sans-serif;
        direction: rtl;
        padding: 20px;
        background: #f3f6fb;
        color:#222;
        margin: 0;
    }
    /* ÙˆØ¶Ø¹ Ø§Ù„Ø³Ø§Ø¦Ù‚: Ù„Ø§ Scroll ÙˆÙ„Ø§ Padding */
    body.driver-mode {
        padding: 0;
        overflow: hidden;
    }
body.driver-mode .auth-lang-switcher {
    display: none !important;
}

    h2 { text-align: center; margin-bottom: 10px; }
    .tabs { display: flex; justify-content: center; gap:10px; margin-bottom: 20px; }
    .tab { padding: 10px 18px; border-radius: 8px; cursor: pointer; background: #e6eefc; color: #124; }
    .tab.active { background: var(--primary); color: #fff; box-shadow: 0 2px 8px rgba(66,133,244,0.3); }
    .card { background: var(--card-bg); border-radius: 10px; padding: 14px; box-shadow: 0 1px 4px rgba(0,0,0,0.06); margin-bottom: 12px; }
    form { max-width: 520px; margin: 0 auto 10px; padding: 16px; border-radius: 10px; background: #fff; box-shadow: 0 1px 6px rgba(0,0,0,0.04); }
    input, select, button, textarea { width: 100%; padding: 10px; margin: 8px 0; border-radius: 8px; border: 1px solid #ddd; box-sizing: border-box; }
    button { background: var(--primary); color: #fff; border: none; cursor: pointer; }
    button.secondary { background: #fff; color: var(--primary); border: 1px solid #cde; }
	/* Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø© (Ø¯Ø±ÙˆØ¨ Ø¯Ø§ÙˆÙ† Ù…Ø¹ ØµÙˆØ±Ø©) */
.vehicle-select {
    margin: 8px 0;
    position: relative;
}

.vehicle-select-label {
    font-size: 13px;
    color: #444;
    margin-bottom: 4px;
    display: block;
}

.vehicle-select-display {
    width: 100%;
    border-radius: 8px;
    border: 1px solid #ddd;
    background: #fff;
    padding: 8px 10px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
    cursor: pointer;
}

.vehicle-select-display-left {
    display: flex;
    align-items: center;
    gap: 8px;
}

.vehicle-select-icon {
    width: 30px;
    height: 30px;
    border-radius: 999px;
    background-size: contain;
    background-position: center;
    background-repeat: no-repeat;
    background-color: #f5f7ff;
    flex-shrink: 0;
}

.vehicle-select-placeholder {
    color: #999;
}

.vehicle-select-arrow {
    font-size: 10px;
    opacity: 0.7;
}

.vehicle-select-options {
    position: absolute;
    z-index: 10;
    top: 100%;
    inset-inline: 0;
    margin-top: 4px;
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 4px 14px rgba(0,0,0,0.12);
    max-height: 220px;
    overflow-y: auto;
}

.vehicle-option {
    padding: 8px 10px;
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
}

.vehicle-option:hover {
    background: #f3f6fb;
}

.vehicle-option-img {
    width: 32px;
    height: 32px;
    object-fit: contain;
    border-radius: 999px;
    background: #f5f7ff;
}

    .hidden { display:none; }
    .small { font-size:13px; color:var(--muted); }
    .btn-row { display:flex; gap:8px; flex-wrap:wrap; margin-top:10px; }
.auth-lang-switcher {
    display: flex;
    justify-content: center;
    margin-bottom: 8px;
}

.auth-lang-switcher select {
    padding: 4px 10px;
    border-radius: 999px;
    border: 1px solid #ddd;
    font-size: 12px;
    background: #f5f7ff;
}

    .orders-list {
        max-height: 260px;
        overflow:auto;
        padding:10px;
        background:#fff;
        border-radius:10px;
        /* Ø¥Ø®ÙØ§Ø¡ Ø³ÙƒØ±ÙˆÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø¯Ø§Ø®Ù„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© */
        -ms-overflow-style: none;   /* IE Ùˆ Edge */
        scrollbar-width: none;      /* Firefox */
    }
    .orders-list::-webkit-scrollbar {
        width: 0;
        height: 0;
    }

    .order-card { border:1px solid #eef; padding:10px; margin-bottom:8px; border-radius:8px; cursor:pointer; }
    .order-card:hover { box-shadow: 0 2px 8px rgba(0,0,0,0.06); }
    .order-card-current {
        border-color: #22c55e;
        box-shadow: 0 0 0 0 rgba(34,197,94,0.7);
        animation: driverActiveOrderPulse 1.2s ease-out infinite;
    }

    @keyframes driverActiveOrderPulse {
        0%   { box-shadow: 0 0 0 0   rgba(34,197,94,0.7); }
        70%  { box-shadow: 0 0 0 8px rgba(34,197,94,0); }
        100% { box-shadow: 0 0 0 0   rgba(34,197,94,0); }
    }

    /* modal */
    .modal-backdrop { position:fixed; inset:0; background:rgba(0,0,0,0.45); display:flex; align-items:center; justify-content:center; z-index:9999; }
    .modal { width:90%; max-width:520px; background:#fff; padding:18px; border-radius:12px; }
    .flex-between { display:flex; justify-content:space-between; align-items:center; }
    footer { text-align:center; margin-top:24px; color:#666; font-size:13px; }

    /* === ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚ â€” Ù†Ù…Ø· Ø£ÙˆØ¨Ø± === */
    #driverDashboard {
        position: relative;
        max-width: 100%;
        margin: 0;
        padding: 0;
        background: transparent;
        box-shadow: none;
        border-radius: 0;
    }

    /* Ø®Ø±ÙŠØ·Ø© ØªÙ…Ù„Ø£ Ø§Ù„Ø´Ø§Ø´Ø© */
    .driver-map {
        position: fixed;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        z-index: 0;
        background: #d0d8e0;
    }

    /* Ø²Ø± Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ (Ø£Ø³ÙÙ„ ÙŠÙ…ÙŠÙ†) */
    /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…ØªØ¬Ø± + Ø§Ù„Ø¹Ù…ÙŠÙ„: Ø¨Ø¯ÙˆÙ† Ø¯Ø§Ø¦Ø±Ø© Ø³ÙˆØ¯Ø§Ø¡ */
.driver-nav-btn,
.driver-search-btn {
    position: fixed;
    right: 15px;
    z-index: 3;
    border: none;
    background: transparent;   /* ğŸ”´ Ù„Ø§ Ø®Ù„ÙÙŠØ© */
    box-shadow: none;          /* ğŸ”´ Ø¨Ø¯ÙˆÙ† Ø¸Ù„ */
    padding: 0;
    width: auto;
    height: auto;
    cursor: pointer;
}

/* Ù…ÙƒØ§Ù† ÙƒÙ„ ÙˆØ§Ø­Ø¯ ÙÙ‚Ø· */
.driver-nav-btn {
    bottom: 90px;
}

.driver-search-btn {
    bottom: 144px;
}

        /* Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù…ØªØ¬Ø± */
.driver-nav-btn .driver-nav-icon {
    width: 60px;                 /* ØªÙ‚Ø¯Ø± ØªØ²Ø¨Ø·Ù‡Ø§ 28 / 30 Ø­Ø³Ø¨ Ø°ÙˆÙ‚Ùƒ */
    height: 60px;
    border-radius: 0;            /* Ù„Ø§ Ø¯Ø§Ø¦Ø±Ø© Ø¯Ø§Ø®Ù„ÙŠØ© */
    background-color: transparent; /* ğŸ”´ Ù„Ø§ Ø®Ù„ÙÙŠØ© Ø¨ÙŠØ¶Ø§ */
    background-image: url("navigation.png");  /* Ø§Ø³Ù… Ù…Ù„Ù Ø§Ù„Ù…ØªØ¬Ø± */
    background-size: contain;    /* Ø£Ùˆ cover Ù„Ùˆ Ø­Ø§Ø¨ ØªÙ…Ù„Ø§Ù‡Ø§ Ø£ÙƒØ«Ø± */
    background-position: center;
    background-repeat: no-repeat;
}

    .driver-top-bar {
    position: fixed;
    top: 25px;
    right: 12px;
    left: 12px;
    z-index: 2;
    background: rgba(0,0,0,0.7);
    backdrop-filter: blur(10px);
    border-radius: 999px;
    padding: 8px 14px;
    color: #fff;

    /* âœ… Ø«Ø¨Ø§Øª Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø´Ø±ÙŠØ· */
    min-height: 48px;   /* Ø¬Ø±Ù‘Ø¨ 50 Ø£Ùˆ 52 Ù„Ùˆ Ø­Ø§Ø¨Ø¨ Ø£Ø³Ù…Ùƒ Ø´ÙˆÙŠ */
}

/* Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø«Ù„Ø§Ø«Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„Ø´Ø±ÙŠØ· ÙŠØªÙ… ØªØ«Ø¨ÙŠØªÙ‡Ø§ Ø¨Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙŠØ¯ÙˆÙŠØ§Ù‹ */
.driver-top-right,
.driver-top-center,
.driver-top-left {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    display: flex;
    align-items: center;
}

/* ğŸ”¹ Ø²Ø± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©: Ø¯Ø§Ø¦Ù…Ø§Ù‹ ÙÙŠ Ø£Ù‚ØµÙ‰ Ø§Ù„ÙŠÙ…ÙŠÙ† */
.driver-top-right {
    right: 14px;
}

/* ğŸ”¹ ÙƒØ±Øª Ø§Ù„Ø£Ø±Ø¨Ø§Ø­: Ø¯Ø§Ø¦Ù…Ø§Ù‹ ÙÙŠ Ø£Ù‚ØµÙ‰ Ø§Ù„ÙŠØ³Ø§Ø± */
.driver-top-left {
    left: 14px;
}

/* ğŸ”¹ Ø²Ø± Ø§Ù„Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†/Ø£ÙˆÙÙ„Ø§ÙŠÙ†: ÙÙŠ Ù…Ù†ØªØµÙ Ø§Ù„Ø´Ø±ÙŠØ· ØªÙ…Ø§Ù…Ø§Ù‹ */
.driver-top-center {
    left: 50%;
    transform: translate(-50%, -50%);
}

    .driver-top-info {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .driver-name {
        font-weight: 700;
        font-size: 14px;
        max-width: 180px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .driver-icon-btn {
        border: none;
        background: transparent;
        color: inherit;
        font-size: 18px;
        cursor: pointer;
        padding: 4px 6px;
    }
/* ØªÙƒØ¨ÙŠØ± Ø²Ø± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© ÙÙ‚Ø· */
#driverMenuBtn {
    font-size: 30px;         /* ØªÙƒØ¨ÙŠØ± Ø±Ù…Ø² â˜° */
    padding: 8px 12px;       /* ØªÙƒØ¨ÙŠØ± Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø¶ØºØ· */
    /* Ù„Ùˆ Ø­Ø§Ø¨ ØªØµÙŠØ± Ø¯Ø§Ø¦Ø±ÙŠØ© Ø£ÙƒØ«Ø±: */
    border-radius: 999px;
}

    .driver-toggle-btn {
    border: none;
    border-radius: 999px;        /* Ø¨ÙŠØ¶Ø§ÙˆÙŠ / Ø¯Ø§Ø¦Ø±ÙŠ */
    padding: 8px 18px;
    font-size: 13px;
    cursor: pointer;
    background: #6c757d;
    color: #fff;

    /* Ø§Ù„Ø£Ù‡Ù…: Ø¹Ø¯Ù… Ø§Ù„ØªÙ…Ø¯Ø¯ Ø¹Ù„Ù‰ Ø¹Ø±Ø¶ Ø§Ù„Ø´Ø±ÙŠØ· */
    width: auto;
    min-width: 120px;
    max-width: 200px;

    text-align: center;
    display: inline-flex;
    align-items: center;
    justify-content: center;
}
/* ÙˆÙ…ÙŠØ¶ Ø²Ø± Ø§Ù„Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† Ø£Ø«Ù†Ø§Ø¡ Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ */
.driver-toggle-btn.blink {
    animation: driverOnlineBlink 0.8s linear infinite;
}

@keyframes driverOnlineBlink {
    0%, 100% { opacity: 1; }
    50%      { opacity: 0.4; }
}

    /* ÙƒØ¨Ø³ÙˆÙ„Ø© Ø§Ù„Ø­Ø§Ù„Ø© ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„ */
    .driver-bottom-status {
        position: fixed;
        bottom: 18px;
        right: 50%;
        transform: translateX(50%);
        z-index: 2;
        background: rgba(0,0,0,0.8);
        color: #fff;
        padding: 10px 18px;
        border-radius: 999px;
        font-size: 13px;
        box-shadow: 0 6px 18px rgba(0,0,0,0.35);
        max-width: 90%;
        text-align: center;
    }

    /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© */
    .driver-side-panel {
        position: fixed;
        top: 0;
        bottom: 0;
        right: 0;
        width: 340px;
        max-width: 90%;
        background: #ffffff;
        box-shadow: -4px 0 18px rgba(0,0,0,0.25);
        z-index: 3;
        transform: translateX(100%);
        transition: transform 0.25s ease-out;
        display: flex;
        flex-direction: column;
        padding: 16px 14px 18px;

        /* Ø³Ø­Ø¨ Ø¨Ø¯ÙˆÙ† Ø¸Ù‡ÙˆØ± Ø³ÙƒØ±ÙˆÙ„ */
        overflow-y: auto;
        -ms-overflow-style: none;   /* IE Ùˆ Edge */
        scrollbar-width: none;      /* Firefox */
    }
    .driver-side-panel::-webkit-scrollbar {
        width: 0;
        height: 0;
    }

    .driver-side-panel.open {
        transform: translateX(0);
    }

    .driver-side-backdrop {
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.35);
        z-index: 2;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.2s ease-out;
    }

    .driver-side-backdrop.show {
        opacity: 1;
        pointer-events: auto;
    }

    .driver-side-header {
        display: flex;
        justify-content:space-between;
        align-items:center;
        margin-bottom: 8px;
    }

    .driver-side-title {
        font-weight: 700;
    }
.driver-side-header-main {
    display: flex;
    flex-direction: column;      /* ğŸ” ØµØ§Ø± Ø¹Ù…ÙˆØ¯ÙŠ: Ø¹Ù†ÙˆØ§Ù† + Ø§Ø³Ù… + Ù„ØºØ© */
    align-items: flex-start;
    gap: 4px;
}

.driver-lang-controls {
    margin-top: 4px;
}

.driver-lang-controls select {
    padding: 4px 10px;
    border-radius: 999px;
    border: 1px solid #ddd;
    font-size: 12px;
    background: #f5f7ff;
}

.driver-side-driver-name {
    font-size: 13px;
    color: #444;
    margin-top: 0;
    white-space: nowrap;      /* Ù…Ù†Ø¹ Ù†Ø²ÙˆÙ„ Ø§Ù„Ø§Ø³Ù… Ù„Ø³Ø·Ø±ÙŠÙ† */
}
.driver-side-name-row {
    display: flex;
    align-items: center;
    gap: 8px;
}

.driver-vehicle-icon {
    width: 30px;   /* Ù†ÙØ³ Ø­Ø¬Ù… Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø¯Ø±ÙˆØ¨Ø¯Ø§ÙˆÙ† ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹ */
    height: 30px;
    border-radius: 999px;
    background-color: #f5f7ff;
    background-size: contain;
    background-position: center;
    background-repeat: no-repeat;
    flex-shrink: 0;
    border: 1px solid #dde3f0; /* Ø¥Ø·Ø§Ø± Ù†Ø§Ø¹Ù… ÙŠØ¶Ù…Ù† Ø§Ø­ØªÙˆØ§Ø¡ Ø§Ù„ØµÙˆØ±Ø© Ø¯Ø§Ø®Ù„Ù‡ */
}

    .driver-side-section {
        margin-top: 12px;
    }

    .driver-side-stats {
        display: flex;
        gap: 8px;
    }

    .driver-side-stats .stat {
        flex: 1;
    }

    .driver-side-card {
        margin-top: 6px;
    }

    .driver-side-link {
        width: 100%;
        text-align: right;
        margin-top: 6px;
        border-radius: 8px;
        padding: 10px 12px;
        background: #f3f6fb;
        border: 1px solid #e0e7ff;
        color: #124;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .driver-side-link.driver-side-danger {
        border-color: #f4c2c2;
        background: #fff5f5;
        color: #b00020;
    }

    .driver-side-pane {
        display: none;
        margin-top: 6px;
    }
    .driver-side-pane.open {
        display: block;
    }

    .driver-section-toggle span {
        font-size: 13px;
    }
    .driver-section-toggle::after {
        content: "â–¾";
        font-size: 11px;
    }
    .driver-section-toggle.open::after {
        content: "â–´";
    }

    /* ÙƒØ±Øª Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ù†Ø´Ø· Ø§Ù„Ø¹Ø§Ø¦Ù… (Bottom Sheet) */
.driver-current-order {
    position: fixed;
    right: 12px;
    left: 12px;
    bottom: 16px; /* Ø£Ù‚Ø±Ø¨ Ù„Ø­Ø§ÙØ© Ø§Ù„Ø´Ø§Ø´Ø© */
    z-index: 2;
    background:#fff;
    border-radius:16px;
    box-shadow:0 8px 24px rgba(0,0,0,0.35);
    padding:10px 12px;
    font-size:13px;
    transition: transform 0.25s ease-out, right 0.25s ease-out, left 0.25s ease-out, padding 0.25s ease-out;
}
.driver-current-order-header {
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:4px;
}

/* Ù†Øµ Ø§Ù„Ù‡ÙŠØ¯Ø± (Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ + Ø§Ù„Ø­Ø§Ù„Ø©) */
.driver-current-order-header-text {
    display:flex;
    flex-direction:column;
    gap:2px;
}

/* Ø²Ø± Ø§Ù„Ø³Ù‡Ù… Ù„Ø·ÙŠ/Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© */
.driver-current-order-toggle {
    border:none;
    background:transparent;
    cursor:pointer;
    font-size:30px;
    line-height:1;
    padding:2px 4px;
    color: #353640;   /* âœ… Ù„ÙˆÙ† Ø§Ù„Ø³Ù‡Ù… */
}

/* Ø¬Ø³Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© */
.driver-current-order-body {
    margin-top:4px;
}

/* ÙˆØ¶Ø¹ Ù…ØµØºÙ‘Ø±: ÙÙ‚Ø· Ø³Ù‡Ù… ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„ Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© */
.driver-current-order.collapsed {
    right: 50%;
    left: auto;
    transform: translateX(50%);
    padding:6px 8px;
    min-width:56px;
    text-align:center;
}
.driver-current-order.collapsed .driver-current-order-header-text,
.driver-current-order.collapsed .driver-current-order-body {
    display:none;
}

    /* ÙƒØ±Øª Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„Ø¹Ø§Ø¦Ù… â€” Ø§Ù„Ø¢Ù† Ø¯Ø§Ø®Ù„ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ Ù…Ù† Ø§Ù„ÙŠØ³Ø§Ø± */
.driver-earnings-floating {
    background: rgba(0,0,0,0.7);
    color:#fff;
    padding:6px 10px;
    border-radius:999px;
    font-size:16px;
    text-align:center;
    box-shadow:0 4px 12px rgba(0,0,0,0.35);
    min-width:80px;
    line-height:1.3;
}
.driver-earnings-floating strong {
    display:block;
    font-size:16px;
}
    /* Ø²Ø± Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„ (Ø£ÙŠÙ‚ÙˆÙ†Ø© Ù…Ø³ØªØ®Ø¯Ù…) ÙÙˆÙ‚ Ø²Ø± Ø§Ù„Ù…ØªØ¬Ø± Ù…Ø¨Ø§Ø´Ø±Ø© */
    /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…ØªØ¬Ø± + Ø§Ù„Ø¹Ù…ÙŠÙ„: Ø¨Ø¯ÙˆÙ† Ø¯Ø§Ø¦Ø±Ø© Ø³ÙˆØ¯Ø§Ø¡ */
.driver-nav-btn,
.driver-search-btn {
    position: fixed;
    right: 15px;
    z-index: 3;
    border: none;
    background: transparent;   /* ğŸ”´ Ù„Ø§ Ø®Ù„ÙÙŠØ© */
    box-shadow: none;          /* ğŸ”´ Ø¨Ø¯ÙˆÙ† Ø¸Ù„ */
    padding: 0;
    width: auto;
    height: auto;
    cursor: pointer;
}

/* Ù…ÙƒØ§Ù† ÙƒÙ„ ÙˆØ§Ø­Ø¯ ÙÙ‚Ø· */
.driver-nav-btn {
    bottom: 90px;
}

.driver-search-btn {
    bottom: 185px;
}
/* Ø²Ø± Ø¥Ø¶Ø§ÙØ© Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ ÙÙˆÙ‚ Ø²Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø¨Ø§Ø´Ø±Ø© */
.driver-extra-order-btn {
    position: fixed;
    right: 15px;    /* Ù†ÙØ³ right Ø­Ù‚ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø£Ø®Ø±Ù‰ */
    bottom: 235px;  /* 185 + 95 => Ù†ÙØ³ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† nav Ùˆ search */
    z-index: 3;
    border: none;
    background: transparent;
    box-shadow: none;
    padding: 0;
    width: auto;
    height: auto;
    cursor: pointer;
}

/* Ù†ÙØ³ Ø­Ø¬Ù… Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØªÙ…Ø§Ù…Ø§Ù‹ */
.driver-extra-order-btn img {
    width: 60px;
    height: 60px;
    display: block;
    object-fit: contain;
}
/* Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„ÙØ±Ø¹ÙŠØ© manual / scan â€” Ù†ÙØ³ Ù†Ù‚Ø·Ø© Ø²Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ© ÙƒØ¨Ø¯Ø§ÙŠØ© */
.driver-extra-child-btn {
    position: fixed;
    right: 15px;     /* Ù†ÙØ³ right */
    bottom: 280px;   /* Ù†ÙØ³ bottom (ÙÙˆÙ‚ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…) */
    z-index: 3;
    border: none;
    background: transparent;
    box-shadow: none;
    padding: 0;
    width: auto;
    height: auto;
    cursor: pointer;

    /* Ù…Ø®ÙÙŠØ© Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ ÙÙˆÙ‚ Ø²Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ© */
    opacity: 0;
    pointer-events: none;
    transform: translate(0, 0);
    transition: transform 0.2s ease, opacity 0.2s ease;
}

/* Ø­Ø¬Ù… Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª manual / scan = 50x50 */
.driver-extra-child-btn img {
    width: 50px;
    height: 50px;
    display: block;
    object-fit: contain;
}

/* Ø¹Ù†Ø¯ Ø§Ù„ÙØªØ­: Ø´ÙƒÙ„ Ù§ Ø¹Ø±Ø¨ÙŠ Ø¨Ø§ØªØ¬Ø§Ù‡ Ø§Ù„ÙŠØ³Ø§Ø± */

/* Ø®Ø· Ø£ÙÙ‚ÙŠ Ù„Ù„ÙŠØ³Ø§Ø± (Ù…Ø«Ù„Ø§Ù‹ manual) */
body.driver-extra-open #driverExtraManualBtn {
    opacity: 1;
    pointer-events: auto;
    transform: translate(-100px, 0);      /* ÙŠØ³Ø§Ø± ÙÙ‚Ø· */
}

/* Ù†Ø²ÙˆÙ„ ØªØ­Øª Ù‡Ø°Ø§ Ø§Ù„Ø®Ø· (scan) Ù„Ø¹Ù…Ù„ Ø´ÙƒÙ„ Ù§ */
body.driver-extra-open #driverExtraScanBtn {
    opacity: 1;
    pointer-events: auto;
    transform: translate(-100px, 100px);   /* ØªØ­Øª manual Ù…Ø¹ Ù†ÙØ³ Ø§Ù„Ø¥Ø²Ø§Ø­Ø© Ù„Ù„ÙŠØ³Ø§Ø± */
}

/* Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… */
.driver-search-icon {
    position: fixed;          /* Ø£Ùˆ absolute Ù„Ùˆ Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø£Ø²Ø±Ø§Ø± absolute */
    right: 15px;              /* Ù†ÙØ³ right Ù„Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø£Ø®Ø±Ù‰ */
    bottom: 170px;            /* Ù‡Ù†Ø§ ØªØªØ­ÙƒÙ… Ø¨Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© ÙÙˆÙ‚ Ø§Ù„Ø£Ø³ÙÙ„ */

    width: 60px;
    height: 60px;
    border-radius: 0;

    background-color: transparent;      /* Ù„Ø§ Ø®Ù„ÙÙŠØ© Ø¨ÙŠØ¶Ø§Ø¡ */
    background-image: url("kunde.png"); /* Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„ */
    background-size: contain;
    background-position: center;
    background-repeat: no-repeat;

    z-index: 1000;            /* Ù„ØªØ¸Ù‡Ø± ÙÙˆÙ‚ Ø§Ù„Ø®Ø±ÙŠØ·Ø© ÙˆØ§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø£Ø®Ø±Ù‰ */
}

    /* Ù„ÙˆØ­Ø© Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„ */
    .driver-address-panel {
        position: fixed;
        top: 100px;           /* ØªØ­Øª Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹ */
        right: 12px;
        left: 12px;
        z-index: 3;
        background: rgba(0,0,0,0.75);
        backdrop-filter: blur(10px);
        padding: 10px 12px;
        border-radius: 12px;
        color:#fff;
    }
/* Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙŠØ¯ÙˆÙŠ Ù„Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ */
.driver-extra-manual-panel {
  position: fixed;
  inset: 0;
  z-index: 8; /* ÙÙˆÙ‚ Ø§Ù„Ø®Ø±ÙŠØ·Ø© ÙˆØ§Ù„Ø£Ø²Ø±Ø§Ø± */
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(0, 0, 0, 0.45);
}

.driver-extra-manual-panel.hidden {
  display: none;
}

.driver-extra-manual-inner {
  background: #ffffff;
  border-radius: 14px;
  padding: 14px 16px;
  width: 90%;
  max-width: 360px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
  box-sizing: border-box;
}

/* ØµÙ Ø§Ù„Ø³Ø¹Ø± + Ø²Ø± Ø§Ù„ÙƒØ§Ø´ */
.driver-extra-price-row {
  display: flex;
  align-items: center;
  gap: 8px;
  width: 100%;
}

/* Ø­Ù‚Ù„ Ø§Ù„Ø³Ø¹Ø±: ÙŠØ£Ø®Ø° Ø§Ù„Ø¨Ø§Ù‚ÙŠ (Ø­ÙˆØ§Ù„ÙŠ 75%) */
#driverExtraPriceInput {
  flex: 1 1 0;
  min-width: 0;                 /* Ù…Ù‡Ù… Ø­ØªÙ‰ ÙŠÙØ³Ù…Ø­ Ù„Ù‡ Ø¨Ø§Ù„Ø§Ù†ÙƒÙ…Ø§Ø´ */
  margin: 0;
  border-radius: 999px;
  border: 1px solid #ddd;
  padding-inline: 12px;
  box-sizing: border-box;
}
/* Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ Ù„Ø­Ù‚Ù„ Ø§Ù„Ø³Ø¹Ø± */
#driverExtraPriceInput.driver-extra-price-error {
  border-color: #dc2626;
  color: #dc2626;
}

/* Ù„ÙˆÙ† Ø§Ù„Ù€ placeholder ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ */
#driverExtraPriceInput.driver-extra-price-error::placeholder {
  color: #dc2626;
}

/* Ø²Ø± Ø§Ù„ÙƒØ§Ø´: Ø£Ø³Ø§Ø³Ø§Ù‹ 25% Ù…Ù† Ø§Ù„ØµÙØŒ Ù…Ø¹ Ø­Ø¯ Ø£Ù‚ØµÙ‰ Ø­ØªÙ‰ Ù„Ø§ ÙŠÙƒØ³Ø± Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚ */
.driver-extra-cash-btn {
  flex: 0 1 25%;                /* Ø£Ø³Ø§Ø³ 25%ØŒ ÙˆÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙ†ÙƒÙ…Ø´ Ù‚Ù„ÙŠÙ„Ø§Ù‹ */
  max-width: 35%;               /* Ù„Ù† ÙŠØªØ¬Ø§ÙˆØ² ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹ Ø«Ù„Ø« Ø§Ù„ØµÙ */
  min-width: 70px;              /* Ù„Ø§ ÙŠØµØ¨Ø­ ØµØºÙŠØ±Ø§Ù‹ Ø¬Ø¯Ø§Ù‹ */
  padding: 9px 10px;
  border-radius: 999px;
  border: 1px solid #ddd;
  background: #ffffff;
  color: #333;
  font-size: 13px;
  cursor: pointer;
  box-sizing: border-box;

  /* Ø§Ø­ØªÙˆØ§Ø¡ Ø§Ù„Ù†Øµ Ø¨Ø¯ÙˆÙ† Ø®Ø±ÙˆØ¬ */
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.driver-extra-cash-btn.cash-on {
  background: #dc2626;
  border-color: #b91c1c;
  color: #ffffff;
}

/* Ø²Ø± ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ø¶Ø§ÙØ© */
.driver-extra-confirm-btn {
  width: 100%;
  margin-top: 10px;
  border-radius: 999px;
  padding: 10px 0;
  font-size: 14px;
}
/* Ø²Ø± Ù…Ø¨Ø¯Ù‘Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø© (ÙÙˆÙ‚ Ø²Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ©) */
.driver-active-switcher-btn {
  position: fixed;          /* Ø£Ùˆ absolute Ù„Ùˆ Ø£Ù†Øª ØªØ³ØªØ®Ø¯Ù… Ø­Ø§ÙˆÙŠØ© Ù†Ø³Ø¨ÙŠØ© */
  right: 10px;              /* Ø¹Ø¯Ù‘Ù„ Ø­Ø³Ø¨ Ù…ÙƒØ§Ù† Ø²Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ© */
  bottom: 300px;            /* ÙŠÙƒÙˆÙ† ÙÙˆÙ‚ Ø²Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù…Ø«Ù„Ø§Ù‹ */
  width: 80px;
  height: 80px;
  border-radius: 50%;
  border: none;
  padding: 0;
  background: transparent;
  cursor: pointer;
  z-index: 1200;
  display: flex;
  align-items: center;
  justify-content: center;
}

.driver-active-switcher-btn img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-radius: 50%;
}

/* Ø´Ø§Ø±Ø© Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª */
.driver-active-switcher-badge {
  position: absolute;
  top: -4px;
  right: 22px;
  min-width: 18px;
  height: 26px;
  padding: 0 4px;
  border-radius: 999px;
   background: rgba(220, 53, 69, 0.75); /* ğŸ”´  Ø§Ù„Ø£Ø­Ù…Ø± Ù…Ø¹ Ø´ÙØ§ÙÙŠØ© 85% */
  color: #fff;
  font-size: 11px;
  line-height: 18px;
  text-align: center;
  box-shadow: 0 0 0 1px #fff;
}

/* Ø¨Ø·Ø§Ù‚Ø§Øª Ù…Ù†Ø¨Ø«Ù‚ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø­Ø§Ù„ÙŠ */
.active-switcher-list {
  margin-top: 10px;
  max-height: 70vh;
  overflow-y: auto;
}

.active-switcher-card {
  padding: 8px 10px;
  border-radius: 8px;
  border: 1px solid #ddd;
  margin-bottom: 6px;
  cursor: pointer;
  background: #fff;
 
}

.active-switcher-card-current {
  border-color: #28a745;
  box-shadow: 0 0 8px rgba(40, 167, 69, 0.7);
}

.active-switcher-card-cash {
  background: rgba(255, 243, 205, 0.8); /* ØªÙ…ÙŠÙŠØ² ÙƒØ§Ø´ Ø®ÙÙŠÙ */
}

.active-switcher-card .asc-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.active-switcher-card .asc-status {
  font-size: 11px;
  opacity: 0.8;
}

	/* ====== Google Places Autocomplete (Ø§Ù‚ØªØ±Ø§Ø­ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†) ====== */
.pac-container {
    /* ÙŠØ®Ù„ÙŠÙ‡ ÙÙˆÙ‚ ÙƒÙ„ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ùˆ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© */
    z-index: 9999 !important;

    /* ØªÙƒØ¨ÙŠØ± Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ùˆ Ø¬Ø¹Ù„Ù‡ Ø£ÙˆØ¶Ø­ */
    border-radius: 12px !important;
    box-shadow: 0 8px 24px rgba(0,0,0,0.35);
    border: none !important;
    padding: 4px 0;
    font-size: 14px;

    /* Ø®Ù„ÙÙŠØ© Ø¨ÙŠØ¶Ø§ Ù†Ø§Ø¹Ù…Ø© */
    background-color: #ffffff;
}

/* ÙƒÙ„ Ø¹Ù†ØµØ± (Ø¹Ù†ÙˆØ§Ù†) Ø¯Ø§Ø®Ù„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© */
.pac-item {
    padding: 10px 14px;
    line-height: 1.4;
    font-size: 14px;
    cursor: pointer;
}

/* Ù†Øµ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ø¯Ø§Ø®Ù„ ÙƒÙ„ Ø¹Ù†ØµØ± */
.pac-item .pac-item-query {
    font-size: 15px;
    font-weight: 600;
}

/* Ù„Ù…Ø§ ÙŠÙ…Ø±Ù‘ Ø§Ù„Ø³Ø§Ø¦Ù‚ Ø¨Ø§Ù„Ù…Ø¤Ø´Ø± Ø£Ùˆ ÙŠØ®ØªØ§Ø± Ø§Ù„Ø¹Ù†ØµØ± */
.pac-item:hover {
    background-color: #f2f7ff;
}

/* Ù„Ùˆ Ø­Ø§Ø¨ ØªØ¯Ø¹Ù… ØªØ¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø·Ø± Ø¨Ø´ÙƒÙ„ Ø£Ø¬Ù…Ù„ */
.pac-item {
    white-space: normal;
}

    .driver-address-input-wrapper {
        display:flex;
        align-items:center;
        gap:6px;
    }
    .driver-address-input-wrapper input {
        margin:0;
        flex:1;
        border-radius: 999px;
        border:none;
        padding-inline:12px;
    }
    .driver-address-go-btn {
        width:auto;
        flex:0 0 auto;
        padding:8px 12px;
        border-radius:999px;
        border:none;
        background:#4285F4;
        color:#fff;
        font-size:13px;
        cursor:pointer;
        white-space:nowrap;
    }
    /* Ù…Ù†Ø¨Ø«Ù‚ Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ø³Ø§Ø¦Ù‚ */
    .driver-approval-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.65);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
    }
.driver-approval-overlay.hidden {
    display: none !important;
}

    .driver-approval-modal {
        background: #ffffff;
        border-radius: 18px;
        padding: 20px 18px 18px;
        width: 90%;
        max-width: 420px;
        text-align: center;
        box-shadow: 0 10px 30px rgba(0,0,0,0.35);
    }

    .driver-approval-modal h3 {
        margin: 0 0 8px;
        font-size: 18px;
    }

    .driver-approval-modal p {
        margin: 0 0 14px;
        font-size: 14px;
        color: #444;
        line-height: 1.5;
    }

    .driver-approval-start-btn {
        width: 100%;
        border-radius: 999px;
        padding: 10px 0;
        border: none;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        background: #22c55e;
        color: #fff;
        box-shadow: 0 4px 12px rgba(34,197,94,0.35);
    }
/* ÙƒØ±Øª Ø·Ù„Ø¨ ÙƒØ§Ø´: Ø¥Ø·Ø§Ø± Ø£Ø­Ù…Ø± + ØªÙˆÙ‡Ø¬ */
.order-card-cash {
  border: 2px solid #ff3b30;
  box-shadow: 0 0 10px rgba(255, 59, 48, 0.8);
}

/* Ø§Ù„ÙƒØ±Øª Ø§Ù„Ø³ÙÙ„ÙŠ (Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ù†Ø´Ø·) Ø¹Ù†Ø¯ Ø§Ù„ÙƒØ§Ø´ */
.driver-current-order.cash-current-order {
  border: 2px solid #ff3b30;
  box-shadow: 0 0 12px rgba(255, 59, 48, 0.9);
}

/* ØªÙ…ÙŠÙŠØ² Ù…Ø¨Ù„Øº Ø§Ù„ÙƒØ§Ø´ / Ø§Ù„Ø³Ø¹Ø± */
.cash-amount-highlight {
  
  font-weight: 700;
}

    .pricing-info-link {
  margin-top: 6px;
}

.link-button {
  background: none;
  border: none;
  padding: 0;
  color: #007bff;
  text-decoration: underline;
  cursor: pointer;
}
.cash-floating-badge {
  position: absolute;
  top: 140px;
  left: 10px;
  z-index: 6;                  /* Ø£Ø¹Ù„Ù‰ Ù…Ù† Ø§Ù„Ø®Ø±ÙŠØ·Ø©ØŒ ÙˆØ£Ù‚Ù„ Ø£Ùˆ Ù…Ø³Ø§ÙˆÙŠ Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø£Ø®Ø±Ù‰ */
  min-width: 64px;
  min-height: 64px;
  padding: 8px;
  border-radius: 999px;        /* Ø¯Ø§Ø¦Ø±Ø© */
  background: #cc0000;         /* Ø®Ù„ÙÙŠØ© Ø­Ù…Ø±Ø§Ø¡ */
  color: #ffffff;              /* Ù†Øµ Ø£Ø¨ÙŠØ¶ */
  font-weight: 700;
  font-size: 14px;
  box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.6);
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  pointer-events: none;    /* Ù„Ø§ ÙŠØ¹Ø·Ù„ ØªÙØ§Ø¹Ù„ Ø§Ù„Ø®Ø±ÙŠØ·Ø© */
  background: rgba(255, 255, 255, 0.5);

}

.cash-floating-badge.hidden {
  display: none;
}

.cash-floating-badge-inner {
  position: relative;
  z-index: 2;
}

/* ÙˆÙ…ÙŠØ¶ Ø£Ø­Ù…Ø± Ù…Ù†ØªØ´Ø± Ø®Ù„Ù Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø¯Ø§Ø¦Ø±ÙŠ */
.cash-floating-badge::before {
  content: "";
  position: absolute;
  inset: 0;
  border-radius: inherit;
  box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.9);
  animation: cashPulse 1.4s infinite;
  z-index: 1;
}

@keyframes cashPulse {
  0% {
    transform: scale(1);
    opacity: 0.7;
    box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.9);
  }
  70% {
    transform: scale(1.28);
    opacity: 0;
    box-shadow: 0 0 0 16px rgba(220, 38, 38, 0);
  }
  100% {
    transform: scale(1);
    opacity: 0;
    box-shadow: 0 0 0 0 rgba(220, 38, 38, 0);
  }
}

</style>
</head>
<body>

<h2 id="mainHeader">Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙˆØµÙŠÙ„ â€” ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚</h2>
<!-- ğŸ”¤ Ø³ÙˆÙŠØªØ´Ø± Ø§Ù„Ù„ØºØ© ÙÙŠ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ -->
<div class="auth-lang-switcher">
    <select id="authLangSelect">
        <option value="en">English</option>
    <option value="de">Deutsch</option>
    <option value="tr">TÃ¼rkÃ§e</option>
    <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
    </select>
</div>
<!-- Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª -->
<div class="tabs" id="authTabs">
    <div class="tab active" id="registerTab">ØªØ³Ø¬ÙŠÙ„</div>
    <div class="tab" id="loginTab">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</div>
</div>

<!-- SECTION: Register (Ø³Ø§Ø¦Ù‚ ÙÙ‚Ø·) -->
<div id="registerSection" class="card">
    <form id="driverForm" autocomplete="off">
        <h3>ØªØ³Ø¬ÙŠÙ„ Ø³Ø§Ø¦Ù‚</h3>
        <input type="text" id="firstName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„" required />
        <input type="text" id="lastName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ø§Ù†ÙŠ" required />
        <input type="text" id="address" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†" required />
<input type="text" id="city" placeholder="Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©" required />
<!-- Ù†ÙˆØ¹ Ø§Ù„Ø³Ø§Ø¦Ù‚ -->
<div class="driver-type-select">
  <label id="driverTypeLabel">Ù†ÙˆØ¹ Ø§Ù„Ø³Ø§Ø¦Ù‚</label>
  <select id="driverType" required>
    <option value="" id="driverTypePlaceholder" selected disabled>
      Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø³Ø§Ø¦Ù‚
    </option>
    <option value="independent" id="driverTypeOptionIndependent">
      Ø³Ø§Ø¦Ù‚ Ù…Ø³ØªÙ‚Ù„
    </option>
    <option value="employee" id="driverTypeOptionEmployee">
      Ø³Ø§Ø¦Ù‚ Ù…ÙˆØ¸Ù Ù„Ø¯Ù‰ Taussil
    </option>
  </select>
</div>

<!-- Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø© -->
<div class="vehicle-select">
  <label id="vehicleTypeLabel" class="vehicle-select-label">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©</label>

  <button type="button" id="vehicleSelectToggle" class="vehicle-select-display">
    <div class="vehicle-select-display-left">
      <div id="vehicleSelectIcon" class="vehicle-select-icon"></div>
      <span id="vehicleSelectText" class="vehicle-select-placeholder">
        Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©
      </span>
    </div>
    <span class="vehicle-select-arrow">â–¾</span>
  </button>

  <div id="vehicleSelectOptions" class="vehicle-select-options hidden">
    <div class="vehicle-option" data-value="car">
      <!-- ØºÙŠÙ‘Ø± car.png Ù„Ø§Ø³Ù… ØµÙˆØ±Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø¹Ù†Ø¯Ùƒ -->
      <img src="car.png" alt="" class="vehicle-option-img" />
      <span id="vehicleOptionCarText">Ø³ÙŠØ§Ø±Ø©</span>
    </div>
    <div class="vehicle-option" data-value="motorcycle">
      <!-- ØºÙŠÙ‘Ø± motorcycle.png Ù„Ø§Ø³Ù… ØµÙˆØ±Ø© Ø§Ù„Ø¯Ø±Ø§Ø¬Ø© Ø§Ù„Ù†Ø§Ø±ÙŠØ© -->
      <img src="motorcycle.png" alt="" class="vehicle-option-img" />
      <span id="vehicleOptionMotorcycleText">Ø¯Ø±Ø§Ø¬Ø© Ù†Ø§Ø±ÙŠØ©</span>
    </div>
    <div class="vehicle-option" data-value="bicycle">
      <!-- ØºÙŠÙ‘Ø± bicycle.png Ù„Ø§Ø³Ù… ØµÙˆØ±Ø© Ø§Ù„Ø¯Ø±Ø§Ø¬Ø© Ø§Ù„Ù‡ÙˆØ§Ø¦ÙŠØ© -->
      <img src="bicycle.png" alt="" class="vehicle-option-img" />
      <span id="vehicleOptionBicycleText">Ø¯Ø±Ø§Ø¬Ø© Ù‡ÙˆØ§Ø¦ÙŠØ©</span>
    </div>
  </div>

  <!-- Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„ÙØ¹Ù„ÙŠØ© Ø§Ù„ØªÙŠ Ù†Ø®Ø²Ù†Ù‡Ø§ ÙÙŠ Firestore -->
  <input type="hidden" id="vehicleType" name="vehicleType" />
</div>

<input type="email" id="driverEmail" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" required />

        <input type="text" id="driverPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" required />
        <input type="password" id="driverPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± (6+ Ø­Ø±ÙˆÙ)" required />
        <button type="submit">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø³Ø§Ø¦Ù‚</button>
    </form>
</div>

<!-- SECTION: Login -->
<div id="loginSection" class="card hidden">
    <form id="loginForm" autocomplete="off">
        <h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ (Ø³Ø§Ø¦Ù‚)</h3>
        <input type="email" id="loginEmail" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" required />
        <input type="password" id="loginPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±" required />
        <button type="submit">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
    </form>
</div>

<!-- SECTION: Driver Dashboard -->
<div id="driverDashboard" class="hidden">
        <!-- Ø®Ø±ÙŠØ·Ø© ÙƒØ¨ÙŠØ±Ø© ØªÙ…Ù„Ø£ Ø§Ù„Ø´Ø§Ø´Ø© -->
    <div id="driverMap" class="driver-map"></div>

    <!-- Ø²Ø± Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¥Ù„Ù‰ Ø§Ù„Ù…ØªØ¬Ø± (Ø£ÙŠÙ‚ÙˆÙ†Ø© Ù…ØªØ¬Ø±) -->
    <button id="driverNavBtn" class="driver-nav-btn" title="Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¥Ù„Ù‰ Ø§Ù„Ù…ØªØ¬Ø±">
        <div class="driver-nav-icon"></div>
    </button>
    <!-- Ø²Ø± Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙŠØ¯ÙˆÙŠ -->
    <button id="driverExtraManualBtn" class="driver-extra-child-btn">
        <img src="manual.png" alt="" />
    </button>

    <!-- Ø²Ø± Ø§Ù„Ù…Ø³Ø­ (scan) -->
    <button id="driverExtraScanBtn" class="driver-extra-child-btn">
        <img src="scan.png" alt="" />
    </button>

    <!-- Ø²Ø± Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„ (Ø£ÙŠÙ‚ÙˆÙ†Ø© Ù…Ø³ØªØ®Ø¯Ù…) -->
    <button id="customerSearchBtn" class="driver-search-btn" title="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„">
        <div class="driver-search-icon"></div>
    </button>
    <!-- Ø²Ø± Ø¥Ø¶Ø§ÙØ© Ø·Ù„Ø¨ Ù…Ù† Ù†ÙØ³ Ø§Ù„Ù…Ø·Ø¹Ù… -->
    <button id="driverExtraOrdersBtn" class="driver-extra-order-btn" title="Ø¥Ø¶Ø§ÙØ© Ø·Ù„Ø¨">
        <img src="order1.png" alt="" />
    </button>
<!-- Ø²Ø± Ù…Ø¨Ø¯Ù‘Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø© ÙÙˆÙ‚ Ø²Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ© -->
<button id="driverActiveSwitcherBtn" class="driver-active-switcher-btn hidden">
  <!-- Ø§Ù„ØµÙˆØ±Ø©: Ø£Ù†Øª ØªØºÙŠÙ‘Ø± Ø§Ù„Ù€ src ÙƒÙ…Ø§ ØªØ±ÙŠØ¯ -->
  <img id="driverActiveSwitcherIcon" src="active.png" alt="" />

  <!-- Ø´Ø§Ø±Ø© Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø© -->
  <span id="driverActiveSwitcherBadge" class="driver-active-switcher-badge"></span>
</button>

    <!-- Ù„ÙˆØ­Ø© Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„ -->
    <div id="customerAddressPanel" class="driver-address-panel hidden">
        <div class="driver-address-input-wrapper">
            <input id="customerAddressInput" type="text" placeholder="Ø£Ø¯Ø®Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„" autocomplete="off" />
            <button id="startCustomerNavBtn" class="driver-address-go-btn">Ø¨Ø¯Ø¡ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡</button>
        </div>
    </div>
    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙŠØ¯ÙˆÙŠ Ù„Ø·Ù„Ø¨ Ø¥Ø¶Ø§ÙÙŠ -->
    <div id="driverExtraManualPanel" class="driver-extra-manual-panel hidden">
      <div class="driver-extra-manual-inner">
        <div class="driver-extra-price-row">
          <input
            id="driverExtraPriceInput"
            type="number"
            step="0.01"
            min="0"
          />
          <button
            type="button"
            id="driverExtraCashToggle"
            class="driver-extra-cash-btn"
          ></button>
        </div>
        <button
          type="button"
          id="driverExtraConfirmBtn"
          class="driver-extra-confirm-btn"
        ></button>
      </div>
    </div>

    <!-- Ø´Ø±ÙŠØ· Ø¹Ù„ÙˆÙŠ ÙŠØ·ÙÙˆ ÙÙˆÙ‚ Ø§Ù„Ø®Ø±ÙŠØ·Ø© -->
    <div class="driver-top-bar">

    <div class="driver-top-right">
        <!-- Ø²Ø± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© ÙÙŠ Ø£Ù‚ØµÙ‰ Ø§Ù„ÙŠÙ…ÙŠÙ† -->
        <button id="driverMenuBtn" class="driver-icon-btn">â˜°</button>
    </div>

    <div class="driver-top-center">
        <!-- Ø²Ø± Ø§Ù„Ø­Ø§Ù„Ø© ÙÙŠ Ù…Ù†ØªØµÙ Ø§Ù„Ø´Ø±ÙŠØ· -->
        <button id="toggleOnlineBtn" class="driver-toggle-btn">Ø§Ù„Ø­Ø§Ù„Ø©: Ø£ÙˆÙÙ„Ø§ÙŠÙ†</button>
    </div>

    <div class="driver-top-left">
  <!-- âœ… Ø´Ø§Ø±Ø© Ø§Ù„ÙƒØ§Ø´ Ø§Ù„Ø¹Ø§Ø¦Ù…Ø© -->
  <div id="cashFloatingBadge" class="cash-floating-badge hidden"></div>

  <!-- ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ -->
  <div id="driverEarningsFloating" class="driver-earnings-floating">
    Ø§Ù„Ø£Ø±Ø¨Ø§Ø­<br><strong>0</strong>
  </div>
</div>

</div>

    <!-- ÙƒØ±Øª Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ù†Ø´Ø· (Ø¥Ø¯Ø§Ø±Ø© Ù…Ù† Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©) -->
    <div id="driverCurrentOrder" class="driver-current-order hidden"></div>

    <!-- ÙƒØ¨Ø³ÙˆÙ„Ø© Ø­Ø§Ù„Ø© ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„ -->
    <div class="driver-bottom-status" id="driverBottomStatus">
        <span id="driverStatusText">Ø£Ù†Øª Ø£ÙˆÙÙ„Ø§ÙŠÙ† Ø­Ø§Ù„ÙŠØ§Ù‹ â€” Ø§Ø¶ØºØ· Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø©</span>
    </div>

    <!-- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© -->
    <div id="driverSidePanel" class="driver-side-panel">
        <div class="driver-side-header">
    <div class="driver-side-header-main">
    <div class="driver-side-title">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</div>

    <!-- Ø§Ø³Ù… Ø§Ù„Ø³Ø§Ø¦Ù‚ + ØµÙˆØ±Ø© Ø§Ù„Ù…Ø±ÙƒØ¨Ø© -->
    <div class="driver-side-name-row">
        <div id="driverVehicleIcon" class="driver-vehicle-icon"></div>
        <div id="driverName" class="driver-side-driver-name">Ø§Ø³Ù… Ø§Ù„Ø³Ø§Ø¦Ù‚</div>
    </div>

    <!-- âœ… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù„ØºØ© ØªØ­Øª Ø§Ø³Ù… Ø§Ù„Ø³Ø§Ø¦Ù‚ -->
    <div class="driver-lang-controls">
        <select id="langSelect">
    <option value="en">English</option>
    <option value="de">Deutsch</option>
    <option value="tr">TÃ¼rkÃ§e</option>
    <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
</select>


        </div>
    </div>
    <button id="driverSideCloseBtn" class="driver-icon-btn">âœ•</button>
</div>

        <!-- Ù…Ù„Ø®Øµ Ø§Ù„ÙŠÙˆÙ… -->
        <div class="driver-side-section">
            <button class="driver-side-link driver-section-toggle open" data-target="driverSummaryPane">
                <span>Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</span>
            </button>
            <div id="driverSummaryPane" class="driver-side-pane open">
                <div class="driver-side-stats">
                    <div class="stat" id="driverActiveCount">Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©<br><strong>0</strong></div>
                    <div class="stat" id="driverCompletedCount">Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©<br><strong>0</strong></div>
                    <div class="stat" id="driverEarnings">Ø§Ù„Ø£Ø±Ø¨Ø§Ø­<br><strong>0</strong></div>
                </div>
            </div>
        </div>

        <!-- Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© -->
        <div class="driver-side-section">
            <button class="driver-side-link driver-section-toggle" data-target="driverActivePane">
                <span>Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©</span>
            </button>
            <div id="driverActivePane" class="driver-side-pane">
                <div class="card driver-side-card">
                    <div id="driverActiveOrders" class="orders-list"></div>
                </div>
            </div>
        </div>

        <!-- Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© -->
        <div class="driver-side-section">
            <button class="driver-side-link driver-section-toggle" data-target="driverCompletedPane">
                <span>Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</span>
            </button>
            <div id="driverCompletedPane" class="driver-side-pane">
                <div class="card driver-side-card">
                    <div id="driverCompletedOrders" class="orders-list"></div>
                </div>
            </div>
        </div>

                <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ³Ø¹ÙŠØ± -->
        <div class="driver-side-section">
            <button id="pricingSettingsBtn" class="driver-side-link driver-section-toggle" data-target="driverPricingPane">
                <span>Ø¶Ø¨Ø· ØªÙƒØ§Ù„ÙŠÙ Ø§Ù„ØªÙˆØµÙŠÙ„</span>
            </button>
            <div id="driverPricingPane" class="driver-side-pane">
  <div class="card driver-side-card">
    <div id="pricingIntroText" class="small" style="margin-bottom:6px;">
      Ù‚Ù… Ø¨Ø¶Ø¨Ø· ØªØ³Ø¹ÙŠØ±Ø© Ø§Ù„ØªÙˆØµÙŠÙ„ Ù„ÙŠØªÙ… Ø§Ø­ØªØ³Ø§Ø¨ ØªÙƒÙ„ÙØ© ÙƒÙ„ Ø±Ø­Ù„Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.
    </div>

    <!-- âœ… Ø§Ø®ØªÙŠØ§Ø± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªØ³Ø¹ÙŠØ± -->
    <label id="pricingModeLabel" class="small">
      Ø·Ø±ÙŠÙ‚Ø© Ø­Ø³Ø§Ø¨ ØªÙƒÙ„ÙØ© Ø§Ù„ØªÙˆØµÙŠÙ„
    </label>
    <select id="pricingModeSelect">
  <option value="per_km" id="pricingModePerKmOption">
    ØªØ³Ø¹ÙŠØ±Ø© Ø®Ø§ØµØ©
  </option>
  <option value="independent_tiered" id="pricingModeIndependentOption">
    ØªØ³Ø¹ÙŠØ±Ø© Taussil
  </option>
</select>
<!-- ğŸ”— Ø³Ø·Ø± Ø§Ù„Ù„ÙŠÙ†Ùƒ Ø§Ù„ØªØ¹Ø±ÙŠÙÙŠ -->
<div class="pricing-info-link">
  <button type="button" id="pricingInfoLink" class="link-button small">
    Ø´Ø±Ø­ ØªØ³Ø¹ÙŠØ±Ø© Taussil
  </button>
</div>
    <!-- âœ… Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù‚Ø¯ÙŠÙ… (Ø¨Ø§Ù„ÙƒÙŠÙ„ÙˆÙ…ØªØ±) ÙŠÙ…ÙƒÙ† Ø¥Ø®ÙØ§Ø¤Ù‡Ø§ -->
    <div id="perKmSettingsBox">
      <label id="pricingDeliveryLabel" class="small">
        Ø³Ø¹Ø± Ø§Ù„ÙƒÙŠÙ„ÙˆÙ…ØªØ± Ù…Ù† Ø§Ù„ØªØ§Ø¬Ø± Ø¥Ù„Ù‰ Ù†Ù‚Ø·Ø© Ø§Ù„ØªØ³Ù„ÙŠÙ… (â‚¬)
      </label>
      <input id="pricePerKmDelivery" type="number" step="0.01" min="0" />

      <label style="display:flex; align-items:center; gap:6px; margin-top:8px;">
        <input id="includeToMerchantSegment" type="checkbox" />
        <span id="pricingIncludeLabel" class="small">
          Ø§Ø­ØªØ³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§ÙØ© Ù…Ù† Ù…ÙˆÙ‚Ø¹ÙŠ Ø¥Ù„Ù‰ Ø§Ù„ØªØ§Ø¬Ø±
        </span>
      </label>

      <div style="margin-right:4px; margin-top:6px;">
        <label class="small" style="display:flex; align-items:center; gap:6px;">
          <input id="useSamePriceForBoth" type="checkbox" />
          <span id="pricingSamePriceLabel" class="small">
            Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†ÙØ³ Ø§Ù„Ø³Ø¹Ø± Ù„Ù„Ù…Ø³Ø§Ø±ÙŠÙ†
          </span>
        </label>
      </div>

      <div id="toMerchantRow" style="margin-top:6px;">
        <label id="pricingToMerchantLabel" class="small">
          Ø³Ø¹Ø± Ø§Ù„ÙƒÙŠÙ„ÙˆÙ…ØªØ± Ù…Ù† Ù…ÙˆÙ‚Ø¹ÙŠ Ø¥Ù„Ù‰ Ø§Ù„ØªØ§Ø¬Ø± (â‚¬)
        </label>
        <input id="pricePerKmToMerchant" type="number" step="0.01" min="0" />
      </div>

      <label id="pricingFreeKmLabel" class="small" style="margin-top:8px;">
        Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙŠÙ„ÙˆÙ…ØªØ±Ø§Øª Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ© Ø§Ù„Ø£ÙˆÙ„Ù‰
      </label>
      <input id="freeKmInput" type="number" step="0.1" min="0" />
    </div>

    <div class="btn-row">
      <button id="savePricingBtn">Ø­ÙØ¸</button>
    </div>

    <div class="small" id="pricingBaseFeeHint" style="margin-top:4px;"></div>
  </div>
</div>

            <!-- âœ… Ø²Ø± ÙŠÙØªØ­ Ù…Ù†Ø¨Ø«Ù‚ Ù‚Ø§Ù†ÙˆÙ†ÙŠ -->
            <button id="driverLegalBtn" class="driver-side-link">
                <span>Rechtlicher Hinweis (Beta)</span>
            </button>

            <button id="driverLogoutBtn" class="driver-side-link driver-side-danger">
                <span>ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</span>
            </button>
        </div>

    </div>
    <div id="driverSidePanelBackdrop" class="driver-side-backdrop"></div>
</div>

<!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ (Ù…ÙˆØ¯Ø§Ù„ Ù…Ø´ØªØ±Ùƒ) -->
<div id="orderModal" class="hidden">
    <div class="modal-backdrop" id="modalBackdrop" style="display:none;">
        <div class="modal">
            <div id="modalContent" style="margin-top:12px;"></div>
        </div>
    </div>
</div>
<!-- Ù…Ù†Ø¨Ø«Ù‚ Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ø³Ø§Ø¦Ù‚ (Ù„Ø§ ÙŠÙØºÙ„Ù‚ Ø¥Ù„Ø§ Ø¨Ø²Ø± Ø¥Ø¨Ø¯Ø£) -->
<div id="driverApprovalOverlay" class="driver-approval-overlay hidden">
  <div class="driver-approval-modal">
    <h3 id="driverApprovalTitle">ØªÙ… ØªÙØ¹ÙŠÙ„ Ø­Ø³Ø§Ø¨Ùƒ</h3>
    <p id="driverApprovalMessage">
      Ù„Ù‚Ø¯ ØªÙ… ØªÙØ¹ÙŠÙ„ Ø­Ø³Ø§Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­ ÙˆÙŠÙ…ÙƒÙ†Ùƒ Ø¨Ø¯Ø¡ ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø±Ø­Ù„Ø§Øª ÙˆØ®Ø¯Ù…Ø© Ø§Ù„ØªÙˆØµÙŠÙ„ Ù…Ø¨Ø§Ø´Ø±Ø©.
    </p>
    <button id="driverApprovalStartBtn" class="driver-approval-start-btn">
      Ø¥Ø¨Ø¯Ø£
    </button>
  </div>
</div>

<footer>Der Dienst befindet sich in der Erprobungsphase und kann technische Fehler oder EinschrÃ¤nkungen enthalten. Die Nutzung erfolgt auf eigene Verantwortung.</footer>
<!-- ØµÙˆØª Ù†Ø¯Ø§Ø¡ Ø¬Ø¯ÙŠØ¯ -->
<audio id="callSound" src="coin.wav" preload="auto"></audio>
<footer>Der Dienst befindet sich in der Erprobungsphase und kann technische Fehler oder EinschrÃ¤nkungen enthalten. Die Nutzung erfolgt auf eigene Verantwortung.</footer>

<!-- ğŸ”Š ØµÙˆØª Ø§Ù„Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† (ØºÙŠÙ‘Ø± online-sound.mp3 Ù„Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯Ù‡) -->
<audio id="onlineSound" src="online1.mp3" preload="auto"></audio>
<!-- ğŸ”Š ØµÙˆØª Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨ Ù…Ù† Ø§Ù„ØªØ§Ø¬Ø± -->
<audio id="orderCancelledSound" src="cancel.mp3" preload="auto"></audio>
<!-- ğŸ”Š ØµÙˆØª Ù…Ù†Ø¨Ø«Ù‚ Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ø³Ø§Ø¦Ù‚ (ØºÙŠÙ‘Ø± Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù Ù„Ù…Ø§ ØªØ±ÙØ¹Ù‡) -->
<audio id="driverApprovalSound" src="unterwegs.mp3" preload="auto"></audio>

<!-- Google Maps API -->
<script
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCUMgXQwwe7afBlRpp6zrXunbTVSCXfSqQ&v=beta&map_ids=a07979cd0230b599b0df811d&libraries=geometry,places"
  defer
></script>


<script>
/* ========== Ø¥Ø¹Ø¯Ø§Ø¯ Firebase ========== */
const firebaseConfig = {
  apiKey: "AIzaSyBhiKPw7M3NMCOhzoBJJyI9enOa6qZQnHc",
  authDomain: "delivera-7pq7jc.firebaseapp.com",
  projectId: "delivera-7pq7jc",
  storageBucket: "delivera-7pq7jc.appspot.com",
  messagingSenderId: "186649231022",
  appId: "1:186649231022:web:18e76b00018fbb5d68773f"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
const BASE_DELIVERY_FEE = 3.5; // EUR
const DRIVER_SESSION_MAX_IDLE_MS = 5 * 60 * 1000; // 5 Ø¯Ù‚Ø§Ø¦Ù‚ Ø¨Ø§Ù„Ù…ÙŠÙ„ÙŠ Ø«Ø§Ù†ÙŠØ©

// ====== Median Background Location: Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø®Ø¯Ù…Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø£ÙˆÙÙ„Ø§ÙŠÙ† / ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ ======
function stopMedianBackgroundLocation() {
  try {
    // Ù„Ùˆ Ø³ÙƒØ±Ø¨Øª Median ØºÙŠØ± Ù…Ø­Ù…Ù‘Ù„ (Ù…ØªØµÙØ­ Ø¹Ø§Ø¯ÙŠ Ù…Ø«Ù„Ø§Ù‹) Ù…Ø§ Ù†Ø¹Ù…Ù„ Ø´ÙŠØ¡
    if (!window.median || !median.backgroundLocation || !median.backgroundLocation.stop) {
      console.log("Median backgroundLocation.stop() ØºÙŠØ± Ù…ØªÙˆÙØ± â€” ØªÙ… Ø§Ù„ØªØ¬Ø§Ù‡Ù„.");
      return;
    }
    console.log("Calling median.backgroundLocation.stop() â€¦");
    median.backgroundLocation.stop();
  } catch (e) {
    console.error("ÙØ´Ù„ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ median.backgroundLocation.stop()", e);
  }
}
// ====== Median Background Location: ØªØ´ØºÙŠÙ„ Ø§Ù„Ø®Ø¯Ù…Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† ======
function startMedianBackgroundLocation() {
  try {
    // Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø© ÙŠØ¹Ø±Ù‘ÙÙ‡Ø§ Ø³ÙƒØ±Ø¨Øª Ø§Ù„Ù€ Custom JavaScript ÙÙŠ Median
    if (typeof window.taussilStartMedianBackgroundLocation === "function") {
      console.log("Calling taussilStartMedianBackgroundLocation() â€¦");
      window.taussilStartMedianBackgroundLocation();
    } else {
      console.log("taussilStartMedianBackgroundLocation ØºÙŠØ± Ù…ØªÙˆÙØ±Ø© (ØºØ§Ù„Ø¨Ø§Ù‹ Ù„ÙŠØ³ Ø¯Ø§Ø®Ù„ Median).");
    }
  } catch (e) {
    console.error("ÙØ´Ù„ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ startMedianBackgroundLocation:", e);
  }
}

// ğŸ‘‡ Ù…Ù‡Ù… Ù„Ù€ Median: ØªØ¹Ø±ÙŠÙ Ù…ØªØºÙŠÙ‘Ø± Ø¹Ø§Ù„Ù…ÙŠ ÙŠØ­Ù…Ù„ uid Ø§Ù„Ø³Ø§Ø¦Ù‚ Ø§Ù„Ø­Ø§Ù„ÙŠ
window.TAUSSIL_DRIVER_ID = null;

function maybeRestoreDriverSessionFromAuth(user) {
  if (!user) return;
  if (driverDashboardShownOnce || isManualLoginInProgress) return;

  let lastUid = null;
  let lastClosedAt = null;

  try {
    lastUid = localStorage.getItem("driverLastUid");
    const ts = localStorage.getItem("driverLastClosedAt");
    lastClosedAt = ts ? parseInt(ts, 10) : null;
  } catch (e) {}

  const now = Date.now();

  // â¬…ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬Ù„Ø³Ø© Ø³Ø§Ø¨Ù‚Ø© Ù…Ø®Ø²Ù‘Ù†Ø© â†’ Ù„Ø§ Ù†ÙØ¹Ù„ Ø´ÙŠØ¦Ø§Ù‹ (Ù„Ø§ Ø§Ø³ØªØ¹Ø§Ø¯Ø© ÙˆÙ„Ø§ signOut)
  if (!lastUid || !lastClosedAt) {
    return;
  }

  // âœ… Ø¬Ù„Ø³Ø© Ø­Ø¯ÙŠØ«Ø© Ù„Ù†ÙØ³ Ø§Ù„Ø³Ø§Ø¦Ù‚ (â‰¤ Ù¥ Ø¯Ù‚Ø§Ø¦Ù‚) â†’ Ø§Ø³ØªØ¹Ø§Ø¯Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
  if (lastUid === user.uid && now - lastClosedAt <= DRIVER_SESSION_MAX_IDLE_MS) {
    showDriverDashboard(user.uid)
      .then(() => {
        driverDashboardShownOnce = true;
      })
      .catch((err) => {
        console.error("ÙØ´Ù„ ÙÙŠ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø¬Ù„Ø³Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹:", err);
      });
    return;
  }

  // âš ï¸ Ø¬Ù„Ø³Ø© Ù‚Ø¯ÙŠÙ…Ø© Ù„Ù†ÙØ³ Ø§Ù„Ø³Ø§Ø¦Ù‚ â†’ ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ ÙˆØªÙ†Ø¸ÙŠÙ Ø§Ù„ØªØ®Ø²ÙŠÙ†
  if (lastUid === user.uid) {
    auth
      .signOut()
      .catch((err) => {
        console.warn("ØªØ¹Ø°Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ø³Ø§Ø¦Ù‚:", err);
      });

    try {
      localStorage.removeItem("driverLastUid");
      localStorage.removeItem("driverLastClosedAt");
    } catch (e) {}

    return;
  }

  // Ø­Ø§Ù„Ø©: lastUid Ù„Ø³Ø§Ø¦Ù‚ Ø¢Ø®Ø± â†’ Ù†Ù…Ø³Ø­ Ø§Ù„Ù‚ÙŠÙ… ÙÙ‚Ø· Ø¨Ø¯ÙˆÙ† Ø¥Ø²Ø¹Ø§Ø¬ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
  try {
    localStorage.removeItem("driverLastUid");
    localStorage.removeItem("driverLastClosedAt");
  } catch (e) {}
}

// ğŸ‘‡ Ù…Ø²Ø§Ù…Ù†Ø© Ù…ØªØºÙŠÙ‘Ø± Ø§Ù„Ø³Ø§Ø¦Ù‚ Ù…Ø¹ Ø­Ø§Ù„Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙÙŠ Firebase + Ù…Ù†Ø·Ù‚ Ù¥ Ø¯Ù‚Ø§Ø¦Ù‚
auth.onAuthStateChanged(function (user) {
  if (user) {
    window.TAUSSIL_DRIVER_ID = user.uid;
    console.log("TAUSSIL_DRIVER_ID (auth state):", user.uid);

    maybeRestoreDriverSessionFromAuth(user);
  } else {
    window.TAUSSIL_DRIVER_ID = null;
    console.log("TAUSSIL_DRIVER_ID cleared (no user)");

    // Ø¹Ù†Ø¯ Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ù…Ø³ØªØ®Ø¯Ù…ØŒ Ù†ØªØ£ÙƒØ¯ Ø£Ù† Median ØªÙˆÙ‚ÙØª
    stopMedianBackgroundLocation();
  }
});

// Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„ (Ù†Ù‚Ø·Ø© Ø§Ù„ØªØ³Ù„ÙŠÙ…) Ù…Ù† Ù†ÙØ³ Ù…Ø¬Ù„Ø¯ Ø§Ù„Ù…Ù„Ù
const CUSTOMER_MARKER_ICON_PATH = "kunde1.png";
// Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„ØªØ§Ø¬Ø± (Ø§Ù„Ù…ØªØ¬Ø±) Ù…Ù† Ù†ÙØ³ Ù…Ø¬Ù„Ø¯ Ø§Ù„Ù…Ù„Ù
const MERCHANT_MARKER_ICON_PATH = "markt.png"; // ØºÙŠÙ‘Ø± Ø§Ù„Ø§Ø³Ù… Ø­Ø³Ø¨ Ù…Ù„ÙÙƒ

function getCustomerMarkerIcon() {
  if (typeof google === "undefined" || !google.maps) return null;
  return {
    url: CUSTOMER_MARKER_ICON_PATH,              // Ù†ÙØ³ Ø§Ù„Ù…Ø¬Ù„Ø¯
    scaledSize: new google.maps.Size(50, 50),    // Ø­Ø¬Ù… Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
    origin: new google.maps.Point(0, 0),
    anchor: new google.maps.Point(20, 40)        // Ù†Ù‚Ø·Ø© Ø§Ù„Ø§Ø±ØªÙƒØ§Ø² Ø£Ø³ÙÙ„ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©
  };
}
/* ========== ØªØ¹Ø¯Ø¯ Ø§Ù„Ù„ØºØ§Øª (EN / DE / AR) ========== */
let currentLang = "en";

const translations = {
  en: {
    // Main header and tabs
    mainHeader: "Delivery System â€” Driver Interface",
    tab_register: "Register",
    tab_login: "Log in",

    // Register driver
    driver_register_title: "Driver registration",
    firstName_placeholder: "First name",
    lastName_placeholder: "Last name",
    address_placeholder: "Address",
    city_placeholder: "City",
    driverEmail_placeholder: "Email",
    driverPhone_placeholder: "Phone number",
    driverPassword_placeholder: "Password (6+ characters)",
    register_submit: "Register driver",
    driverType_label: "Driver type",
    driverType_placeholder: "Select driver type",
    driverType_independent: "Independent driver",
    driverType_employee: "Driver employed by Taussil",
    driverType_required: "Please choose your driver type.",

    // Login
    driver_login_title: "Driver login",
    loginEmail_placeholder: "Email",
    loginPassword_placeholder: "Password",
    login_submit: "Log in",

    // Customer address
    customerAddress_placeholder: "Enter customer address",
    start_customer_nav: "Start navigation",

    // Online/offline button + bottom capsule
    online_btn_online: "Status: Online",
    online_btn_offline: "Status: Offline",
    status_hint_online: "You are online and ready to receive orders",
    status_hint_offline: "You are currently offline â€” tap to go online",
    status_active_one: "You have 1 active order",
    status_active_many: "You have {count} active orders",

    // Side panel
    side_menu_title: "Menu",
    side_summary_title: "Orders summary",
    active_section_btn: "Active orders",
    completed_section_btn: "Previous orders",
    pricing_section_btn: "Delivery pricing",
    logout: "Log out",

    // Stats
    summary_active_orders: "Cash",
    summary_completed_orders: "Previous orders",
    summary_earnings: "Earnings",

summary_orders_count: "orders",
summary_total_km: "Total distance",

    // Pricing (delivery settings)
    pricing_intro:
      "Set your delivery pricing so each trip is calculated automatically.",
    pricing_label_delivery: "Price per km from merchant to drop-off (â‚¬)",
    pricing_include_to_merchant: "Include distance from my location to merchant",
    pricing_use_same_for_both: "Use the same price for both segments",
    pricing_label_to_merchant:
      "Price per km from my location to merchant (â‚¬)",
    pricing_free_km: "Number of free first kilometers",
    pricing_save_btn: "Save",
    pricing_base_fee_hint:
      "Fixed base fee per delivered order: {fee} â‚¬",
    pricing_error_delivery_price:
      "Please enter a valid price per kilometer from merchant to drop-off.",
    pricing_error_to_merchant_price:
      "Please enter a valid price per kilometer from your location to the merchant.",
    pricing_saved_success: "Pricing settings saved successfully.",
    pricing_mode_label: "Pricing model",
    pricing_mode_per_km: "Custom pricing (per km)",
pricing_mode_independent: "Taussil pricing (recommended)",
pricing_mode_note_independent_only:
  "Taussil pricing is the standard company model used for employed drivers. Custom pricing is mainly intended for independent drivers.",

pricing_info_link_label: "How is the Taussil pricing calculated?",
pricing_taussil_info_title: "Taussil pricing formula",
pricing_taussil_info_intro:
  "This pricing is the standard model used by Taussil for employed drivers and is also recommended in general. Independent drivers can still use it if they want. The cost is based on the order value and on the distance from merchant to customer only (driver â†’ merchant distance is not counted).",

pricing_taussil_info_example1:
  "Example 1 â€“ order value 20 â‚¬ and distance 5 km:\n" +
  "- Base fee (GrundgebÃ¼hr): 3.50 â‚¬ (because order â‰¤ 25 â‚¬)\n" +
  "- First 5 km: 5 Ã— 0.50 â‚¬ = 2.50 â‚¬\n" +
  "- Distance cost: 2.50 â‚¬\n" +
  "- Total delivery cost: 3.50 â‚¬ + 2.50 â‚¬ = 6.00 â‚¬",

pricing_taussil_info_example2:
  "Example 2 â€“ order value 40 â‚¬ and distance 15 km:\n" +
  "- Base fee (GrundgebÃ¼hr): 40 â‚¬ Ã— 14% = 5.60 â‚¬ (because order > 25 â‚¬)\n" +
  "- First 7 km: 7 Ã— 0.50 â‚¬ = 3.50 â‚¬\n" +
  "- Next 5 km (7â€“12 km): 5 Ã— 0.80 â‚¬ = 4.00 â‚¬\n" +
  "- Remaining 3 km (> 12 km): 3 Ã— 1.00 â‚¬ = 3.00 â‚¬\n" +
  "- Distance cost: 3.50 â‚¬ + 4.00 â‚¬ + 3.00 â‚¬ = 10.50 â‚¬\n" +
  "- Total delivery cost: 5.60 â‚¬ + 10.50 â‚¬ = 16.10 â‚¬",

pricing_taussil_info_note:
  "When you select \"Taussil pricing\", this formula is applied automatically for every completed order. No additional manual base fees or surcharges are added on top.",

    // Footer
    footer_text:
      "Taussil e.K. â€“ Beta-Version im Testbetrieb. Nutzung auf eigene Verantwortung.",

    // Status labels
    status_pending: "Pending",
    status_accepted: "Accepted",
    status_inProgress: "In progress",
    status_delivered: "Delivered",
    status_cancelled: "Cancelled",
    status_rejected: "Rejected",
    status_unknown: "Unknown",

    // Bottom sheet (current order)
    currentOrder_btn_startToMerchant: "Start driving to merchant",
    currentOrder_btn_delivered: "Mark as delivered",
    currentOrder_btn_cancel: "Cancel order",
    currentOrder_expectedCost: "Estimated cost",

    // Order details modal
    orderDetails_title: "Order details",
    orderDetails_status: "Status",
    orderDetails_createdAt: "Order time",
    orderDetails_startedAt: "Start of delivery",
    orderDetails_deliveredAt: "Delivery time",
    orderDetails_merchant: "Merchant",
    orderDetails_customerName: "Customer name",
    orderDetails_address: "Address",
    orderDetails_totalDistance: "Total distance",
    orderDetails_deliveryCost: "Delivery fee",
    orderDetails_notes: "Notes",
    orderDetails_closeBtn: "Close",
    orderDetails_paymentType: "Payment type",
    orderDetails_cashAmount: "Cash amount",
    paymentType_cash: "Cash payment",
    paymentType_online: "Online payment",
    paymentType_unknown: "Payment",

    // New call modal
    newCall_title: "New call from merchant",
    newCall_merchant: "Merchant",
    newCall_city: "City",
    newCall_time: "Time",
    newCall_question: "Do you want to accept this call?",
    newCall_btn_accept: "Accept",
    newCall_btn_reject: "Reject",

    // Distance / units
    distance_km_short: "km",

    // Side list order cards
    orderCard_status: "Status",
    orderCard_address: "Address",
    orderCard_expectedCost: "Estimated cost",
    orderCard_totalDistance: "Total distance",
    orderCard_finalCost: "Final cost",

    // Alerts / confirmations
    alert_password_too_short:
      "Password must be at least 6 characters.",
    alert_driver_register_success: "Driver registered successfully!",
    alert_generic_error_prefix: "Error: ",
    alert_login_driver_only:
      "This interface is for drivers only. If you are a merchant, please use the merchant interface link.",
    alert_toggle_offline_with_active:
      "You can't go offline or close the session while there is an active order. Please finish the order first.",
    alert_geo_failed_prefix: "Unable to get location: ",
    alert_geo_not_supported: "Your browser does not support geolocation.",
    alert_status_update_failed: "Error while updating status: ",
    alert_logout_forbidden_while_busy:
      "You can't log out while there is an active order or accepted call. Please finish the order first.",
    alert_logout_failed: "Error while logging out: ",
    alert_address_geocode_failed:
      "Unable to get the location for this address.",
    alert_customer_address_required:
      "Please select a valid customer address first.",
    alert_live_nav_not_supported:
      "Your browser does not support live navigation.",
    alert_map_not_ready: "Map is not ready yet.",
    alert_call_update_failed: "Error while updating call status: ",
    alert_currentDriverNotSet: "Current driver is not set.",
    alert_orderNotInDriverLog: "Order not found in driver's log.",
    alert_readOrderDetailsError:
      "Error while reading order details: ",
    alert_cannotAcceptCallNoDriver:
      "Cannot accept the call: no driver is set.",
    alert_acceptCallError: "Error while accepting the call: ",
    alert_rejectCallError: "Error while rejecting the call: ",
    alert_orderNotFound: "Order not found.",
    alert_driverStartError:
      "Error while registering start of the trip: ",
    alert_driverStartSuccess:
      "Trip towards merchant has been registered and map navigation started.",
    alert_completeDeliveryError:
      "Error while completing the delivery: ",
    alert_completeDeliverySuccess:
      "Distance and delivery fee have been calculated and order status updated.",
    confirm_cancel_order:
      "Are you sure you want to cancel this order?",
	      orderCancelledByMerchant_title: "Order cancelled by merchant",
    orderCancelledByMerchant_message:
      "This order was cancelled by the merchant. The distance you have already driven will be charged according to your configured prices.",
    orderCancelledByMerchant_confirmBtn: "I understand",
    alert_no_active_target:
      "There is no active destination on the map right now. Please start navigating to the merchant or choose the customer's address first.",
    vehicleType_label: "Vehicle type",
    vehicleType_placeholder: "Select vehicle type",
    vehicleType_car: "Car",
    vehicleType_motorcycle: "Motorbike",
    vehicleType_bicycle: "Bicycle",
        vehicleType_required: "Please choose your vehicle type.",

    // âœ… Ø¬Ø¯ÙŠØ¯: Ø±Ø³Ø§Ø¦Ù„ Ø¹Ø¯Ù… Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯
    driver_not_approved_status_btn: "Awaiting approval",
    driver_not_approved_hint:
      "Your account is pending approval from the platform. You can go online once it is approved.",
    alert_driver_not_approved:
      "You cannot go online yet because your account has not been approved. Please wait until the admin approves you.",
    driverApprovalModal_title: "Account activated",
    driverApprovalModal_message:
      "Your driver account has been approved. You can now start offering trips and delivery services.",
    driverApprovalModal_button: "Start",
// ğŸ‡¬ğŸ‡§ English (en)
currentOrder_orderPrice: "Order amount",
currentOrder_btn_editPrice: "Edit price",
orderDetails_orderPrice: "Order amount",
prompt_editOrderPrice: "Enter the new order amount (â‚¬):",
alert_invalid_orderPrice: "Invalid amount.",
alert_orderPriceUpdated: "Order amount updated successfully.",
"driver_extraOrders_add_title": "Add order from same restaurant",
  "driver_extraOrders_manual_title": "Add new order manually",
  "driver_extraOrders_scan_title": "Add order via QR code",

  "extraOrder_price_placeholder": "Enter order amount",
  "extraOrder_cash_off": "cash",
  "extraOrder_cash_on": "Cash",
  "extraOrder_confirm_btn": "Confirm extra order",
  "extraOrders_price_required": "Please enter the price",
extraOrders_no_active_call: "No active order to attach an extra order to.",
extraOrders_missing_merchant: "Could not determine the base merchant for this order.",
extraOrders_created_success: "Extra order has been created successfully.",
extraOrders_create_failed: "Failed to create extra order: ",
  },

  de: {
    mainHeader: "Liefersystem â€” FahreroberflÃ¤che",
    tab_register: "Registrieren",
    tab_login: "Anmelden",

    driver_register_title: "Fahrer registrieren",
    firstName_placeholder: "Vorname",
    lastName_placeholder: "Nachname",
    address_placeholder: "Adresse",
    city_placeholder: "Stadt",
    driverEmail_placeholder: "E-Mail",
    driverPhone_placeholder: "Telefonnummer",
    driverPassword_placeholder: "Passwort (mind. 6 Zeichen)",
    register_submit: "Fahrer registrieren",
    driverType_label: "Fahrertyp",
    driverType_placeholder: "Fahrertyp wÃ¤hlen",
    driverType_independent: "SelbststÃ¤ndiger Fahrer",
    driverType_employee: "Angestellter Fahrer bei Taussil",
    driverType_required: "Bitte wÃ¤hle deinen Fahrertyp.",

    driver_login_title: "Fahrer-Login",
    loginEmail_placeholder: "E-Mail",
    loginPassword_placeholder: "Passwort",
    login_submit: "Anmelden",

    customerAddress_placeholder: "Kundenadresse eingeben",
    start_customer_nav: "Navigation starten",

    online_btn_online: "Status: Online",
    online_btn_offline: "Status: Offline",
    status_hint_online: "Du bist online und kannst AuftrÃ¤ge erhalten",
    status_hint_offline:
      "Du bist derzeit offline â€“ tippe, um online zu gehen",
    status_active_one: "Du hast eine aktive Bestellung",
    status_active_many: "Du hast {count} aktive Bestellungen",

    side_menu_title: "MenÃ¼",
    side_summary_title: "BestellÃ¼bersicht",
    active_section_btn: "Aktive Bestellungen",
    completed_section_btn: "FrÃ¼here Bestellungen",
    pricing_section_btn: "Lieferpreis-Einstellungen",
    logout: "Abmelden",

    summary_active_orders: "Bar",
    summary_completed_orders: "FrÃ¼here Bestellungen",
    summary_earnings: "Einnahmen",

summary_orders_count: "Bestellungen",
summary_total_km: "Gesamtstrecke",

    pricing_intro:
      "Lege deine Lieferpreise fest, damit jede Fahrt automatisch berechnet wird.",
    pricing_label_delivery:
      "Preis pro km vom HÃ¤ndler zur Lieferadresse (â‚¬)",
    pricing_include_to_merchant:
      "Distanz von meinem Standort zum HÃ¤ndler berÃ¼cksichtigen",
    pricing_use_same_for_both:
      "Gleichen Preis fÃ¼r beide Strecken verwenden",
    pricing_label_to_merchant:
      "Preis pro km von meinem Standort zum HÃ¤ndler (â‚¬)",
    pricing_free_km: "Anzahl der ersten kostenlosen Kilometer",
    pricing_save_btn: "Speichern",
    pricing_base_fee_hint:
      "Feste GrundgebÃ¼hr pro ausgelieferter Bestellung: {fee} â‚¬",
    pricing_error_delivery_price:
      "Bitte gib einen gÃ¼ltigen Preis pro Kilometer vom HÃ¤ndler zur Lieferadresse ein.",
    pricing_error_to_merchant_price:
      "Bitte gib einen gÃ¼ltigen Preis pro Kilometer von deinem Standort zum HÃ¤ndler ein.",
    pricing_saved_success:
      "Preis-Einstellungen wurden erfolgreich gespeichert.",
    pricing_mode_label: "Berechnungsmodell",
    pricing_mode_per_km: "Eigener Tarif (pro km)",
pricing_mode_independent: "Taussil-Tarif (empfohlen)",
pricing_mode_note_independent_only:
  "Der Taussil-Tarif ist das Standardmodell fÃ¼r angestellte Fahrer von Taussil. Der eigene Tarif ist vor allem fÃ¼r selbststÃ¤ndige Fahrer gedacht.",

pricing_info_link_label: "Wie wird der Taussil-Tarif berechnet?",
pricing_taussil_info_title: "Taussil-Tarif â€“ Berechnungsformel",
pricing_taussil_info_intro:
  "Dieser Tarif ist das Standardmodell von Taussil fÃ¼r angestellte Fahrer und wird generell empfohlen. SelbststÃ¤ndige Fahrer kÃ¶nnen ihn ebenfalls nutzen, wenn sie mÃ¶chten. Die Kosten hÃ¤ngen vom Bestellwert und von der Strecke HÃ¤ndler â†’ Kunde ab (die Strecke Fahrer â†’ HÃ¤ndler wird nicht berechnet).",

pricing_taussil_info_example1:
  "Beispiel 1 â€“ Bestellwert 20 â‚¬ und Strecke 5 km:\n" +
  "- GrundgebÃ¼hr: 3,50 â‚¬ (weil Bestellung â‰¤ 25 â‚¬)\n" +
  "- Erste 5 km: 5 Ã— 0,50 â‚¬ = 2,50 â‚¬\n" +
  "- Entfernungskosten: 2,50 â‚¬\n" +
  "- Gesamte LiefergebÃ¼hr: 3,50 â‚¬ + 2,50 â‚¬ = 6,00 â‚¬",

pricing_taussil_info_example2:
  "Beispiel 2 â€“ Bestellwert 40 â‚¬ und Strecke 15 km:\n" +
  "- GrundgebÃ¼hr: 40 â‚¬ Ã— 14 % = 5,60 â‚¬ (weil Bestellung > 25 â‚¬)\n" +
  "- Erste 7 km: 7 Ã— 0,50 â‚¬ = 3,50 â‚¬\n" +
  "- NÃ¤chste 5 km (7â€“12 km): 5 Ã— 0,80 â‚¬ = 4,00 â‚¬\n" +
  "- Verbleibende 3 km (> 12 km): 3 Ã— 1,00 â‚¬ = 3,00 â‚¬\n" +
  "- Entfernungskosten: 3,50 â‚¬ + 4,00 â‚¬ + 3,00 â‚¬ = 10,50 â‚¬\n" +
  "- Gesamte LiefergebÃ¼hr: 5,60 â‚¬ + 10,50 â‚¬ = 16,10 â‚¬",

pricing_taussil_info_note:
  "Wenn du den â€Taussil-Tarifâ€œ auswÃ¤hlst, wird diese Formel fÃ¼r jede abgeschlossene Bestellung automatisch angewendet. Es werden keine zusÃ¤tzlichen manuellen GrundgebÃ¼hren oder ZuschlÃ¤ge oben drauf gelegt.",

    footer_text:
      "Taussil e.K. â€“ Beta-Version im Testbetrieb. Nutzung auf eigene Verantwortung.",

    // Status labels
    status_pending: "Ausstehend",
    status_accepted: "Angenommen",
    status_inProgress: "In Bearbeitung",
    status_delivered: "Zugestellt",
    status_cancelled: "Storniert",
    status_rejected: "Abgelehnt",
    status_unknown: "Unbekannt",

    // Bottom sheet (current order)
    currentOrder_btn_startToMerchant:
      "Fahrt zum HÃ¤ndler starten",
    currentOrder_btn_delivered: "Als zugestellt markieren",
    currentOrder_btn_cancel: "Bestellung stornieren",
    currentOrder_expectedCost: "Voraussichtliche Kosten",

    // Order details modal
    orderDetails_title: "Bestelldetails",
    orderDetails_status: "Status",
    orderDetails_createdAt: "Bestellzeit",
    orderDetails_startedAt: "Start der Lieferung",
    orderDetails_deliveredAt: "Lieferzeit",
    orderDetails_merchant: "HÃ¤ndler",
    orderDetails_customerName: "Kundenname",
    orderDetails_address: "Adresse",
    orderDetails_totalDistance: "Gesamtstrecke",
    orderDetails_deliveryCost: "LiefergebÃ¼hr",
    orderDetails_notes: "Notizen",
    orderDetails_closeBtn: "SchlieÃŸen",
    orderDetails_paymentType: "Zahlungsart",
    orderDetails_cashAmount: "Barbetrag",

    paymentType_cash: "Barzahlung",
    paymentType_online: "Onlinezahlung",
    paymentType_unknown: "Zahlung",

    // New call modal
    newCall_title: "Neuer Auftrag vom HÃ¤ndler",
    newCall_merchant: "HÃ¤ndler",
    newCall_city: "Stadt",
    newCall_time: "Zeit",
    newCall_question: "MÃ¶chtest du diesen Auftrag annehmen?",
    newCall_btn_accept: "Annehmen",
    newCall_btn_reject: "Ablehnen",

    // Distance / units
    distance_km_short: "km",

    // Side list order cards
    orderCard_status: "Status",
    orderCard_address: "Adresse",
    orderCard_expectedCost: "Voraussichtliche Kosten",
    orderCard_totalDistance: "Gesamtstrecke",
    orderCard_finalCost: "EndgÃ¼ltige Kosten",

    // Alerts / confirmations
    alert_password_too_short:
      "Das Passwort muss mindestens 6 Zeichen lang sein.",
    alert_driver_register_success:
      "Fahrer wurde erfolgreich registriert!",
    alert_generic_error_prefix: "Fehler: ",
    alert_login_driver_only:
      "Diese OberflÃ¤che ist nur fÃ¼r Fahrer. Wenn du ein HÃ¤ndler bist, nutze bitte den HÃ¤ndler-Zugang.",
    alert_toggle_offline_with_active:
      "Du kannst nicht offline gehen oder die Sitzung schlieÃŸen, solange ein Auftrag aktiv ist. Bitte schlieÃŸe den Auftrag zuerst ab.",
    alert_geo_failed_prefix:
      "Standort konnte nicht ermittelt werden: ",
    alert_geo_not_supported:
      "Dein Browser unterstÃ¼tzt keine Standortbestimmung.",
    alert_status_update_failed:
      "Fehler beim Aktualisieren des Status: ",
    alert_logout_forbidden_while_busy:
      "Du kannst dich nicht abmelden, solange ein Auftrag aktiv oder ein Ruf angenommen ist. Bitte schlieÃŸe den Auftrag zuerst ab.",
    alert_logout_failed: "Fehler beim Abmelden: ",
    alert_address_geocode_failed:
      "Der Standort zu dieser Adresse konnte nicht ermittelt werden.",
    alert_customer_address_required:
      "Bitte zuerst eine gÃ¼ltige Kundenadresse auswÃ¤hlen.",
    alert_live_nav_not_supported:
      "Dein Browser unterstÃ¼tzt keine Live-Navigation.",
    alert_map_not_ready: "Die Karte ist noch nicht bereit.",
    alert_call_update_failed:
      "Fehler beim Aktualisieren des Rufs: ",
    alert_currentDriverNotSet:
      "Aktueller Fahrer ist nicht gesetzt.",
    alert_orderNotInDriverLog:
      "Bestellung wurde nicht im Fahrerverlauf gefunden.",
    alert_readOrderDetailsError:
      "Fehler beim Laden der Bestelldetails: ",
    alert_cannotAcceptCallNoDriver:
      "Ruf kann nicht angenommen werden: kein Fahrer gesetzt.",
    alert_acceptCallError:
      "Fehler beim Annehmen des Rufs: ",
    alert_rejectCallError:
      "Fehler beim Ablehnen des Rufs: ",
    alert_orderNotFound:
      "Diese Bestellung wurde nicht gefunden.",
    alert_driverStartError:
      "Fehler beim Registrieren des Fahrtbeginns: ",
    alert_driverStartSuccess:
      "Fahrt zum HÃ¤ndler wurde registriert und Karte gestartet.",
    alert_completeDeliveryError:
      "Fehler beim Abschluss der Lieferung: ",
    alert_completeDeliverySuccess:
      "Strecke und LiefergebÃ¼hr wurden berechnet und der Status aktualisiert.",
    confirm_cancel_order:
      "Bist du sicher, dass du diese Bestellung stornieren mÃ¶chtest?",
	      orderCancelledByMerchant_title: "Bestellung vom HÃ¤ndler storniert",
    orderCancelledByMerchant_message:
      "Diese Bestellung wurde vom HÃ¤ndler storniert. Die bereits gefahrene Strecke wird gemÃ¤ÃŸ deinen hinterlegten Preisen abgerechnet.",
    orderCancelledByMerchant_confirmBtn: "Ich verstehe",
    alert_no_active_target:
      "Derzeit gibt es kein aktives Ziel auf der Karte. Bitte starte zuerst die Fahrt zum HÃ¤ndler oder wÃ¤hle zunÃ¤chst die Adresse des Kunden.",
    vehicleType_label: "Fahrzeugtyp",
    vehicleType_placeholder: "Fahrzeugtyp wÃ¤hlen",
    vehicleType_car: "Auto",
    vehicleType_motorcycle: "Motorrad",
    vehicleType_bicycle: "Fahrrad",
        vehicleType_required: "Bitte wÃ¤hle deinen Fahrzeugtyp.",

    // âœ… Ø¬Ø¯ÙŠØ¯
    driver_not_approved_status_btn: "Freigabe ausstehend",
    driver_not_approved_hint:
      "Dein Konto wartet noch auf Freigabe durch die Plattform. Du kannst erst online gehen, wenn es freigegeben wurde.",
    alert_driver_not_approved:
      "Dein Konto wurde noch nicht freigegeben. Bitte warte, bis der Admin dich freischaltet.",
    driverApprovalModal_title: "Konto freigeschaltet",
    driverApprovalModal_message:
      "Dein Fahrer-Konto wurde freigeschaltet. Du kannst jetzt Fahrten und Lieferungen Ã¼bernehmen.",
    driverApprovalModal_button: "Starten",
// ğŸ‡©ğŸ‡ª German (de)
currentOrder_orderPrice: "Bestellwert",
currentOrder_btn_editPrice: "Preis bearbeiten",
orderDetails_orderPrice: "Bestellwert",
prompt_editOrderPrice: "Neuen Bestellwert eingeben (â‚¬):",
alert_invalid_orderPrice: "UngÃ¼ltiger Betrag.",
alert_orderPriceUpdated: "Bestellwert wurde erfolgreich aktualisiert.",
 "driver_extraOrders_add_title": "ZusÃ¤tzliche Bestellung vom gleichen Restaurant hinzufÃ¼gen",
  "driver_extraOrders_manual_title": "Neue Bestellung manuell hinzufÃ¼gen",
  "driver_extraOrders_scan_title": "Bestellung per QR-Code hinzufÃ¼gen",

  "extraOrder_price_placeholder": "Bestellbetrag eingeben",
  "extraOrder_cash_off": "Bar",
  "extraOrder_cash_on": "Bar",
  "extraOrder_confirm_btn": "Zusatzbestellung bestÃ¤tigen",
  "extraOrders_price_required": "Bitte den Preis eingeben",
extraOrders_no_active_call: "Es gibt keinen aktiven Auftrag fÃ¼r eine Zusatzbestellung.",
extraOrders_missing_merchant: "Das zugehÃ¶rige Restaurant fÃ¼r diesen Auftrag konnte nicht ermittelt werden.",
extraOrders_created_success: "Die Zusatzbestellung wurde erfolgreich erstellt.",
extraOrders_create_failed: "Fehler beim Erstellen der Zusatzbestellung: ",
  },

  ar: {
    mainHeader: "Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙˆØµÙŠÙ„ â€” ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚",
    tab_register: "ØªØ³Ø¬ÙŠÙ„",
    tab_login: "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„",

    driver_register_title: "ØªØ³Ø¬ÙŠÙ„ Ø³Ø§Ø¦Ù‚",
    firstName_placeholder: "Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„",
    lastName_placeholder: "Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ø§Ù†ÙŠ",
    address_placeholder: "Ø§Ù„Ø¹Ù†ÙˆØ§Ù†",
    city_placeholder: "Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©",
    driverEmail_placeholder: "Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ",
    driverPhone_placeholder: "Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ",
    driverPassword_placeholder: "ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± (6+ Ø­Ø±ÙˆÙ)",
    register_submit: "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø³Ø§Ø¦Ù‚",
    driverType_label: "Ù†ÙˆØ¹ Ø§Ù„Ø³Ø§Ø¦Ù‚",
    driverType_placeholder: "Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø³Ø§Ø¦Ù‚",
    driverType_independent: "Ø³Ø§Ø¦Ù‚ Ù…Ø³ØªÙ‚Ù„",
    driverType_employee: "Ø³Ø§Ø¦Ù‚ Ù…ÙˆØ¸Ù Ù„Ø¯Ù‰ Taussil",
    driverType_required: "Ø±Ø¬Ø§Ø¡Ù‹ Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø³Ø§Ø¦Ù‚.",

    driver_login_title: "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ (Ø³Ø§Ø¦Ù‚)",
    loginEmail_placeholder: "Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ",
    loginPassword_placeholder: "ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±",
    login_submit: "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„",

    customerAddress_placeholder: "Ø£Ø¯Ø®Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„",
    start_customer_nav: "Ø¨Ø¯Ø¡ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡",

    online_btn_online: "Ø§Ù„Ø­Ø§Ù„Ø©: Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†",
    online_btn_offline: "Ø§Ù„Ø­Ø§Ù„Ø©: Ø£ÙˆÙÙ„Ø§ÙŠÙ†",
    status_hint_online:
      "Ø£Ù†Øª Ù…ØªØµÙ„ Ø§Ù„Ø¢Ù† ÙˆÙ…Ø³ØªØ¹Ø¯ Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª",
    status_hint_offline:
      "Ø£Ù†Øª Ø£ÙˆÙÙ„Ø§ÙŠÙ† Ø­Ø§Ù„ÙŠØ§Ù‹ â€” Ø§Ø¶ØºØ· Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø©",
    status_active_one: "Ù„Ø¯ÙŠÙƒ Ø·Ù„Ø¨ ÙˆØ§Ø­Ø¯ Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°",
    status_active_many: "Ù„Ø¯ÙŠÙƒ {count} Ø·Ù„Ø¨Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°",

    side_menu_title: "Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©",
    side_summary_title: "Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨Ø§Øª",
    active_section_btn: "Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©",
    completed_section_btn: "Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©",
    pricing_section_btn: "Ø¶Ø¨Ø· ØªÙƒØ§Ù„ÙŠÙ Ø§Ù„ØªÙˆØµÙŠÙ„",
    logout: "ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬",

    summary_active_orders: "Ø§Ù„ÙƒØ§Ø´",
    summary_completed_orders: "Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©",
    summary_earnings: "Ø§Ù„Ø£Ø±Ø¨Ø§Ø­",

summary_orders_count: "Ø§Ù„Ø·Ù„Ø¨Ø§Øª",
summary_total_km: "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ù…Ù‚Ø·ÙˆØ¹Ø©",

    pricing_intro:
      "Ù‚Ù… Ø¨Ø¶Ø¨Ø· ØªØ³Ø¹ÙŠØ±Ø© Ø§Ù„ØªÙˆØµÙŠÙ„ Ù„ÙŠØªÙ… Ø§Ø­ØªØ³Ø§Ø¨ ØªÙƒÙ„ÙØ© ÙƒÙ„ Ø±Ø­Ù„Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.",
    pricing_label_delivery:
      "Ø³Ø¹Ø± Ø§Ù„ÙƒÙŠÙ„ÙˆÙ…ØªØ± Ù…Ù† Ø§Ù„ØªØ§Ø¬Ø± Ø¥Ù„Ù‰ Ù†Ù‚Ø·Ø© Ø§Ù„ØªØ³Ù„ÙŠÙ… (â‚¬)",
    pricing_include_to_merchant:
      "Ø§Ø­ØªØ³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§ÙØ© Ù…Ù† Ù…ÙˆÙ‚Ø¹ÙŠ Ø¥Ù„Ù‰ Ø§Ù„ØªØ§Ø¬Ø±",
    pricing_use_same_for_both:
      "Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†ÙØ³ Ø§Ù„Ø³Ø¹Ø± Ù„Ù„Ù…Ø³Ø§Ø±ÙŠÙ†",
    pricing_label_to_merchant:
      "Ø³Ø¹Ø± Ø§Ù„ÙƒÙŠÙ„ÙˆÙ…ØªØ± Ù…Ù† Ù…ÙˆÙ‚Ø¹ÙŠ Ø¥Ù„Ù‰ Ø§Ù„ØªØ§Ø¬Ø± (â‚¬)",
    pricing_free_km: "Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙŠÙ„ÙˆÙ…ØªØ±Ø§Øª Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ© Ø§Ù„Ø£ÙˆÙ„Ù‰",
    pricing_save_btn: "Ø­ÙØ¸",
    pricing_base_fee_hint:
      "Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ø§Ù„Ø«Ø§Ø¨Øª Ù„ÙƒÙ„ Ø·Ù„Ø¨ ÙŠØªÙ… ØªØ³Ù„ÙŠÙ…Ù‡: {fee} â‚¬",
    pricing_error_delivery_price:
      "Ø±Ø¬Ø§Ø¡Ù‹ Ø£Ø¯Ø®Ù„ Ø³Ø¹Ø±Ù‹Ø§ ØµØ§Ù„Ø­Ù‹Ø§ Ù„ÙƒÙ„ ÙƒÙŠÙ„ÙˆÙ…ØªØ± Ù…Ù† Ø§Ù„ØªØ§Ø¬Ø± Ø¥Ù„Ù‰ Ù†Ù‚Ø·Ø© Ø§Ù„ØªØ³Ù„ÙŠÙ….",
    pricing_error_to_merchant_price:
      "Ø±Ø¬Ø§Ø¡Ù‹ Ø£Ø¯Ø®Ù„ Ø³Ø¹Ø±Ù‹Ø§ ØµØ§Ù„Ø­Ù‹Ø§ Ù„ÙƒÙ„ ÙƒÙŠÙ„ÙˆÙ…ØªØ± Ù…Ù† Ù…ÙˆÙ‚Ø¹Ùƒ Ø¥Ù„Ù‰ Ø§Ù„ØªØ§Ø¬Ø±.",
    pricing_saved_success: "ØªÙ… Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ³Ø¹ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­.",
    pricing_mode_label: "Ù†Ù…ÙˆØ°Ø¬ Ø§Ø­ØªØ³Ø§Ø¨ Ø§Ù„ØªÙƒÙ„ÙØ©",
    pricing_mode_per_km: "ØªØ³Ø¹ÙŠØ±Ø© Ø®Ø§ØµØ©",
pricing_mode_independent: "ØªØ³Ø¹ÙŠØ±Ø© Taussil (Ù…Ø³ØªØ­Ø³Ù†Ø©)",
pricing_mode_note_independent_only:
  "ØªØ³Ø¹ÙŠØ±Ø© Taussil Ù‡ÙŠ Ø§Ù„ØªØ³Ø¹ÙŠØ±Ø© Ø§Ù„Ù‚ÙŠØ§Ø³ÙŠØ© Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø© Ù„Ù…ÙˆØ¸ÙÙŠ TaussilØŒ Ø¨ÙŠÙ†Ù…Ø§ Ø§Ù„ØªØ³Ø¹ÙŠØ±Ø© Ø§Ù„Ø®Ø§ØµØ© Ù…ÙˆØ¬Ù‘Ù‡Ø© Ø¨Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù„Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ† Ø§Ù„Ù…Ø³ØªÙ‚Ù„ÙŠÙ†.",

pricing_info_link_label: "Ø´Ø±Ø­ ØªØ³Ø¹ÙŠØ±Ø© Taussil",
pricing_taussil_info_title: "Ù…Ø¹Ø§Ø¯Ù„Ø© ØªØ³Ø¹ÙŠØ±Ø© Taussil",
pricing_taussil_info_intro:
  "Ù‡Ø°Ù‡ Ø§Ù„ØªØ³Ø¹ÙŠØ±Ø© Ù‡ÙŠ Ø§Ù„ØªØ³Ø¹ÙŠØ±Ø© Ø§Ù„Ù‚ÙŠØ§Ø³ÙŠØ© Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø© Ù…Ù† Taussil Ù„Ù…ÙˆØ¸ÙÙŠ Ø§Ù„Ø´Ø±ÙƒØ©ØŒ ÙˆÙ‡ÙŠ Ø§Ù„Ù…ÙˆØµÙ‰ Ø¨Ù‡Ø§ Ø¨Ø´ÙƒÙ„ Ø¹Ø§Ù…. ÙˆÙŠÙ…ÙƒÙ† Ø£ÙŠØ¶Ø§Ù‹ Ù„Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ† Ø§Ù„Ù…Ø³ØªÙ‚Ù„ÙŠÙ† Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ Ø¥Ø°Ø§ Ø±ØºØ¨ÙˆØ§. ÙŠØªÙ… Ø§Ø­ØªØ³Ø§Ø¨ Ø§Ù„ØªÙƒÙ„ÙØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø·Ù„Ø¨ØŒ ÙˆØ¹Ù„Ù‰ Ù…Ø³Ø§ÙØ© Ø§Ù„Ù…ØªØ¬Ø± â†’ Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙÙ‚Ø· (Ù…Ø³Ø§ÙØ© Ø§Ù„Ø³Ø§Ø¦Ù‚ â†’ Ø§Ù„Ù…ØªØ¬Ø± Ù„Ø§ ØªØ¯Ø®Ù„ ÙÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨).",

pricing_taussil_info_example1:
  "Ù…Ø«Ø§Ù„ 1 â€“ Ø·Ù„Ø¨ Ø¨Ù‚ÙŠÙ…Ø© 20 â‚¬ ÙˆÙ…Ø³Ø§ÙØ© 5 ÙƒÙ…:\n" +
  "- Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ (GrundgebÃ¼hr): 3,50 â‚¬ (Ù„Ø£Ù† Ù‚ÙŠÙ…Ø© Ø§Ù„Ø·Ù„Ø¨ â‰¤ 25 â‚¬)\n" +
  "- Ø£ÙˆÙ„ 5 ÙƒÙ…: 5 Ã— 0,50 â‚¬ = 2,50 â‚¬\n" +
  "- ØªÙƒÙ„ÙØ© Ø§Ù„Ù…Ø³Ø§ÙØ©: 2,50 â‚¬\n" +
  "- Ø¥Ø¬Ù…Ø§Ù„ÙŠ ØªÙƒÙ„ÙØ© Ø§Ù„ØªÙˆØµÙŠÙ„: 3,50 â‚¬ + 2,50 â‚¬ = 6,00 â‚¬",

pricing_taussil_info_example2:
  "Ù…Ø«Ø§Ù„ 2 â€“ Ø·Ù„Ø¨ Ø¨Ù‚ÙŠÙ…Ø© 40 â‚¬ ÙˆÙ…Ø³Ø§ÙØ© 15 ÙƒÙ…:\n" +
  "- Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ (GrundgebÃ¼hr): 40 â‚¬ Ã— â€14â€% = 5,60 â‚¬ (Ù„Ø£Ù† Ù‚ÙŠÙ…Ø© Ø§Ù„Ø·Ù„Ø¨ > 25 â‚¬)\n" +
  "- Ø£ÙˆÙ„ 7 ÙƒÙ…: 7 Ã— 0,50 â‚¬ = 3,50 â‚¬\n" +
  "- Ø§Ù„Ù€ 5 ÙƒÙ… Ø§Ù„ØªØ§Ù„ÙŠØ© (Ù…Ù† 7 Ø¥Ù„Ù‰ 12): 5 Ã— 0,80 â‚¬ = 4,00 â‚¬\n" +
  "- Ø§Ù„Ù€ 3 ÙƒÙ… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© (ÙÙˆÙ‚ 12 ÙƒÙ…): 3 Ã— 1,00 â‚¬ = 3,00 â‚¬\n" +
  "- ØªÙƒÙ„ÙØ© Ø§Ù„Ù…Ø³Ø§ÙØ©: 3,50 â‚¬ + 4,00 â‚¬ + 3,00 â‚¬ = 10,50 â‚¬\n" +
  "- Ø¥Ø¬Ù…Ø§Ù„ÙŠ ØªÙƒÙ„ÙØ© Ø§Ù„ØªÙˆØµÙŠÙ„: 5,60 â‚¬ + 10,50 â‚¬ = 16,10 â‚¬",

pricing_taussil_info_note:
  "Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± Â«ØªØ³Ø¹ÙŠØ±Ø© TaussilÂ» ÙŠØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù„Ù‰ ÙƒÙ„ Ø·Ù„Ø¨ Ù…ÙƒØªÙ…Ù„ØŒ Ø¨Ø¯ÙˆÙ† Ø¥Ø¶Ø§ÙØ© Ø±Ø³ÙˆÙ… Ø«Ø§Ø¨ØªØ© Ø£Ùˆ Ø²ÙŠØ§Ø¯Ø§Øª ÙŠØ¯ÙˆÙŠØ© Ø¥Ø¶Ø§ÙÙŠØ© ÙÙˆÙ‚Ù‡Ø§.",

    pricing_mode_note_independent_only:
  "ØªØ³Ø¹ÙŠØ±Ø© Taussil Ù…Ø®ØµØµØ© Ù„Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ† Ø§Ù„Ù…Ø³ØªÙ‚Ù„ÙŠÙ† ÙÙ‚Ø·.",

    footer_text:
      "Taussil e.K. â€“ Beta-Version im Testbetrieb. Nutzung auf eigene Verantwortung.",

    // Status labels
    status_pending: "Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±",
    status_accepted: "Ù…Ù‚Ø¨ÙˆÙ„",
    status_inProgress: "Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°",
    status_delivered: "ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…",
    status_cancelled: "Ù…Ù„ØºÙ‰",
    status_rejected: "Ù…Ø±ÙÙˆØ¶",
    status_unknown: "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ",

    // Bottom sheet (current order)
    currentOrder_btn_startToMerchant:
      "Ø¨Ø¯Ø¡ Ø§Ù„ØªÙˆØ¬Ù‡ Ø¥Ù„Ù‰ Ø§Ù„ØªØ§Ø¬Ø±",
    currentOrder_btn_delivered: "ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…",
    currentOrder_btn_cancel: "Ø¥Ù„ØºØ§Ø¡",
    currentOrder_expectedCost: "Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©",

    // Order details modal
    orderDetails_title: "ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨",
    orderDetails_status: "Ø§Ù„Ø­Ø§Ù„Ø©",
    orderDetails_createdAt: "ÙˆÙ‚Øª Ø§Ù„Ø·Ù„Ø¨",
    orderDetails_startedAt: "Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ØªÙˆØµÙŠÙ„",
    orderDetails_deliveredAt: "ÙˆÙ‚Øª Ø§Ù„ØªØ³Ù„ÙŠÙ…",
    orderDetails_merchant: "Ø§Ù„ØªØ§Ø¬Ø±",
    orderDetails_customerName: "Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„",
    orderDetails_address: "Ø§Ù„Ø¹Ù†ÙˆØ§Ù†",
    orderDetails_totalDistance: "Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„ÙƒÙ„ÙŠØ©",
    orderDetails_deliveryCost: "ØªÙƒÙ„ÙØ© Ø§Ù„ØªÙˆØµÙŠÙ„",
    orderDetails_notes: "Ù…Ù„Ø§Ø­Ø¸Ø§Øª",
    orderDetails_closeBtn: "Ø¥ØºÙ„Ø§Ù‚",
    orderDetails_paymentType: "Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹",
    orderDetails_cashAmount: "Ù…Ø¨Ù„Øº Ø§Ù„ÙƒØ§Ø´",

    paymentType_cash: "Ø¯ÙØ¹ Ù†Ù‚Ø¯ÙŠ",
    paymentType_online: "Ø¯ÙØ¹ Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†",
    paymentType_unknown: "Ø¯ÙØ¹",

    // New call modal
    newCall_title: "Ù†Ø¯Ø§Ø¡ Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ø§Ù„ØªØ§Ø¬Ø±",
    newCall_merchant: "Ø§Ù„Ù…ØªØ¬Ø±",
    newCall_city: "Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©",
    newCall_time: "Ø§Ù„ÙˆÙ‚Øª",
    newCall_question: "Ù‡Ù„ ØªØ±ØºØ¨ ÙÙŠ Ù‚Ø¨ÙˆÙ„ Ù‡Ø°Ø§ Ø§Ù„Ù†Ø¯Ø§Ø¡ØŸ",
    newCall_btn_accept: "Ù‚Ø¨ÙˆÙ„",
    newCall_btn_reject: "Ø±ÙØ¶",

    // Distance / units
    distance_km_short: "ÙƒÙ…",

    // Side list order cards
    orderCard_status: "Ø§Ù„Ø­Ø§Ù„Ø©",
    orderCard_address: "Ø§Ù„Ø¹Ù†ÙˆØ§Ù†",
    orderCard_expectedCost: "Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©",
    orderCard_totalDistance: "Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„ÙƒÙ„ÙŠØ©",
    orderCard_finalCost: "Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©",

    // Alerts / confirmations
    alert_password_too_short:
      "ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„.",
    alert_driver_register_success: "ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø³Ø§Ø¦Ù‚ Ø¨Ù†Ø¬Ø§Ø­!",
    alert_generic_error_prefix: "Ø®Ø·Ø£: ",
    alert_login_driver_only:
      "Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ù…Ø®ØµØµØ© Ù„Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ† ÙÙ‚Ø·. Ø¥Ù† ÙƒÙ†Øª ØªØ§Ø¬Ø±Ù‹Ø§ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø±Ø§Ø¨Ø· ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªØ§Ø¬Ø±.",
    alert_toggle_offline_with_active:
      "Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªØ­ÙˆÙ„ Ø¥Ù„Ù‰ Ø£ÙˆÙÙ„Ø§ÙŠÙ† Ø£Ùˆ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø¬Ù„Ø³Ø© Ø£Ø«Ù†Ø§Ø¡ ÙˆØ¬ÙˆØ¯ Ø·Ù„Ø¨ Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°. ÙŠØ±Ø¬Ù‰ Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨ Ø£ÙˆÙ„Ø§Ù‹.",
    alert_geo_failed_prefix: "ØªØ¹Ø°Ø± Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹: ",
    alert_geo_not_supported:
      "Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ.",
    alert_status_update_failed: "Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©: ",
    alert_logout_forbidden_while_busy:
      "Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø£Ø«Ù†Ø§Ø¡ ÙˆØ¬ÙˆØ¯ Ø·Ù„Ø¨ Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ° Ø£Ùˆ Ù†Ø¯Ø§Ø¡ Ù…Ù‚Ø¨ÙˆÙ„. ÙŠØ±Ø¬Ù‰ Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨ Ø£ÙˆÙ„Ø§Ù‹.",
    alert_logout_failed: "Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬: ",
    alert_address_geocode_failed:
      "ØªØ¹Ø°Ø± Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…ÙˆÙ‚Ø¹ Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†.",
    alert_customer_address_required:
      "Ø±Ø¬Ø§Ø¡Ù‹ Ø§Ø®ØªØ± Ø¹Ù†ÙˆØ§Ù†Ø§Ù‹ ØµØ­ÙŠØ­Ø§Ù‹ Ù„Ù„Ø¹Ù…ÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹.",
    alert_live_nav_not_supported:
      "Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ø­ÙŠ.",
    alert_map_not_ready: "Ø§Ù„Ø®Ø±ÙŠØ·Ø© ØºÙŠØ± Ø¬Ø§Ù‡Ø²Ø© Ø¨Ø¹Ø¯.",
    alert_call_update_failed:
      "Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¯Ø§Ø¡: ",
    alert_currentDriverNotSet:
      "Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø³Ø§Ø¦Ù‚ Ø§Ù„Ø­Ø§Ù„ÙŠ.",
    alert_orderNotInDriverLog:
      "Ø§Ù„Ø·Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø³Ø¬Ù„ Ø§Ù„Ø³Ø§Ø¦Ù‚.",
    alert_readOrderDetailsError:
      "Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù‚Ø±Ø§Ø¡Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨: ",
    alert_cannotAcceptCallNoDriver:
      "Ù„Ø§ ÙŠÙ…ÙƒÙ† Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ù†Ø¯Ø§Ø¡: Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø³Ø§Ø¦Ù‚.",
    alert_acceptCallError:
      "Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ù†Ø¯Ø§Ø¡: ",
    alert_rejectCallError:
      "Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø±ÙØ¶ Ø§Ù„Ù†Ø¯Ø§Ø¡: ",
    alert_orderNotFound: "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨.",
    alert_driverStartError:
      "Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø±Ø­Ù„Ø©: ",
    alert_driverStartSuccess:
      "ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø±Ø­Ù„Ø© Ù†Ø­Ùˆ Ø§Ù„ØªØ§Ø¬Ø± ÙˆØªÙ… ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ø®Ø±ÙŠØ·Ø©.",
    alert_completeDeliveryError:
      "Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„ØªÙˆØµÙŠÙ„: ",
    alert_completeDeliverySuccess:
      "ØªÙ… Ø­Ø³Ø§Ø¨ Ù…Ø³Ø§ÙØ© ÙˆØªÙƒÙ„ÙØ© Ø§Ù„ØªÙˆØµÙŠÙ„ ÙˆØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨.",
    confirm_cancel_order:
      "Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ù„ØºØ§Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ØŸ",
	      orderCancelledByMerchant_title: "ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„ØªØ§Ø¬Ø±",
    orderCancelledByMerchant_message:
      "ØªÙ… Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„ØªØ§Ø¬Ø±. Ø³ÙŠØªÙ… Ø§Ø­ØªØ³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„ØªÙŠ Ù‚Ø·Ø¹ØªÙ‡Ø§ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø£Ø³Ø¹Ø§Ø±Ùƒ Ø§Ù„Ù…Ø³Ø¬Ù‘Ù„Ø©.",
    orderCancelledByMerchant_confirmBtn: "Ø£ØªÙÙ‡Ù… Ø°Ù„Ùƒ",
    alert_no_active_target:
      "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù‡Ø¯Ù Ù†Ø´Ø· Ø­Ø§Ù„ÙŠØ§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©. Ø±Ø¬Ø§Ø¡Ù‹ Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªÙˆØ¬Ù‡ Ø¥Ù„Ù‰ Ø§Ù„Ù…ØªØ¬Ø± Ø£Ùˆ Ø§Ø®ØªØ± Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹.",
    vehicleType_label: "Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©",
    vehicleType_placeholder: "Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©",
    vehicleType_car: "Ø³ÙŠØ§Ø±Ø©",
    vehicleType_motorcycle: "Ø¯Ø±Ø§Ø¬Ø© Ù†Ø§Ø±ÙŠØ©",
    vehicleType_bicycle: "Ø¯Ø±Ø§Ø¬Ø© Ù‡ÙˆØ§Ø¦ÙŠØ©",
        vehicleType_required: "Ø±Ø¬Ø§Ø¡Ù‹ Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©.",

    // âœ… Ø¬Ø¯ÙŠØ¯
    driver_not_approved_status_btn: "Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ø­Ø³Ø§Ø¨",
    driver_not_approved_hint:
      "Ø­Ø³Ø§Ø¨Ùƒ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ù…Ù† Ù‚ÙØ¨Ù„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©. Ù„Ù† ØªØªÙ…ÙƒÙ† Ù…Ù† ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† Ù‚Ø¨Ù„ Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ø­Ø³Ø§Ø¨.",
    alert_driver_not_approved:
      "Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† Ù„Ø£Ù† Ø­Ø³Ø§Ø¨Ùƒ Ù„Ù… ÙŠØªÙ… Ø§Ø¹ØªÙ…Ø§Ø¯Ù‡ Ø¨Ø¹Ø¯. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø­ØªÙ‰ ÙŠØªÙ… Ø§Ø¹ØªÙ…Ø§Ø¯Ùƒ.",
    driverApprovalModal_title: "ØªÙ… ØªÙØ¹ÙŠÙ„ Ø­Ø³Ø§Ø¨Ùƒ",
    driverApprovalModal_message:
      "Ù„Ù‚Ø¯ ØªÙ… ØªÙØ¹ÙŠÙ„ Ø­Ø³Ø§Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­ ÙˆÙŠÙ…ÙƒÙ†Ùƒ Ø¨Ø¯Ø¡ ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø±Ø­Ù„Ø§Øª ÙˆØ®Ø¯Ù…Ø© Ø§Ù„ØªÙˆØµÙŠÙ„ Ù…Ø¨Ø§Ø´Ø±Ø©.",
    driverApprovalModal_button: "Ø¥Ø¨Ø¯Ø£",
// ğŸ‡¸ğŸ‡¦ Arabic (ar)
currentOrder_orderPrice: "Ù‚ÙŠÙ…Ø© Ø§Ù„Ø·Ù„Ø¨",
currentOrder_btn_editPrice: "ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø¹Ø±",
orderDetails_orderPrice: "Ù‚ÙŠÙ…Ø© Ø§Ù„Ø·Ù„Ø¨",
prompt_editOrderPrice: "Ø£Ø¯Ø®Ù„ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (â‚¬):",
alert_invalid_orderPrice: "Ù‚ÙŠÙ…Ø© ØºÙŠØ± ØµØ§Ù„Ø­Ø©.",
alert_orderPriceUpdated: "ØªÙ… ØªØ­Ø¯ÙŠØ« Ù‚ÙŠÙ…Ø© Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­.",
  "driver_extraOrders_add_title": "Ø¥Ø¶Ø§ÙØ© Ø·Ù„Ø¨ Ù…Ù† Ù†ÙØ³ Ø§Ù„Ù…Ø·Ø¹Ù…",
  "driver_extraOrders_manual_title": "Ø¥Ø¶Ø§ÙØ© Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ ÙŠØ¯ÙˆÙŠÙ‹Ø§",
  "driver_extraOrders_scan_title": "Ø¥Ø¶Ø§ÙØ© Ø·Ù„Ø¨ Ø¹Ø¨Ø± Ø±Ù…Ø² QR",

  "extraOrder_price_placeholder": "Ø£Ø¯Ø®Ù„ Ø³Ø¹Ø± Ø§Ù„Ø·Ù„Ø¨",
  "extraOrder_cash_off": "ÙƒØ§Ø´",
  "extraOrder_cash_on": "ÙƒØ§Ø´",
  "extraOrder_confirm_btn": "ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ø¶Ø§ÙØ©",
"extraOrders_price_required": "Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø³Ø¹Ø±",
extraOrders_no_active_call: "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨ Ù†Ø´Ø· Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ ÙƒØ£Ø³Ø§Ø³ Ù„Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ.",
extraOrders_missing_merchant: "Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø·Ø¹Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨.",
extraOrders_created_success: "ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ Ø¨Ù†Ø¬Ø§Ø­.",
extraOrders_create_failed: "ØªØ¹Ø°Ù‘Ø± Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ: ",
  },
    tr: {
    // Main header and tabs
    mainHeader: "Teslimat Sistemi â€” SÃ¼rÃ¼cÃ¼ ArayÃ¼zÃ¼",
    tab_register: "KayÄ±t ol",
    tab_login: "GiriÅŸ yap",

    // Register driver
    driver_register_title: "SÃ¼rÃ¼cÃ¼ kaydÄ±",
    firstName_placeholder: "Ad",
    lastName_placeholder: "Soyad",
    address_placeholder: "Adres",
    city_placeholder: "Åehir",
    driverEmail_placeholder: "E-posta",
    driverPhone_placeholder: "Telefon numarasÄ±",
    driverPassword_placeholder: "Åifre (en az 6 karakter)",
    register_submit: "SÃ¼rÃ¼cÃ¼yÃ¼ kaydet",
    driverType_label: "SÃ¼rÃ¼cÃ¼ tipi",
    driverType_placeholder: "SÃ¼rÃ¼cÃ¼ tipi seÃ§in",
    driverType_independent: "BaÄŸÄ±msÄ±z sÃ¼rÃ¼cÃ¼",
    driverType_employee: "Taussil Ã§alÄ±ÅŸanÄ± sÃ¼rÃ¼cÃ¼",
    driverType_required: "LÃ¼tfen sÃ¼rÃ¼cÃ¼ tipinizi seÃ§in.",

    // Login
    driver_login_title: "SÃ¼rÃ¼cÃ¼ giriÅŸi",
    loginEmail_placeholder: "E-posta",
    loginPassword_placeholder: "Åifre",
    login_submit: "GiriÅŸ yap",

    // Customer address
    customerAddress_placeholder: "MÃ¼ÅŸteri adresini girin",
    start_customer_nav: "Navigasyonu baÅŸlat",

    // Online/offline button + bottom capsule
    online_btn_online: "Durum: Ã‡evrimiÃ§i",
    online_btn_offline: "Durum: Ã‡evrimdÄ±ÅŸÄ±",
    status_hint_online: "Ã‡evrimiÃ§isiniz ve sipariÅŸ almaya hazÄ±rsÄ±nÄ±z",
    status_hint_offline: "Åu anda Ã§evrimdÄ±ÅŸÄ±sÄ±nÄ±z â€” Ã§evrimiÃ§i olmak iÃ§in dokunun",
    status_active_one: "1 aktif sipariÅŸiniz var",
    status_active_many: "{count} aktif sipariÅŸiniz var",

    // Side panel
    side_menu_title: "MenÃ¼",
    side_summary_title: "SipariÅŸ Ã¶zeti",
    active_section_btn: "Aktif sipariÅŸler",
    completed_section_btn: "GeÃ§miÅŸ sipariÅŸler",
    pricing_section_btn: "Teslimat fiyatÄ±",
    logout: "Ã‡Ä±kÄ±ÅŸ yap",

    // Stats
    summary_active_orders: "Nakit",
    summary_completed_orders: "GeÃ§miÅŸ sipariÅŸler",
    summary_earnings: "KazanÃ§lar",

summary_orders_count: "sipariÅŸ",
summary_total_km: "Toplam mesafe",

    // Pricing (delivery settings)
    pricing_intro:
      "Her yolculuÄŸun otomatik hesaplanmasÄ± iÃ§in teslimat Ã¼cretini ayarlayÄ±n.",
    pricing_label_delivery: "Ä°ÅŸletmeden teslim noktasÄ±na km baÅŸÄ± fiyat (â‚¬)",
    pricing_include_to_merchant: "Konumumdan iÅŸletmeye olan mesafeyi dahil et",
    pricing_use_same_for_both: "Her iki rota iÃ§in aynÄ± fiyatÄ± kullan",
    pricing_label_to_merchant:
      "Konumumdan iÅŸletmeye km baÅŸÄ± fiyat (â‚¬)",
    pricing_free_km: "Ä°lk Ã¼cretsiz kilometre sayÄ±sÄ±",
    pricing_save_btn: "Kaydet",
    pricing_base_fee_hint:
      "Teslim edilen her sipariÅŸ iÃ§in sabit temel Ã¼cret: {fee} â‚¬",
    pricing_error_delivery_price:
      "LÃ¼tfen iÅŸletmeden teslim noktasÄ±na km baÅŸÄ±na geÃ§erli bir fiyat girin.",
    pricing_error_to_merchant_price:
      "LÃ¼tfen konumunuzdan iÅŸletmeye km baÅŸÄ±na geÃ§erli bir fiyat girin.",
    pricing_saved_success: "FiyatlandÄ±rma ayarlarÄ± baÅŸarÄ±yla kaydedildi.",
    pricing_mode_label: "FiyatlandÄ±rma modeli",
    pricing_mode_per_km: "Ã–zel fiyatlandÄ±rma (km bazlÄ±)",
pricing_mode_independent: "Taussil fiyatlandÄ±rmasÄ± (Ã¶nerilen)",
pricing_mode_note_independent_only:
  "Taussil fiyatlandÄ±rmasÄ±, Taussil'e baÄŸlÄ± Ã§alÄ±ÅŸan sÃ¼rÃ¼cÃ¼ler iÃ§in standart modeldir. Ã–zel fiyatlandÄ±rma ise aÄŸÄ±rlÄ±klÄ± olarak baÄŸÄ±msÄ±z sÃ¼rÃ¼cÃ¼ler iÃ§indir.",

pricing_info_link_label: "Taussil fiyatlandÄ±rmasÄ± nasÄ±l hesaplanÄ±r?",
pricing_taussil_info_title: "Taussil fiyatlandÄ±rma formÃ¼lÃ¼",
pricing_taussil_info_intro:
  "Bu fiyatlandÄ±rma, Taussil'in kadrolu sÃ¼rÃ¼cÃ¼leri iÃ§in kullanÄ±lan standart modeldir ve genel olarak tavsiye edilir. BaÄŸÄ±msÄ±z sÃ¼rÃ¼cÃ¼ler isterlerse bunu da kullanabilir. Ãœcret, sipariÅŸ tutarÄ±na ve yalnÄ±zca iÅŸletmeden mÃ¼ÅŸteriye olan mesafeye gÃ¶re hesaplanÄ±r (sÃ¼rÃ¼cÃ¼ â†’ iÅŸletme mesafesi hesaba katÄ±lmaz).",

pricing_taussil_info_example1:
  "Ã–rnek 1 â€“ SipariÅŸ tutarÄ± 20 â‚¬ ve mesafe 5 km:\n" +
  "- Temel Ã¼cret (GrundgebÃ¼hr): 3,50 â‚¬ (sipariÅŸ â‰¤ 25 â‚¬ olduÄŸu iÃ§in)\n" +
  "- Ä°lk 5 km: 5 Ã— 0,50 â‚¬ = 2,50 â‚¬\n" +
  "- Mesafe Ã¼creti: 2,50 â‚¬\n" +
  "- Toplam teslimat Ã¼creti: 3,50 â‚¬ + 2,50 â‚¬ = 6,00 â‚¬",

pricing_taussil_info_example2:
  "Ã–rnek 2 â€“ SipariÅŸ tutarÄ± 40 â‚¬ ve mesafe 15 km:\n" +
  "- Temel Ã¼cret (GrundgebÃ¼hr): 40 â‚¬ Ã— %14 = 5,60 â‚¬ (sipariÅŸ > 25 â‚¬ olduÄŸu iÃ§in)\n" +
  "- Ä°lk 7 km: 7 Ã— 0,50 â‚¬ = 3,50 â‚¬\n" +
  "- Sonraki 5 km (7â€“12 km): 5 Ã— 0,80 â‚¬ = 4,00 â‚¬\n" +
  "- Kalan 3 km (> 12 km): 3 Ã— 1,00 â‚¬ = 3,00 â‚¬\n" +
  "- Mesafe Ã¼creti: 3,50 â‚¬ + 4,00 â‚¬ + 3,00 â‚¬ = 10,50 â‚¬\n" +
  "- Toplam teslimat Ã¼creti: 5,60 â‚¬ + 10,50 â‚¬ = 16,10 â‚¬",

pricing_taussil_info_note:
  "\"Taussil fiyatlandÄ±rmasÄ±nÄ±\" seÃ§tiÄŸinizde bu formÃ¼l, tamamlanan her sipariÅŸ iÃ§in otomatik olarak uygulanÄ±r. Ãœzerine ek manuel temel Ã¼cret veya ilave zam eklenmez.",

    // Footer
    footer_text:
      "Taussil e.K. â€“ Beta-Version im Testbetrieb. Nutzung auf eigene Verantwortung.",

    // Status labels
    status_pending: "Beklemede",
    status_accepted: "Kabul edildi",
    status_inProgress: "Devam ediyor",
    status_delivered: "Teslim edildi",
    status_cancelled: "Ä°ptal edildi",
    status_rejected: "Reddedildi",
    status_unknown: "Bilinmiyor",

    // Bottom sheet (current order)
    currentOrder_btn_startToMerchant: "Ä°ÅŸletmeye gitmeye baÅŸla",
    currentOrder_btn_delivered: "Teslim edildi olarak iÅŸaretle",
    currentOrder_btn_cancel: "Ä°ptal et",
    currentOrder_expectedCost: "Tahmini Ã¼cret",

    // Order details modal
    orderDetails_title: "SipariÅŸ detaylarÄ±",
    orderDetails_status: "Durum",
    orderDetails_createdAt: "SipariÅŸ zamanÄ±",
    orderDetails_startedAt: "Teslimat baÅŸlangÄ±cÄ±",
    orderDetails_deliveredAt: "Teslimat zamanÄ±",
    orderDetails_merchant: "Ä°ÅŸletme",
    orderDetails_customerName: "MÃ¼ÅŸteri adÄ±",
    orderDetails_address: "Adres",
    orderDetails_totalDistance: "Toplam mesafe",
    orderDetails_deliveryCost: "Teslimat Ã¼creti",
    orderDetails_notes: "Notlar",
    orderDetails_closeBtn: "Kapat",
    orderDetails_paymentType: "Ã–deme tÃ¼rÃ¼",
    orderDetails_cashAmount: "Nakit tutar",

    paymentType_cash: "Nakit Ã¶deme",
    paymentType_online: "Online Ã¶deme",
    paymentType_unknown: "Ã–deme",

    // New call modal
    newCall_title: "Ä°ÅŸletmeden yeni Ã§aÄŸrÄ±",
    newCall_merchant: "Ä°ÅŸletme",
    newCall_city: "Åehir",
    newCall_time: "Zaman",
    newCall_question: "Bu Ã§aÄŸrÄ±yÄ± kabul etmek istiyor musunuz?",
    newCall_btn_accept: "Kabul et",
    newCall_btn_reject: "Reddet",

    // Distance / units
    distance_km_short: "km",

    // Side list order cards
    orderCard_status: "Durum",
    orderCard_address: "Adres",
    orderCard_expectedCost: "Tahmini Ã¼cret",
    orderCard_totalDistance: "Toplam mesafe",
    orderCard_finalCost: "Nihai Ã¼cret",

    // Alerts / confirmations
    alert_password_too_short:
      "Åifre en az 6 karakter olmalÄ±dÄ±r.",
    alert_driver_register_success: "SÃ¼rÃ¼cÃ¼ baÅŸarÄ±yla kaydedildi!",
    alert_generic_error_prefix: "Hata: ",
    alert_login_driver_only:
      "Bu arayÃ¼z yalnÄ±zca sÃ¼rÃ¼cÃ¼ler iÃ§indir. Ä°ÅŸletmeyseniz lÃ¼tfen iÅŸletme arayÃ¼zÃ¼nÃ¼ kullanÄ±n.",
    alert_toggle_offline_with_active:
      "Aktif bir sipariÅŸ varken Ã§evrimdÄ±ÅŸÄ± olamaz veya oturumu kapatamazsÄ±nÄ±z. LÃ¼tfen Ã¶nce sipariÅŸi tamamlayÄ±n.",
    alert_geo_failed_prefix:
      "Konum alÄ±namadÄ±: ",
    alert_geo_not_supported:
      "TarayÄ±cÄ±nÄ±z konum alma Ã¶zelliÄŸini desteklemiyor.",
    alert_status_update_failed:
      "Durum gÃ¼ncellenirken hata oluÅŸtu: ",
    alert_logout_forbidden_while_busy:
      "Aktif bir sipariÅŸ veya kabul edilmiÅŸ Ã§aÄŸrÄ± varken Ã§Ä±kÄ±ÅŸ yapamazsÄ±nÄ±z. LÃ¼tfen Ã¶nce sipariÅŸi tamamlayÄ±n.",
    alert_logout_failed: "Ã‡Ä±kÄ±ÅŸ yapÄ±lÄ±rken hata oluÅŸtu: ",
    alert_address_geocode_failed:
      "Bu adres iÃ§in konum alÄ±namadÄ±.",
    alert_customer_address_required:
      "LÃ¼tfen Ã¶nce geÃ§erli bir mÃ¼ÅŸteri adresi seÃ§in.",
    alert_live_nav_not_supported:
      "TarayÄ±cÄ±nÄ±z canlÄ± navigasyonu desteklemiyor.",
    alert_map_not_ready: "Harita henÃ¼z hazÄ±r deÄŸil.",
    alert_call_update_failed:
      "Ã‡aÄŸrÄ± durumu gÃ¼ncellenirken hata oluÅŸtu: ",
    alert_currentDriverNotSet:
      "Mevcut sÃ¼rÃ¼cÃ¼ ayarlanmamÄ±ÅŸ.",
    alert_orderNotInDriverLog:
      "SipariÅŸ sÃ¼rÃ¼cÃ¼ kaydÄ±nda bulunamadÄ±.",
    alert_readOrderDetailsError:
      "SipariÅŸ detaylarÄ± okunurken hata oluÅŸtu: ",
    alert_cannotAcceptCallNoDriver:
      "Ã‡aÄŸrÄ± kabul edilemedi: sÃ¼rÃ¼cÃ¼ ayarlanmamÄ±ÅŸ.",
    alert_acceptCallError:
      "Ã‡aÄŸrÄ± kabul edilirken hata oluÅŸtu: ",
    alert_rejectCallError:
      "Ã‡aÄŸrÄ± reddedilirken hata oluÅŸtu: ",
    alert_orderNotFound:
      "Bu sipariÅŸ bulunamadÄ±.",
    alert_driverStartError:
      "Yolculuk baÅŸlangÄ±cÄ± kaydedilirken hata oluÅŸtu: ",
    alert_driverStartSuccess:
      "Ä°ÅŸletmeye doÄŸru yolculuk kaydedildi ve harita navigasyonu baÅŸlatÄ±ldÄ±.",
    alert_completeDeliveryError:
      "Teslimat tamamlanÄ±rken hata oluÅŸtu: ",
    alert_completeDeliverySuccess:
      "Mesafe ve teslimat Ã¼creti hesaplandÄ±, sipariÅŸ durumu gÃ¼ncellendi.",
    confirm_cancel_order:
      "Bu sipariÅŸi iptal etmek istediÄŸinizden emin misiniz?",

    orderCancelledByMerchant_title: "SipariÅŸ iÅŸletme tarafÄ±ndan iptal edildi",
    orderCancelledByMerchant_message:
      "Bu sipariÅŸ iÅŸletme tarafÄ±ndan iptal edildi. Åu ana kadar katettiÄŸiniz mesafe, kayÄ±tlÄ± fiyatlarÄ±nÄ±za gÃ¶re hesaplanacaktÄ±r.",
    orderCancelledByMerchant_confirmBtn: "AnladÄ±m",

    alert_no_active_target:
      "Åu anda haritada aktif bir hedef yok. LÃ¼tfen Ã¶nce iÅŸletmeye doÄŸru gitmeyi baÅŸlatÄ±n veya mÃ¼ÅŸterinin adresini seÃ§in.",
     vehicleType_label: "AraÃ§ tipi",
    vehicleType_placeholder: "AraÃ§ tipi seÃ§in",
    vehicleType_car: "Araba",
    vehicleType_motorcycle: "Motosiklet",
    vehicleType_bicycle: "Bisiklet",
        vehicleType_required: "LÃ¼tfen araÃ§ tipinizi seÃ§in.",

    // âœ… Ø¬Ø¯ÙŠØ¯
    driver_not_approved_status_btn: "Onay bekleniyor",
    driver_not_approved_hint:
      "HesabÄ±nÄ±z platform tarafÄ±ndan onay bekliyor. OnaylandÄ±ktan sonra Ã§evrimiÃ§i olabilirsiniz.",
    alert_driver_not_approved:
      "HesabÄ±nÄ±z henÃ¼z onaylanmadÄ±. LÃ¼tfen yÃ¶netici tarafÄ±ndan onaylanmasÄ±nÄ± bekleyin.",
    driverApprovalModal_title: "HesabÄ±nÄ±z aktifleÅŸtirildi",
    driverApprovalModal_message:
      "SÃ¼rÃ¼cÃ¼ hesabÄ±nÄ±z onaylandÄ±. ArtÄ±k yolculuk ve teslimat hizmeti vermeye baÅŸlayabilirsiniz.",
    driverApprovalModal_button: "BaÅŸlat",
// ğŸ‡¹ğŸ‡· Turkish (tr)
currentOrder_orderPrice: "SipariÅŸ tutarÄ±",
currentOrder_btn_editPrice: "FiyatÄ± dÃ¼zenle",
orderDetails_orderPrice: "SipariÅŸ tutarÄ±",
prompt_editOrderPrice: "Yeni sipariÅŸ tutarÄ±nÄ± girin (â‚¬):",
alert_invalid_orderPrice: "GeÃ§ersiz tutar.",
alert_orderPriceUpdated: "SipariÅŸ tutarÄ± baÅŸarÄ±yla gÃ¼ncellendi.",
"driver_extraOrders_add_title": "AynÄ± restorandan ek sipariÅŸ ekle",
  "driver_extraOrders_manual_title": "Yeni sipariÅŸi manuel ekle",
  "driver_extraOrders_scan_title": "QR kod ile sipariÅŸ ekle",

  "extraOrder_price_placeholder": "SipariÅŸ tutarÄ±nÄ± girin",
  "extraOrder_cash_off": "Nakit",
  "extraOrder_cash_on": "Nakit",
  "extraOrder_confirm_btn": "Ek sipariÅŸi onayla",
  "extraOrders_price_required": "LÃ¼tfen tutarÄ± girin",
extraOrders_no_active_call: "Ek sipariÅŸ baÄŸlanacak aktif bir sipariÅŸ yok.",
extraOrders_missing_merchant: "Bu sipariÅŸ iÃ§in temel restoran belirlenemedi.",
extraOrders_created_success: "Ek sipariÅŸ baÅŸarÄ±yla oluÅŸturuldu.",
extraOrders_create_failed: "Ek sipariÅŸ oluÅŸturulurken bir hata oluÅŸtu: ",
  }

};
// ================== Ø§Ù„ØªØ±Ø¬Ù…Ø© + Ø§Ù„Ù‡ÙŠÙ„Ø¨Ø±Ø² ==================
function t(key) {
  const dict = translations[currentLang] || translations.en;
  if (dict && key in dict) return dict[key];
  if (translations.en && key in translations.en) return translations.en[key];
  return key;
}

function setVehicleSelectValue(value) {
  const hiddenInput = document.getElementById("vehicleType");
  const textSpan = document.getElementById("vehicleSelectText");
  const iconDiv = document.getElementById("vehicleSelectIcon");

  if (hiddenInput) {
    hiddenInput.value = value || "";
  }

  // Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶
  if (textSpan) {
    if (value) {
      let labelKey = "vehicleType_placeholder";
      if (value === "car") labelKey = "vehicleType_car";
      else if (value === "motorcycle") labelKey = "vehicleType_motorcycle";
      else if (value === "bicycle") labelKey = "vehicleType_bicycle";

      textSpan.textContent = t(labelKey);
      textSpan.classList.remove("vehicle-select-placeholder");
    } else {
      textSpan.textContent = t("vehicleType_placeholder");
      textSpan.classList.add("vehicle-select-placeholder");
    }
  }

  // Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© (Ø§Ù„ØµÙˆØ±Ø©)
  if (iconDiv) {
    const iconFiles = {
      car: "car.png",
      motorcycle: "motorcycle.png",
      bicycle: "bicycle.png"
    };
    if (value && iconFiles[value]) {
      iconDiv.style.backgroundImage = `url("${iconFiles[value]}")`;
    } else {
      iconDiv.style.backgroundImage = "none";
    }
  }
}

function updateDriverVehicleIcon(vehicleType) {
  if (!driverVehicleIconEl) return;

  const iconFiles = {
    car: "car.png",
    motorcycle: "motorcycle.png",
    bicycle: "bicycle.png"
  };

  if (vehicleType && iconFiles[vehicleType]) {
    driverVehicleIconEl.style.backgroundImage = `url("${iconFiles[vehicleType]}")`;
  } else {
    // Ù„Ùˆ Ù…Ø§ ÙÙŠ Ù†ÙˆØ¹ Ù…Ø±ÙƒØ¨Ø© (Ø³Ø§Ø¦Ù‚ Ù‚Ø¯ÙŠÙ… Ù…Ø«Ù„Ø§Ù‹) Ù†Ø®ÙÙŠ Ø§Ù„ØµÙˆØ±Ø©
    driverVehicleIconEl.style.backgroundImage = "none";
  }
}

function applyTranslations(lang) {
  currentLang = ["en", "de", "tr", "ar"].includes(lang) ? lang : "en";

  const dict = translations[currentLang] || translations.en;

  // Ù„ØºØ© Ùˆ Ø§ØªØ¬Ø§Ù‡ Ø§Ù„ØµÙØ­Ø©
  if (document.documentElement) {
    document.documentElement.lang = currentLang;
  }
  if (document.body) {
    document.body.style.direction = currentLang === "ar" ? "rtl" : "ltr";
  }

  if (mainHeader && dict.mainHeader) {
    mainHeader.textContent = dict.mainHeader;
  }

  if (registerTab && dict.tab_register) {
    registerTab.textContent = dict.tab_register;
  }
  if (loginTab && dict.tab_login) {
    loginTab.textContent = dict.tab_login;
  }

  // Ø¹Ù†Ø§ÙˆÙŠÙ† Ùˆ Ø­Ù‚ÙˆÙ„ Ù†Ù…ÙˆØ°Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø³Ø§Ø¦Ù‚
  const driverFormTitle = document.querySelector("#driverForm h3");
  if (driverFormTitle && dict.driver_register_title) {
    driverFormTitle.textContent = dict.driver_register_title;
  }

  const firstNameInput = document.getElementById("firstName");
  if (firstNameInput && dict.firstName_placeholder) {
    firstNameInput.placeholder = dict.firstName_placeholder;
  }
  const lastNameInput = document.getElementById("lastName");
  if (lastNameInput && dict.lastName_placeholder) {
    lastNameInput.placeholder = dict.lastName_placeholder;
  }
  const addressInput = document.getElementById("address");
  if (addressInput && dict.address_placeholder) {
    addressInput.placeholder = dict.address_placeholder;
  }
  const cityInput = document.getElementById("city");
  if (cityInput && dict.city_placeholder) {
    cityInput.placeholder = dict.city_placeholder;
  }

  const driverTypeLabelEl = document.getElementById("driverTypeLabel");
  const driverTypePlaceholderEl = document.getElementById("driverTypePlaceholder");
  const driverTypeOptionIndependentEl = document.getElementById("driverTypeOptionIndependent");
  const driverTypeOptionEmployeeEl = document.getElementById("driverTypeOptionEmployee");

  if (driverTypeLabelEl && dict.driverType_label) {
    driverTypeLabelEl.textContent = dict.driverType_label;
  }
  if (driverTypePlaceholderEl && dict.driverType_placeholder) {
    driverTypePlaceholderEl.textContent = dict.driverType_placeholder;
  }
  if (driverTypeOptionIndependentEl && dict.driverType_independent) {
    driverTypeOptionIndependentEl.textContent = dict.driverType_independent;
  }
  if (driverTypeOptionEmployeeEl && dict.driverType_employee) {
    driverTypeOptionEmployeeEl.textContent = dict.driverType_employee;
  }

  const vehicleTypeLabelEl = document.getElementById("vehicleTypeLabel");
  if (vehicleTypeLabelEl && dict.vehicleType_label) {
    vehicleTypeLabelEl.textContent = dict.vehicleType_label;
  }

  const vehicleOptionCarText = document.getElementById("vehicleOptionCarText");
  if (vehicleOptionCarText && dict.vehicleType_car) {
    vehicleOptionCarText.textContent = dict.vehicleType_car;
  }

  const vehicleOptionMotorcycleText = document.getElementById("vehicleOptionMotorcycleText");
  if (vehicleOptionMotorcycleText && dict.vehicleType_motorcycle) {
    vehicleOptionMotorcycleText.textContent = dict.vehicleType_motorcycle;
  }

  const vehicleOptionBicycleText = document.getElementById("vehicleOptionBicycleText");
  if (vehicleOptionBicycleText && dict.vehicleType_bicycle) {
    vehicleOptionBicycleText.textContent = dict.vehicleType_bicycle;
  }

  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Øµ Ø§Ù„Ø¸Ø§Ù‡Ø± ÙÙŠ Ø§Ù„Ø¯Ø±ÙˆØ¨Ø¯Ø§ÙˆÙ† Ø­Ø³Ø¨ Ø§Ù„Ù„ØºØ©/Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
  const vehicleTypeInputEl = document.getElementById("vehicleType");
  if (vehicleTypeInputEl) {
    setVehicleSelectValue(vehicleTypeInputEl.value || "");
  }

  const driverEmailInput = document.getElementById("driverEmail");
  if (driverEmailInput && dict.driverEmail_placeholder) {
    driverEmailInput.placeholder = dict.driverEmail_placeholder;
  }
  const driverPhoneInput = document.getElementById("driverPhone");
  if (driverPhoneInput && dict.driverPhone_placeholder) {
    driverPhoneInput.placeholder = dict.driverPhone_placeholder;
  }
  const driverPasswordInput = document.getElementById("driverPassword");
  if (driverPasswordInput && dict.driverPassword_placeholder) {
    driverPasswordInput.placeholder = dict.driverPassword_placeholder;
  }
  const registerSubmitBtn =
    driverForm && driverForm.querySelector('button[type="submit"]');
  if (registerSubmitBtn && dict.register_submit) {
    registerSubmitBtn.textContent = dict.register_submit;
  }

  // Ù†Ù…ÙˆØ°Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
  const loginFormTitle = document.querySelector("#loginForm h3");
  if (loginFormTitle && dict.driver_login_title) {
    loginFormTitle.textContent = dict.driver_login_title;
  }
  const loginEmailInput = document.getElementById("loginEmail");
  if (loginEmailInput && dict.loginEmail_placeholder) {
    loginEmailInput.placeholder = dict.loginEmail_placeholder;
  }
  const loginPasswordInput = document.getElementById("loginPassword");
  if (loginPasswordInput && dict.loginPassword_placeholder) {
    loginPasswordInput.placeholder = dict.loginPassword_placeholder;
  }
  const loginSubmitBtn =
    loginForm && loginForm.querySelector('button[type="submit"]');
  if (loginSubmitBtn && dict.login_submit) {
    loginSubmitBtn.textContent = dict.login_submit;
  }

  // Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„ + Ø²Ø± Ø¨Ø¯Ø¡ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡
  if (customerAddressInput && dict.customerAddress_placeholder) {
    customerAddressInput.placeholder = dict.customerAddress_placeholder;
  }
  if (startCustomerNavBtn && dict.start_customer_nav) {
    startCustomerNavBtn.textContent = dict.start_customer_nav;
  }

  // Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©
  const sideTitle = document.querySelector(".driver-side-title");
  if (sideTitle && dict.side_menu_title) {
    sideTitle.textContent = dict.side_menu_title;
  }

  const summaryBtnSpan = document.querySelector(
    'button.driver-section-toggle[data-target="driverSummaryPane"] span'
  );
  if (summaryBtnSpan && dict.side_summary_title) {
    summaryBtnSpan.textContent = dict.side_summary_title;
  }

  const activeBtnSpan = document.querySelector(
    'button.driver-section-toggle[data-target="driverActivePane"] span'
  );
  if (activeBtnSpan && dict.active_section_btn) {
    activeBtnSpan.textContent = dict.active_section_btn;
  }

  const completedBtnSpan = document.querySelector(
    'button.driver-section-toggle[data-target="driverCompletedPane"] span'
  );
  if (completedBtnSpan && dict.completed_section_btn) {
    completedBtnSpan.textContent = dict.completed_section_btn;
  }

  const pricingBtnSpan = document.querySelector("#pricingSettingsBtn span");
  if (pricingBtnSpan && dict.pricing_section_btn) {
    pricingBtnSpan.textContent = dict.pricing_section_btn;
  }

  // Ù†ØµÙˆØµ Ø§Ù„ØªØ³Ø¹ÙŠØ±
  const pricingIntroEl = document.getElementById("pricingIntroText");
  if (pricingIntroEl && dict.pricing_intro) {
    pricingIntroEl.textContent = dict.pricing_intro;
  }
  const pricingModeLabelEl = document.getElementById("pricingModeLabel");
  const pricingModePerKmOptionEl = document.getElementById("pricingModePerKmOption");
  const pricingModeIndependentOptionEl = document.getElementById("pricingModeIndependentOption");
  const pricingModeNoteEl = document.getElementById("pricingModeNote");
  const pricingInfoLinkEl = document.getElementById("pricingInfoLink");
  if (pricingInfoLinkEl && dict.pricing_info_link_label) {
    pricingInfoLinkEl.textContent = dict.pricing_info_link_label;
  }

  if (pricingModeLabelEl && dict.pricing_mode_label) {
    pricingModeLabelEl.textContent = dict.pricing_mode_label;
  }
  if (pricingModePerKmOptionEl && dict.pricing_mode_per_km) {
    pricingModePerKmOptionEl.textContent = dict.pricing_mode_per_km;
  }
  if (pricingModeIndependentOptionEl && dict.pricing_mode_independent) {
    pricingModeIndependentOptionEl.textContent = dict.pricing_mode_independent;
  }
  if (pricingModeNoteEl && dict.pricing_mode_note_independent_only) {
    pricingModeNoteEl.textContent = dict.pricing_mode_note_independent_only;
  }

  const pricingDeliveryLabel = document.getElementById("pricingDeliveryLabel");
  if (pricingDeliveryLabel && dict.pricing_label_delivery) {
    pricingDeliveryLabel.textContent = dict.pricing_label_delivery;
  }

  const pricingIncludeLabel = document.getElementById("pricingIncludeLabel");
  if (pricingIncludeLabel && dict.pricing_include_to_merchant) {
    pricingIncludeLabel.textContent = dict.pricing_include_to_merchant;
  }

  const pricingSamePriceLabel = document.getElementById("pricingSamePriceLabel");
  if (pricingSamePriceLabel && dict.pricing_use_same_for_both) {
    pricingSamePriceLabel.textContent = dict.pricing_use_same_for_both;
  }

  const pricingToMerchantLabel = document.getElementById("pricingToMerchantLabel");
  if (pricingToMerchantLabel && dict.pricing_label_to_merchant) {
    pricingToMerchantLabel.textContent = dict.pricing_label_to_merchant;
  }

  const pricingFreeKmLabel = document.getElementById("pricingFreeKmLabel");
  if (pricingFreeKmLabel && dict.pricing_free_km) {
    pricingFreeKmLabel.textContent = dict.pricing_free_km;
  }

  const savePricingBtnEl = document.getElementById("savePricingBtn");
  if (savePricingBtnEl && dict.pricing_save_btn) {
    savePricingBtnEl.textContent = dict.pricing_save_btn;
  }

  const logoutBtnSpan = document.querySelector("#driverLogoutBtn span");
  if (logoutBtnSpan && dict.logout) {
    logoutBtnSpan.textContent = dict.logout;
  }

  if (footerEl && dict.footer_text) {
    footerEl.textContent = dict.footer_text;
  }

  // ØªØ­Ø¯ÙŠØ« Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
  if (Array.isArray(lastDriverCalls) && typeof renderDriverOrders === "function") {
    renderDriverOrders(lastDriverCalls);
  } else {
    const isEmployee =
      currentDriverData && currentDriverData.driverType === "employee";

    if (driverActiveCountEl) {
      driverActiveCountEl.innerHTML =
        t("summary_active_orders") + "<br><strong>0</strong>";
    }
    if (driverCompletedCountEl) {
      driverCompletedCountEl.innerHTML =
        t("summary_completed_orders") + "<br><strong>0</strong>";
    }

    if (driverEarningsEl) {
      driverEarningsEl.style.display = "";
      const unit = t("distance_km_short");

      if (isEmployee) {
        driverEarningsEl.innerHTML =
          t("summary_total_km") +
          "<br><strong>0 " +
          unit +
          "</strong>";
      } else {
        driverEarningsEl.innerHTML =
          t("summary_earnings") + "<br><strong>0 â‚¬</strong>";
      }
    }

    if (driverEarningsFloatingEl) {
      if (isEmployee) {
        driverEarningsFloatingEl.innerHTML =
          t("summary_orders_count") + "<br><strong>0</strong>";
      } else {
        driverEarningsFloatingEl.innerHTML =
          t("summary_earnings") + "<br><strong>0 â‚¬</strong>";
      }
    }
  }

  // Ù…Ù†Ø¨Ø«Ù‚ Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ø³Ø§Ø¦Ù‚
  const driverApprovalTitleEl = document.getElementById("driverApprovalTitle");
  if (driverApprovalTitleEl && dict.driverApprovalModal_title) {
    driverApprovalTitleEl.textContent = dict.driverApprovalModal_title;
  }
  const driverApprovalMessageEl = document.getElementById("driverApprovalMessage");
  if (driverApprovalMessageEl && dict.driverApprovalModal_message) {
    driverApprovalMessageEl.textContent = dict.driverApprovalModal_message;
  }
  const driverApprovalStartBtnEl = document.getElementById("driverApprovalStartBtn");
  if (driverApprovalStartBtnEl && dict.driverApprovalModal_button) {
    driverApprovalStartBtnEl.textContent = dict.driverApprovalModal_button;
  }

  // ØªØ­Ø¯ÙŠØ« Ø²Ø± Ø§Ù„Ø­Ø§Ù„Ø© / Ø§Ù„ÙƒØ¨Ø³ÙˆÙ„Ø© Ø§Ù„Ø³ÙÙ„ÙŠØ©
  updateOnlineBtn();
}

// ================== DOM ELEMENTS ==================
const registerTab = document.getElementById("registerTab");
const loginTab = document.getElementById("loginTab");
const registerSection = document.getElementById("registerSection");
const loginSection = document.getElementById("loginSection");

const driverForm = document.getElementById("driverForm");
const loginForm = document.getElementById("loginForm");
const vehicleSelectToggle = document.getElementById("vehicleSelectToggle");
const vehicleSelectOptions = document.getElementById("vehicleSelectOptions");

if (vehicleSelectToggle && vehicleSelectOptions) {
  // ÙØªØ­/Ø¥ØºÙ„Ø§Ù‚ Ù‚Ø§Ø¦Ù…Ø© Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©
  vehicleSelectToggle.addEventListener("click", () => {
    vehicleSelectOptions.classList.toggle("hidden");
  });

  vehicleSelectOptions.addEventListener("click", (e) => {
    const option = e.target.closest(".vehicle-option");
    if (!option) return;
    const value = option.getAttribute("data-value") || "";
    setVehicleSelectValue(value);
    vehicleSelectOptions.classList.add("hidden");
  });

  document.addEventListener("click", (e) => {
    if (
      !vehicleSelectToggle.contains(e.target) &&
      !vehicleSelectOptions.contains(e.target)
    ) {
      vehicleSelectOptions.classList.add("hidden");
    }
  });
}

const driverDashboard = document.getElementById("driverDashboard");
const driverNameEl = document.getElementById("driverName");
const driverVehicleIconEl = document.getElementById("driverVehicleIcon");

const driverActiveOrdersEl = document.getElementById("driverActiveOrders");
const driverCompletedOrdersEl = document.getElementById("driverCompletedOrders");
const driverActiveCountEl = document.getElementById("driverActiveCount");
const driverCompletedCountEl = document.getElementById("driverCompletedCount");
const driverEarningsEl = document.getElementById("driverEarnings");
const driverLogoutBtn = document.getElementById("driverLogoutBtn");
const driverLegalBtn = document.getElementById("driverLegalBtn");
if (driverLegalBtn) {
  driverLegalBtn.addEventListener("click", () => {
    modalContent.innerHTML = `
      <div><strong>Rechtlicher Hinweis &amp; Haftungsausschluss (Beta-Version)</strong></div>
      <div class="small" style="margin-top:8px;">
        ...
      </div>
      <div class="btn-row" style="margin-top:14px;">
        <button id="legalCloseBtn">SchlieÃŸen</button>
      </div>
    `;

    if (orderModalEl) orderModalEl.classList.remove("hidden");
    if (modalBackdrop) modalBackdrop.style.display = "flex";
    window.scrollTo(0, 0);

    const legalCloseBtn = document.getElementById("legalCloseBtn");
    if (legalCloseBtn) {
      legalCloseBtn.addEventListener("click", () => {
        closeOrderModal();
      });
    }
  });
}

const pricingSettingsBtn = document.getElementById("pricingSettingsBtn");
const toggleOnlineBtn = document.getElementById("toggleOnlineBtn");
const pricingInfoLink = document.getElementById("pricingInfoLink");
if (pricingInfoLink) {
  pricingInfoLink.addEventListener("click", showTaussilPricingInfoModal);
}

// Ø®Ø±ÙŠØ·Ø© + Ù‚Ø§Ø¦Ù…Ø© Ø¬Ø§Ù†Ø¨ÙŠØ©
const driverMapContainer = document.getElementById("driverMap");
const driverMenuBtn = document.getElementById("driverMenuBtn");
const driverSidePanel = document.getElementById("driverSidePanel");
const driverSidePanelBackdrop = document.getElementById("driverSidePanelBackdrop");
const driverSideCloseBtn = document.getElementById("driverSideCloseBtn");
const driverStatusTextEl = document.getElementById("driverStatusText");
const driverBottomStatusEl = document.getElementById("driverBottomStatus");

// Ø²Ø± Ø§Ù„ØªÙˆØ¬ÙŠÙ‡
const driverNavBtn = document.getElementById("driverNavBtn");
const driverExtraOrdersBtn = document.getElementById("driverExtraOrdersBtn");
const driverActiveSwitcherBtn   = document.getElementById("driverActiveSwitcherBtn");
const driverActiveSwitcherBadge = document.getElementById("driverActiveSwitcherBadge");

// Ø²Ø± Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙˆØ­Ù‚Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
const customerSearchBtn = document.getElementById("customerSearchBtn");
const customerAddressPanel = document.getElementById("customerAddressPanel");
const customerAddressInput = document.getElementById("customerAddressInput");
const startCustomerNavBtn = document.getElementById("startCustomerNavBtn");

// Ø¹Ù†Ø§ØµØ± Ù†Ø§ÙØ°Ø© Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ Ø§Ù„ÙŠØ¯ÙˆÙŠ
const driverExtraManualPanel  = document.getElementById("driverExtraManualPanel");
const driverExtraPriceInput   = document.getElementById("driverExtraPriceInput");
const driverExtraCashBtn      = document.getElementById("driverExtraCashBtn");
const driverExtraConfirmBtn   = document.getElementById("driverExtraConfirmBtn");

let driverExtraIsCash = false;
// â¬…â¬… Ù‡Ù†Ø§ Ù…Ø¨Ø§Ø´Ø±Ø© Ø£Ù„ØµÙ‚ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„ØªØ§Ù„ÙŠ
if (driverExtraCashBtn) {
  driverExtraCashBtn.addEventListener("click", () => {
    // Ù‚Ù„Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©
    driverExtraIsCash = !driverExtraIsCash;

    // Ø§Ù„Ø´ÙƒÙ„ (Ø£Ø¨ÙŠØ¶ â†” Ø£Ø­Ù…Ø±)
    driverExtraCashBtn.classList.toggle("cash-on", driverExtraIsCash);

    // Ù†Øµ Ø§Ù„Ø²Ø± Ù…Ù† Ø§Ù„ØªØ±Ø¬Ù…Ø©
    driverExtraCashBtn.textContent = driverExtraIsCash
      ? t("extraOrders_btn_cash_on")
      : t("extraOrders_btn_cash");
  });
}
// Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ù†Ø§ÙØ°Ø© Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ Ø§Ù„ÙŠØ¯ÙˆÙŠ (ØªØµÙÙŠØ± Ø§Ù„Ø­Ù‚Ù„ + Ø§Ù„ÙƒØ§Ø´ + Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„)
function resetDriverExtraManualForm() {
  // Ø­Ù‚Ù„ Ø§Ù„Ø³Ø¹Ø±
  if (driverExtraPriceInput) {
    driverExtraPriceInput.value = "";
    driverExtraPriceInput.classList.remove("driver-extra-price-error");
    driverExtraPriceInput.placeholder = t("extraOrders_price_placeholder");
  }

  // Ø­Ø§Ù„Ø© Ø§Ù„ÙƒØ§Ø´
  driverExtraIsCash = false;
  if (driverExtraCashBtn) {
    driverExtraCashBtn.classList.remove("cash-on");
    driverExtraCashBtn.textContent = t("extraOrders_btn_cash");
  }

  // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ (Ù„Ùˆ ÙƒÙ†Øª ØªØ³ØªØ¯Ø¹ÙŠÙ‡Ø§ Ø¹Ù†Ø¯ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚)
  if (driverExtraManualPanel) {
    driverExtraManualPanel.classList.add("hidden");
  }
}

// Ø²Ø± ØªØ£ÙƒÙŠØ¯ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ
if (driverExtraConfirmBtn) {
  driverExtraConfirmBtn.addEventListener("click", () => {
    if (!driverExtraPriceInput) return;

    const raw = (driverExtraPriceInput.value || "")
      .replace(",", ".")
      .trim();

    if (!raw) {
      driverExtraPriceInput.classList.add("driver-extra-price-error");
      driverExtraPriceInput.value = "";
      driverExtraPriceInput.placeholder = t("extraOrders_price_required");
      driverExtraPriceInput.focus();
      return;
    }

    const price = parseFloat(raw);
    if (isNaN(price) || price <= 0) {
      driverExtraPriceInput.classList.add("driver-extra-price-error");
      driverExtraPriceInput.value = "";
      driverExtraPriceInput.placeholder = t("extraOrders_price_required");
      driverExtraPriceInput.focus();
      return;
    }

    driverExtraPriceInput.classList.remove("driver-extra-price-error");
    driverExtraPriceInput.placeholder = t("extraOrders_price_placeholder");

    // Ù‡Ù†Ø§ ØªÙ…Ø±ÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„ÙƒØ§Ø´ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©
    createDriverExtraCallFromManual(price, driverExtraIsCash);
  });
}

// ÙƒØ±Øª Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ù†Ø´Ø· + ÙƒØ±Øª Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„Ø¹Ø§Ø¦Ù…
const driverCurrentOrderEl = document.getElementById("driverCurrentOrder");
const driverEarningsFloatingEl = document.getElementById("driverEarningsFloating");
const cashFloatingBadgeEl = document.getElementById("cashFloatingBadge");

const driverApprovalOverlay = document.getElementById("driverApprovalOverlay");
const driverApprovalStartBtn = document.getElementById("driverApprovalStartBtn");

const modalBackdrop = document.getElementById("modalBackdrop");
const modalContent = document.getElementById("modalContent");
const closeModal = document.getElementById("closeModal");
const orderModalEl = document.getElementById("orderModal");

const mainHeader = document.getElementById("mainHeader");
const authTabs = document.getElementById("authTabs");
const footerEl = document.querySelector("footer");
const authLangSwitcher = document.querySelector(".auth-lang-switcher");

// Ø£ØµÙˆØ§Øª
const onlineSoundEl = document.getElementById("onlineSound");
let playOnlineSoundNext = false;

const callSoundEl = document.getElementById("callSound");
const orderCancelledSoundEl = document.getElementById("orderCancelledSound");
const driverApprovalSoundEl = document.getElementById("driverApprovalSound");

// Ø­Ø§Ù„Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚ ÙˆØ§Ù„Ù…ØªØºÙŠÙ‘Ø±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
let driverCurrentOnline = false;
let driverUid = null;
let activeDriverSessionId = null;

let driverDashboardShownOnce = false;
let isManualLoginInProgress = false;

let driverApprovalStatus = "pending";
let driverMap;
let currentDriverData = null;
let driverOrdersListener = null;
let driverCallsListener = null;
let driverDocListener = null;
let driverOrdersInitialLoaded = false;

let lastDriverCalls = [];
let driverCallsCache = [];
let directionsService = null;
let driverSelectedActiveCallId = null; // Ø§Ø®ØªÙŠØ§Ø± ÙŠØ¯ÙˆÙŠ Ù„Ù„Ø·Ù„Ø¨ Ø§Ù„Ø­Ø§Ù„ÙŠ ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©

let directionsRenderer = null;
let currentOrderCollapsed = false;
let autoCollapseCurrentOrderAfterAccept = false;

let routePath = [];
let remainingRoutePolyline = null;

let navigationWatchId = null;
let isGuidanceOn = false;
let driverMarker = null;
let driverGlowCircle = null;
let driverGlowInner = null;
let driverGlowOuter = null;
let driverGlowPulseInterval = null;
let navigationTarget = null;
let navigationMode = null;
// ØªØªØ¨Ø¹ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø³Ø§Ø¦Ù‚ ÙˆØªØ­Ø¯ÙŠØ«Ù‡ Ø¹Ù„Ù‰ Firestore (Ø®Ù„ÙÙŠØ©)
let locationWatchId = null;
let lastLocationUpdateAt = 0;
const LOCATION_UPDATE_MIN_INTERVAL_MS = 7000; // ÙƒÙ„ ~7 Ø«ÙˆØ§Ù†ÙŠ ÙƒØ­Ø¯ Ø£Ø¯Ù†Ù‰ Ø¨ÙŠÙ† ÙƒÙ„ ØªØ­Ø¯ÙŠØ« ÙˆØ§Ù„ØªØ§Ù„ÙŠ
async function handleDriverLocationUpdate(lat, lng) {
  // Ù„Ùˆ Ù…Ø§ÙÙŠ Ø³Ø§Ø¦Ù‚ Ø­Ø§Ù„ÙŠØ§Ù‹ Ù„Ø§ Ù†Ø¹Ù…Ù„ Ø´ÙŠØ¡
  if (!driverUid) return;

  const now = Date.now();
  // Ø«Ø±ÙˆØªÙ„ Ø¨Ø³ÙŠØ· Ø¹Ø´Ø§Ù† Ù…Ø§ Ù†Ù‚ØµÙ Firestore Ø¨ØªØ­Ø¯ÙŠØ«Ø§Øª ÙƒÙ„ Ø«Ø§Ù†ÙŠØ©
  if (now - lastLocationUpdateAt < LOCATION_UPDATE_MIN_INTERVAL_MS) {
    return;
  }
  lastLocationUpdateAt = now;

  try {
    await db.collection("drivers").doc(driverUid).update({
      lat,
      lng,
      lastLocation: firebase.firestore.FieldValue.serverTimestamp()
    });
  } catch (e) {
    console.warn("ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ« Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø³Ø§Ø¦Ù‚ ÙÙŠ Firestore:", e);
  }
}

// Ù†Ù‚Ø§Ø· Ø§Ù„Ù…ØªØ¬Ø± ÙˆØ§Ù„Ø¹Ù…ÙŠÙ„
let merchantMarker = null;
let customerMarker = null;
let customerDestination = null; // { lat, lng, address }
let customerAutocomplete = null;

// ØµÙˆØª Ø§Ù„Ù†Ø¯Ø§Ø¡ Ø§Ù„Ù…ØªÙƒØ±Ø±
let newCallSoundTimer = null;
let currentRingingCallId = null;

/* ========== ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„/Ø§Ù„Ø¯Ø®ÙˆÙ„ ========== */
registerTab.addEventListener("click", () => {
  registerTab.classList.add("active");
  loginTab.classList.remove("active");
  registerSection.classList.remove("hidden");
  loginSection.classList.add("hidden");
});
loginTab.addEventListener("click", () => {
  loginTab.classList.add("active");
  registerTab.classList.remove("active");
  loginSection.classList.remove("hidden");
  registerSection.classList.add("hidden");
});

/* ========== Ø¯Ø±ÙˆØ± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© ========== */
function openDriverSidePanel() {
  if (driverSidePanel) driverSidePanel.classList.add("open");
  if (driverSidePanelBackdrop) driverSidePanelBackdrop.classList.add("show");
}
function closeDriverSidePanel() {
  if (driverSidePanel) driverSidePanel.classList.remove("open");
  if (driverSidePanelBackdrop) driverSidePanelBackdrop.classList.remove("show");
}
if (driverMenuBtn) {
  driverMenuBtn.addEventListener("click", openDriverSidePanel);
}
if (driverSideCloseBtn) {
  driverSideCloseBtn.addEventListener("click", closeDriverSidePanel);
}
if (driverSidePanelBackdrop) {
  driverSidePanelBackdrop.addEventListener("click", (e) => {
    if (e.target === driverSidePanelBackdrop) {
      closeDriverSidePanel();
    }
  });
}

/* ========== ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© (Ù…Ù„Ø®Øµ/Ø·Ù„Ø¨Ø§Øª/ØªØ³Ø¹ÙŠØ±) ========== */
const sectionToggleButtons = document.querySelectorAll(".driver-section-toggle");
sectionToggleButtons.forEach((btn) => {
  btn.addEventListener("click", () => {
    const targetId = btn.getAttribute("data-target");
    if (!targetId) return;
    const pane = document.getElementById(targetId);
    if (!pane) return;
    const willOpen = !pane.classList.contains("open");
    pane.classList.toggle("open");
    btn.classList.toggle("open", willOpen);
  });
});

/* Ø²Ø± Ø§Ù„Ù…ØªØ¬Ø± Ø£Ø³ÙÙ„ Ø§Ù„ÙŠÙ…ÙŠÙ†: Ù…Ù„Ø§Ø­Ø© Ø®Ø§Ø±Ø¬ÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ø­Ø§Ù„ÙŠ (Ù…ØªØ¬Ø± Ø£Ùˆ Ø¹Ù…ÙŠÙ„) */
if (driverNavBtn) {
  driverNavBtn.addEventListener("click", () => {
    openExternalNavigationToCurrentTarget();
  });
}

/* Ø²Ø± Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù„ÙØªØ­/Ø¥ØºÙ„Ø§Ù‚ Ù„ÙˆØ­Ø© Ø§Ù„Ø¨Ø­Ø« */
if (customerSearchBtn && customerAddressPanel && customerAddressInput) {
  customerSearchBtn.addEventListener("click", () => {
    customerAddressPanel.classList.toggle("hidden");

    if (!customerAddressPanel.classList.contains("hidden")) {
      const activeCall = getCurrentActiveCall();
      if (activeCall) {
        // Ù„Ùˆ ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø³Ø§Ø¨Ù‚Ø§Ù‹
        if (!customerDestination && typeof activeCall.customerLat === "number" && typeof activeCall.customerLng === "number") {
          setCustomerDestination(activeCall.customerLat, activeCall.customerLng, activeCall.deliveryAddress || "");
        } else if (!customerAddressInput.value && activeCall.deliveryAddress) {
          customerAddressInput.value = activeCall.deliveryAddress;
        }
      }
      setTimeout(() => customerAddressInput.focus(), 0);
    }
  });
}

if (startCustomerNavBtn) {
  startCustomerNavBtn.addEventListener("click", () => {
    startCustomerNavigation();
  });
}

// Ø¨Ø¯Ø¡ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¨Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Enter Ø¯Ø§Ø®Ù„ Ø§Ù„Ø­Ù‚Ù„
if (customerAddressInput) {
  customerAddressInput.addEventListener("keydown", (e) => {
    if (e.key === "Enter") {
      e.preventDefault();
      startCustomerNavigation();
    }
  });
}

/* ========== ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø³Ø§Ø¦Ù‚ ========== */
driverForm.addEventListener("submit", async (e) => {
  e.preventDefault();
  const firstName = document.getElementById("firstName").value.trim();
  const lastName = document.getElementById("lastName").value.trim();
  const address = document.getElementById("address").value.trim();
  const city = document.getElementById("city").value.trim();
  const email = document.getElementById("driverEmail").value.trim();
  const phone = document.getElementById("driverPhone").value.trim();
  const password = document.getElementById("driverPassword").value;
    const vehicleType = document.getElementById("vehicleType").value;
  const driverType = document.getElementById("driverType").value;

  if (password.length < 6) return alert(t("alert_password_too_short"));
  if (!driverType)   return alert(t("driverType_required"));
  if (!vehicleType)  return alert(t("vehicleType_required"));

  try {
    const userCredential = await auth.createUserWithEmailAndPassword(
      email,
      password
    );
    const uid = userCredential.user.uid;

    // ğŸ‘‡ Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„ØªØ³Ø¹ÙŠØ±Ø© Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ø³Ø§Ø¦Ù‚
    const initialPricingMode =
      driverType === "employee" ? "independent_tiered" : "per_km";

    await db.collection("drivers").doc(uid).set({
      firstName,
      lastName,
      address,
      city,
      email,
      phone,
      vehicleType,
      driverType, // âœ… Ù†Ø®Ø²Ù‘Ù† Ù†ÙˆØ¹ Ø§Ù„Ø³Ø§Ø¦Ù‚ ÙÙŠ Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©
      role: "driver",
      approvalStatus: "pending",
      online: false,
      busy: false,
      lat: null,
      lng: null,
      createdAt: firebase.firestore.FieldValue.serverTimestamp(),

      // âœ… ØªØ³Ø¹ÙŠØ±Ø© Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ© Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ø³Ø§Ø¦Ù‚
      pricingMode: initialPricingMode,

      pricePerKmDelivery: null,
      includeToMerchantSegment: false,
      useSamePriceForBoth: true,
      pricePerKmToMerchant: null,
      freeKm: 0
    });

  // âœ… Ø§ÙØªØ­ Ù„ÙˆØ­Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨Ø¹Ø¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
  await showDriverDashboard(uid);
  driverDashboardShownOnce = true;

  alert(t("alert_driver_register_success"));

  driverForm.reset();
  setVehicleSelectValue("");

} catch (err) {
  alert(t("alert_generic_error_prefix") + err.message);
}

});

/* ========== ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ (Ø³Ø§Ø¦Ù‚ ÙÙ‚Ø·) ========== */
loginForm.addEventListener("submit", async (e) => {
  e.preventDefault();
  const email = document.getElementById("loginEmail").value.trim();
  const password = document.getElementById("loginPassword").value;

  try {
    isManualLoginInProgress = true;

    const userCredential = await auth.signInWithEmailAndPassword(
      email,
      password
    );
    const uid = userCredential.user.uid;

    const driverDoc = await db.collection("drivers").doc(uid).get();

    if (driverDoc.exists) {
      await showDriverDashboard(uid);
      driverDashboardShownOnce = true;
    } else {
      await auth.signOut();
      alert(t("alert_login_driver_only"));
    }

    loginForm.reset();
  } catch (err) {
    alert("Ø®Ø·Ø£: " + err.message);
  } finally {
    isManualLoginInProgress = false;
  }
});

/* ========== Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† / Ø£ÙˆÙÙ„Ø§ÙŠÙ† Ù…Ø¹ ÙˆÙ…ÙŠØ¶ ÙˆØµÙˆØª Ø¹Ù†Ø¯ Ø§Ù„Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† ========== */
toggleOnlineBtn.addEventListener("click", async () => {
  if (!driverUid) return;

  // â›” Ø­Ø³Ø§Ø¨ ØºÙŠØ± Ù…Ø¹ØªÙ…Ø¯ â†’ Ù…Ù…Ù†ÙˆØ¹ Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†
  if (driverApprovalStatus !== "approved") {
    alert(t("alert_driver_not_approved"));
    return;
  }

  try {
    const driverRef = db.collection("drivers").doc(driverUid);

    const snap = await driverRef.get();
    const data = snap.exists ? snap.data() : {};
    const isBusy = !!(data && data.busy);
    const hasActiveJob = driverHasActiveJob();

    if (driverCurrentOnline && (isBusy || hasActiveJob)) {
      alert(t("alert_toggle_offline_with_active"));
      return;
    }

    const goingOnline = !driverCurrentOnline;
    driverCurrentOnline = !driverCurrentOnline;

    const geoOptions = {
      enableHighAccuracy: true,
      timeout: 15000,
      maximumAge: 5000
    };

    // âœ… Ù„Ùˆ Ù†Ø­Ù†Ø§ Ø±Ø§ÙŠØ­ÙŠÙ† Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†ØŒ ÙØ¹Ù‘Ù„ Ø§Ù„ÙˆÙ…ÙŠØ¶ ÙˆØ¬Ù‡Ù‘Ø² Ø§Ù„ØµÙˆØª
    if (goingOnline && toggleOnlineBtn) {
      playOnlineSoundNext = true;
      toggleOnlineBtn.classList.add("blink");
    }

    if (goingOnline) {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          async (position) => {
            const lat = position.coords.latitude;
            const lng = position.coords.longitude;

            await driverRef.update({
              online: true,
              lat,
              lng,
              lastOnline: firebase.firestore.FieldValue.serverTimestamp()
            });

            // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ÙˆÙ…ÙŠØ¶ ÙˆØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª Ø¯Ø§Ø®Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«
            toggleOnlineBtn.classList.remove("blink");
            if (playOnlineSoundNext && onlineSoundEl) {
              try {
                onlineSoundEl.currentTime = 0;
                await onlineSoundEl.play();
              } catch (e) {
                console.warn("ØªØ¹Ø°Ø± ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†:", e);
              }
            }
            playOnlineSoundNext = false;

            updateOnlineBtn();

            // Ø¨Ø¹Ø¯ Ø£Ù† ÙŠØµØ¨Ø­ Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†ØŒ Ø£Ø¸Ù‡Ø± Ù…ÙˆÙ‚Ø¹Ù‡ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù…Ø¹ Ø§Ù„Ù‡Ø§Ù„Ø©
            if (driverMap) {
              ensureDriverMarker(lat, lng, null);
            }

            // âœ… Ø¨Ø¯Ø¡ ØªØªØ¨Ø¹ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø³Ø§Ø¦Ù‚ ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ© ÙˆØªØ­Ø¯ÙŠØ«Ù‡ Ø¹Ù„Ù‰ Firestore
            startDriverLocationTracking();

            // âœ… ØªØ´ØºÙŠÙ„ Median Background Location (Android / iOS)
            startMedianBackgroundLocation();
          },
          async (err) => {
            alert(t("alert_geo_failed_prefix") + err.message);

            await driverRef.update({
              online: true,
              lastOnline: firebase.firestore.FieldValue.serverTimestamp()
            });

            toggleOnlineBtn.classList.remove("blink");
            if (playOnlineSoundNext && onlineSoundEl) {
              try {
                onlineSoundEl.currentTime = 0;
                await onlineSoundEl.play();
              } catch (e) {
                console.warn("ØªØ¹Ø°Ø± ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†:", e);
              }
            }
            playOnlineSoundNext = false;

            updateOnlineBtn();

            // âœ… ØªØ´ØºÙŠÙ„ Median Ø­ØªÙ‰ Ù„Ùˆ ØªØ¹Ø°Ø± Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ lat/lng
            startMedianBackgroundLocation();
          },
          geoOptions
        );
      } else {
        alert(t("alert_geo_not_supported"));

        await driverRef.update({
          online: true,
          lastOnline: firebase.firestore.FieldValue.serverTimestamp()
        });

        toggleOnlineBtn.classList.remove("blink");
        if (playOnlineSoundNext && onlineSoundEl) {
          try {
            onlineSoundEl.currentTime = 0;
            await onlineSoundEl.play();
          } catch (e) {
            console.warn("ØªØ¹Ø°Ø± ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†:", e);
          }
        }
        playOnlineSoundNext = false;

        updateOnlineBtn();

        // âœ… ØªØ´ØºÙŠÙ„ Median Background Location ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø­Ø§Ù„Ø© Ø£ÙŠØ¶Ø§Ù‹
        startMedianBackgroundLocation();
      }
    } else {
      await driverRef.update({
        online: false,
        busy: false
      });

      driverCurrentOnline = false; // ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø§Ù„Ø©
      updateOnlineBtn();

      // â›” Ø¥ÙŠÙ‚Ø§Ù ØªØªØ¨Ø¹ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ© (Geolocation + Median)
      stopDriverLocationTracking();
      stopMedianBackgroundLocation();   // Ù…Ù‡Ù… Ø¬Ø¯Ø§Ù‹ Ø¥Ø·ÙØ§Ø¡ Median Ù‡Ù†Ø§

      // Ø£ÙˆÙ‚Ù Ø£ÙŠ ØªÙˆØ¬ÙŠÙ‡ Ø­ÙŠ (Ù„Ùˆ Ø´ØºÙ‘Ø§Ù„) â†’ Ù‡Ø°Ø§ Ø³ÙŠØ¹ÙŠØ¯ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ø§Ø¯ÙŠ
      if (typeof stopGuidance === "function") {
        stopGuidance();
      }

      // Ø§Ø­ØªÙŠØ§Ø·: Ø§Ù…Ø³Ø­ Ù…Ø§Ø±ÙƒØ± Ø§Ù„Ø³Ø§Ø¦Ù‚ (Ù„Ùˆ Ù…ÙˆØ¬ÙˆØ¯)
      if (driverMarker) {
        driverMarker.setMap(null);
        driverMarker = null;
      }

      // ğŸ§½ Ù…Ø³Ø­ Ø§Ù„Ù‡Ø§Ù„Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ (Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© + Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ© + Ø§Ù„Ø£Ù†ÙŠÙ…ÙŠØ´Ù†)
      if (typeof stopDriverGlow === "function") {
        stopDriverGlow();
      }
    }

  } catch (err) {
    alert(t("alert_status_update_failed") + err.message);
  }
});

function updateOnlineBtn() {
  if (!toggleOnlineBtn) return;

  const isApproved = driverApprovalStatus === "approved";
  toggleOnlineBtn.disabled = !isApproved;

  // â›” Ø­Ø³Ø§Ø¨ ØºÙŠØ± Ù…Ø¹ØªÙ…Ø¯
  if (!isApproved) {
    toggleOnlineBtn.classList.remove("blink");
    playOnlineSoundNext = false;
    toggleOnlineBtn.textContent = t("driver_not_approved_status_btn");
    toggleOnlineBtn.style.backgroundColor = "#6c757d";

    // Ù†Øµ Ø§Ù„ÙƒØ¨Ø³ÙˆÙ„Ø© Ø§Ù„Ø³ÙÙ„ÙŠØ©: Ø§Ù„Ø­Ø³Ø§Ø¨ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©
    if (driverStatusTextEl) {
      driverStatusTextEl.textContent = t("driver_not_approved_hint");
    }
    return;
  }

  // âœ… Ø­Ø³Ø§Ø¨ Ù…Ø¹ØªÙ…Ø¯: Ù†Ø³ØªØ®Ø¯Ù… Ù…Ù†Ø·Ù‚ Ø§Ù„Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†/Ø£ÙˆÙÙ„Ø§ÙŠÙ† Ø§Ù„Ø¹Ø§Ø¯ÙŠ
  toggleOnlineBtn.textContent = driverCurrentOnline
    ? t("online_btn_online")
    : t("online_btn_offline");
  toggleOnlineBtn.style.backgroundColor = driverCurrentOnline
    ? "#28a745"
    : "#6c757d";

  // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ÙˆÙ…ÙŠØ¶ Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ø¨Ø¹Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ­Ø¯ÙŠØ«
  toggleOnlineBtn.classList.remove("blink");

  // ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† ÙÙ‚Ø· Ø¹Ù†Ø¯Ù…Ø§ ØªÙ… Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± Ù„Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†
  if (driverCurrentOnline && playOnlineSoundNext && onlineSoundEl) {
    try {
      onlineSoundEl.currentTime = 0;
      onlineSoundEl.play();
    } catch (e) {
      console.warn("ØªØ¹Ø°Ø± ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†:", e);
    }
  }
  playOnlineSoundNext = false;

  // Ù†Øµ Ø§Ù„ÙƒØ¨Ø³ÙˆÙ„Ø© Ø§Ù„Ø³ÙÙ„ÙŠØ© ÙÙ‚Ø· Ø¥Ø°Ø§ Ù…Ø§ ÙÙŠ Ø·Ù„Ø¨Ø§Øª Ù†Ø´Ø·Ø©
  if (driverStatusTextEl) {
    const hasActive =
      Array.isArray(lastDriverCalls) &&
      lastDriverCalls.some((o) => {
        const s = (o.status || "pending").toLowerCase();
        return !(
          s === "delivered" ||
          s === "cancelled" ||
          s === "rejected"
        );
      });

    if (!hasActive) {
      driverStatusTextEl.textContent = driverCurrentOnline
        ? t("status_hint_online")
        : t("status_hint_offline");
    }
  }
}
function hasDriverApprovalModalBeenShown(uid) {
  if (!uid) return false;
  try {
    return localStorage.getItem("driverApprovalShown_" + uid) === "1";
  } catch (e) {
    return false;
  }
}

function markDriverApprovalModalShown(uid) {
  if (!uid) return;
  try {
    localStorage.setItem("driverApprovalShown_" + uid, "1");
  } catch (e) {}
}

function showDriverApprovalModal() {
  if (!driverApprovalOverlay) return;

  driverApprovalOverlay.classList.remove("hidden");

  if (driverApprovalSoundEl) {
    try {
      driverApprovalSoundEl.currentTime = 0;
      const p = driverApprovalSoundEl.play();
      if (p && typeof p.catch === "function") {
        p.catch((err) => {
          console.warn("ØªØ¹Ø°Ø± ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ø³Ø§Ø¦Ù‚:", err);
        });
      }
    } catch (e) {
      console.warn("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ø³Ø§Ø¦Ù‚:", e);
    }
  }
}

// Ø²Ø± "Ø¥Ø¨Ø¯Ø£" ÙÙŠ Ù…Ù†Ø¨Ø«Ù‚ Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ø³Ø§Ø¦Ù‚
if (driverApprovalStartBtn && driverApprovalOverlay) {
  driverApprovalStartBtn.addEventListener("click", () => {
    driverApprovalOverlay.classList.add("hidden");
    if (driverUid) {
      markDriverApprovalModalShown(driverUid);
    }
  });
}

/* ========== ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ Ø§Ù„Ø³Ø§Ø¦Ù‚ ========== */
driverLogoutBtn.addEventListener("click", async () => {
  if (!driverUid) return;

  try {
    const driverRef = db.collection("drivers").doc(driverUid);
    const snap = await driverRef.get();
    const data = snap.exists ? snap.data() : {};
    const isBusy = !!(data && data.busy);
    const hasActiveJob = driverHasActiveJob();

    if (isBusy || hasActiveJob) {
      alert(t("alert_logout_forbidden_while_busy"));
      return;
    }

    // ğŸ”“ ØªÙ†Ø¸ÙŠÙ Ø¬Ù„Ø³Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚ ÙÙŠ Firestore
    await releaseDriverSession();

    // Ø¥ÙŠÙ‚Ø§Ù ØªØªØ¨Ø¹ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
    stopDriverLocationTracking();
    stopMedianBackgroundLocation();
    clearRouteAndNavigation();

    // Ø¥ÙŠÙ‚Ø§Ù Ø£ÙŠ Ù…Ø³ØªÙ…Ø¹Ø§Øª Realtime
    if (driverOrdersListener) {
      driverOrdersListener();
      driverOrdersListener = null;
    }
    if (driverCallsListener) {
      driverCallsListener();
      driverCallsListener = null;
    }
    if (driverDocListener) {
      driverDocListener();
      driverDocListener = null;
    }

    await auth.signOut();

    // ğŸ‘‡ ØªÙ†Ø¸ÙŠÙ Ù…ØªØºÙŠÙ‘Ø± Median
    window.TAUSSIL_DRIVER_ID = null;

    // ØªÙ†Ø¸ÙŠÙ Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ø¬Ù„Ø³Ø© Ù…Ù† localStorage
    try {
      localStorage.removeItem("driverLastUid");
      localStorage.removeItem("driverLastClosedAt");
    } catch (e) {}

    driverDashboard.classList.add("hidden");
    registerSection.classList.remove("hidden");
    loginSection.classList.remove("hidden");
    if (mainHeader) mainHeader.classList.remove("hidden");
    if (authTabs) authTabs.classList.remove("hidden");
    if (footerEl) footerEl.classList.remove("hidden");
    if (authLangSwitcher) authLangSwitcher.classList.remove("hidden");
    document.body.classList.remove("driver-mode");

    driverUid = null;
    driverCurrentOnline = false;
    driverDashboardShownOnce = false;

  } catch (err) {
    alert(t("alert_logout_failed") + err.message);
  }
});

// ØªÙˆÙ„ÙŠØ¯ id Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù„Ù„Ø¬Ù„Ø³Ø©
function generateSessionId() {
  return (
    Date.now().toString(36) +
    "_" +
    Math.random().toString(36).substr(2, 9)
  );
}

// Ù…Ø­Ø§ÙˆÙ„Ø© Ø­Ø¬Ø² Ø¬Ù„Ø³Ø© Ø­ØµØ±ÙŠØ© Ù„Ù‡Ø°Ø§ Ø§Ù„Ø³Ø§Ø¦Ù‚
async function claimSingleDriverSession(uid) {
  const driverRef = db.collection("drivers").doc(uid);
  const snap = await driverRef.get();

  if (!snap.exists) {
    alert("Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø§Ø¦Ù‚ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯");
    return null;
  }

  const data = snap.data() || {};

  // Ù†Ø­Ø§ÙˆÙ„ Ù†Ù‚Ø±Ø£ session Ù…Ø®Ø²Ù‘Ù†Ø© Ù…Ø­Ù„ÙŠØ§Ù‹ (Ù†ÙØ³ Ø§Ù„Ù…ØªØµÙØ­)
  let localSessionId = null;
  try {
    localSessionId = localStorage.getItem("driverSessionId") || null;
  } catch (e) {}

  // ÙÙŠ Ø¬Ù„Ø³Ø© Ù…ÙØ¹Ù‘Ù„Ø© Ø£ØµÙ„Ø§Ù‹
  if (data.activeSessionId) {
    // Ù„Ùˆ Ù†ÙØ³ Ø§Ù„Ù€ sessionId Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ Ø¹Ù†Ø¯Ù†Ø§ Ù…Ø­Ù„ÙŠØ§Ù‹ â†’ Ù†ÙØ³ Ø§Ù„Ø¬Ù‡Ø§Ø²/Ø§Ù„Ù…ØªØµÙØ­ â†’ Ù†Ø³Ù…Ø­
    if (localSessionId && localSessionId === data.activeSessionId) {
      activeDriverSessionId = localSessionId;
      return localSessionId;
    }

    // ØºÙŠØ± ÙƒØ°Ø§ â†’ Ø¬Ù‡Ø§Ø² Ø«Ø§Ù†ÙŠ
    alert("Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…Ø³ØªØ®Ø¯Ù… Ø­Ø§Ù„ÙŠØ§Ù‹ Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø² Ø¢Ø®Ø±. Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„Ø¢Ø®Ø± Ø£ÙˆÙ„Ø§Ù‹.");
    return null;
  }

  // Ù…Ø§ ÙÙŠ Ø¬Ù„Ø³Ø© â†’ Ù†Ù†Ø´Ø¦ ÙˆØ§Ø­Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©
  const sessionId = generateSessionId();

  await driverRef.update({
    activeSessionId: sessionId,
    activeSessionStartedAt: firebase.firestore.FieldValue.serverTimestamp()
  });

  try {
    localStorage.setItem("driverSessionId", sessionId);
  } catch (e) {}

  activeDriverSessionId = sessionId;
  return sessionId;
}

// ØªÙ†Ø¸ÙŠÙ Ø¬Ù„Ø³Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚ Ø¹Ù†Ø¯ Ø§Ù„Ø®Ø±ÙˆØ¬/Ø§Ù„Ù„ÙˆØ¬ Ø£ÙˆØª
async function releaseDriverSession() {
  if (!driverUid || !activeDriverSessionId) return;

  const driverRef = db.collection("drivers").doc(driverUid);

  try {
    await driverRef.update({
      activeSessionId: firebase.firestore.FieldValue.delete()
    });
  } catch (e) {
    console.warn("ØªØ¹Ø°Ø± ØªÙ†Ø¸ÙŠÙ Ø¬Ù„Ø³Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚:", e);
  }

  try {
    const saved = localStorage.getItem("driverSessionId");
    if (saved && saved === activeDriverSessionId) {
      localStorage.removeItem("driverSessionId");
    }
  } catch (e) {}

  activeDriverSessionId = null;
}

/* ========== ÙØªØ­ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚ Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ========== */
async function showDriverDashboard(uid) {
  // ğŸ‘‡ Ù…Ù‡Ù… Ø¬Ø¯Ø§Ù‹ Ù„Ø§Ù†Ø¯Ù…Ø§Ø¬ Median: ØªØ¹Ø±ÙŠØ¶ uid ÙÙŠ window
  window.TAUSSIL_DRIVER_ID = uid;
  console.log("TAUSSIL_DRIVER_ID set in showDriverDashboard:", uid);

  // ğŸ”’ Ø£ÙˆÙ„Ø§Ù‹: Ù†Ø­Ø¬Ø² Ø¬Ù„Ø³Ø© Ø­ØµØ±ÙŠØ© Ù„Ù‡Ø°Ø§ Ø§Ù„Ø³Ø§Ø¦Ù‚
  const sessionId = await claimSingleDriverSession(uid);
  if (!sessionId) {
    // Ù„Ù… Ù†Ø³ØªØ·Ø¹ Ø­Ø¬Ø² Ø§Ù„Ø¬Ù„Ø³Ø© (Ù†Ø´Ø·Ø© Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø² Ø¢Ø®Ø±)
    return;
  }

  const driverRef = db.collection("drivers").doc(uid);
  const driverDoc = await driverRef.get();
  if (!driverDoc.exists) {
    alert("Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø§Ø¦Ù‚ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯");
    return;
  }
  const driverData = driverDoc.data() || {};
// ğŸ§© Ù„Ùˆ Ø§Ù„Ø³Ø§Ø¦Ù‚ "Ù…ÙˆØ¸Ù Ù„Ø¯Ù‰ Taussil" Ù†Ø¶Ù…Ù† Ø£Ù† Ø§Ù„ØªØ³Ø¹ÙŠØ±Ø© = ØªØ³Ø¹ÙŠØ±Ø© Taussil Ø¯Ø§Ø¦Ù…Ø§Ù‹
  if (driverData.driverType === "employee") {
    if (driverData.pricingMode !== "independent_tiered") {
      try {
        await driverRef.update({ pricingMode: "independent_tiered" });
        driverData.pricingMode = "independent_tiered";
      } catch (e) {
        console.warn("ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ« ØªØ³Ø¹ÙŠØ±Ø© Ø§Ù„Ù…ÙˆØ¸Ù Ø¥Ù„Ù‰ Taussil:", e);
      }
    }
  }

  currentDriverData = driverData;
  driverUid = uid;

  // âœ… Ù†Ù‚Ø±Ø£ Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ù…Ù† Ø§Ù„ÙˆØ«ÙŠÙ‚Ø© (Ø§ÙØªØ±Ø§Ø¶ÙŠÙ‹Ø§ pending)
  driverApprovalStatus = driverData.approvalStatus || "pending";
  const isApproved = driverApprovalStatus === "approved";

  // âœ… Ø§Ù„Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† Ù…Ø³Ù…ÙˆØ­ ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† Approved
  driverCurrentOnline = isApproved && !!driverData.online;
  updateOnlineBtn();

  // Ø§Ø³Ù… Ø§Ù„Ø³Ø§Ø¦Ù‚
  if (driverNameEl) {
    driverNameEl.textContent =
      (driverData.firstName || "") + " " + (driverData.lastName || "");
  }

  // âœ… ØªØ­Ø¯ÙŠØ« ØµÙˆØ±Ø© Ø§Ù„Ù…Ø±ÙƒØ¨Ø© ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©
  updateDriverVehicleIcon(driverData.vehicleType || "");

  // Ø¥Ø¸Ù‡Ø§Ø± ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚
  registerSection.classList.add("hidden");
  loginSection.classList.add("hidden");

  if (mainHeader) mainHeader.classList.add("hidden");
  if (authTabs) authTabs.classList.add("hidden");
  if (footerEl) footerEl.classList.add("hidden");
  if (authLangSwitcher) authLangSwitcher.classList.add("hidden"); // âœ… Ø¥Ø®ÙØ§Ø¡ Ø´Ø±ÙŠØ· Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ù„ÙˆÙŠ

  driverDashboard.classList.remove("hidden");
  document.body.classList.add("driver-mode");
// Ø²Ø± Ø¥Ø¹Ø¯Ø§Ø¯ ØªÙƒØ§Ù„ÙŠÙ Ø§Ù„ØªÙˆØµÙŠÙ„: ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· Ù„Ù„Ø³Ø§Ø¦Ù‚ Ø§Ù„Ù…Ø³ØªÙ‚Ù„
  if (pricingSettingsBtn) {
    if (driverData.driverType === "employee") {
      pricingSettingsBtn.style.display = "none";
    } else {
      pricingSettingsBtn.style.display = "";
    }
  }
  // ØªÙ‡ÙŠØ¦Ø© Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚
  initDriverMap();

  // ØªØ¹Ø¨Ø¦Ø© Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ³Ø¹ÙŠØ± Ù…Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ø§Ø¦Ù‚ Ø§Ù„Ø­Ø§Ù„ÙŠØ©
  populatePricingFormFromData();

  driverOrdersInitialLoaded = false;
  listenDriverOrders(uid);

  // âœ… Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù†Ø¯Ø§Ø¡Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© ÙÙ‚Ø· Ø¥Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…Ø¹ØªÙ…Ø¯
  if (isApproved) {
    listenDriverCalls(uid);
  } else if (driverCallsListener) {
    driverCallsListener();
    driverCallsListener = null;
  }

  // Ù…Ù†Ø¨Ø«Ù‚ Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ø³Ø§Ø¦Ù‚ Ù„Ùˆ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…Ø¹ØªÙ…Ø¯ ÙˆÙ„Ù… ÙŠØ¸Ù‡Ø± Ù…Ù† Ù‚Ø¨Ù„
  if (isApproved && !hasDriverApprovalModalBeenShown(uid)) {
    showDriverApprovalModal();
  }

  // ğŸ”„ Ø§Ø³ØªÙ…Ø§Ø¹ Ø­ÙŠ Ù„ØªØºÙŠÙŠØ±Ø§Øª ÙˆØ«ÙŠÙ‚Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚ (Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ / Ø§Ù„Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† ...)
  if (driverDocListener) {
    driverDocListener();
    driverDocListener = null;
  }

  driverDocListener = driverRef.onSnapshot((snap) => {
    if (!snap.exists) return;

    const data = snap.data() || {};
    currentDriverData = data;

    const prevApproval = driverApprovalStatus;
    driverApprovalStatus = data.approvalStatus || "pending";
    const isApprovedNow = driverApprovalStatus === "approved";
    const wasApproved = prevApproval === "approved";

    // Ù…Ø²Ø§Ù…Ù†Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† Ù…Ø¹ Firestore (ÙÙ‚Ø· Ù„Ùˆ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…Ø¹ØªÙ…Ø¯)
    driverCurrentOnline = isApprovedNow && !!data.online;
    updateOnlineBtn();

    // Ø£ÙˆÙ„ Ù…Ø±Ø© ÙŠØªØ­ÙˆÙ„ ÙÙŠÙ‡Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¥Ù„Ù‰ approved Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø©
    if (!wasApproved && isApprovedNow && !hasDriverApprovalModalBeenShown(uid)) {
      showDriverApprovalModal();
    }

    // Ø¥Ø¯Ø§Ø±Ø© Ø§Ø³ØªÙ…Ø§Ø¹ Ø§Ù„Ù†Ø¯Ø§Ø¡Ø§Øª Ø­Ø³Ø¨ Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯
    if (isApprovedNow && !driverCallsListener) {
      listenDriverCalls(uid);
    } else if (!isApprovedNow && driverCallsListener) {
      driverCallsListener();
      driverCallsListener = null;
    }
  });
}

// ØªØ´ØºÙŠÙ„ ØªØªØ¨Ø¹ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ© (watchPosition Ù…Ø³ØªÙ‚Ù„ Ø¹Ù† Ø§Ù„ØªÙˆØ¬ÙŠÙ‡)
function startDriverLocationTracking() {
  if (!driverCurrentOnline) return;
  if (!navigator.geolocation) {
    console.warn("Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù„ØªØªØ¨Ø¹ Ø§Ù„Ø³Ø§Ø¦Ù‚.");
    return;
  }
  if (locationWatchId !== null) return; // Ø´ØºØ§Ù„ Ø£ØµÙ„Ø§Ù‹

  const watchOptions = {
    enableHighAccuracy: true,
    maximumAge: 5000,
    timeout: 20000
  };

  locationWatchId = navigator.geolocation.watchPosition(
    (pos) => {
      const lat = pos.coords.latitude;
      const lng = pos.coords.longitude;
      // Ù‡Ù†Ø§ ÙÙ‚Ø· Ù†ÙƒØªØ¨ ÙÙŠ Firestore (Ù…Ø¹ Throttle Ø¯Ø§Ø®Ù„ÙŠ)
      handleDriverLocationUpdate(lat, lng);
    },
    (err) => {
      console.warn("Ø®Ø·Ø£ ÙÙŠ ØªØªØ¨Ø¹ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø³Ø§Ø¦Ù‚ ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©:", err);
    },
    watchOptions
  );
}

// Ø¥ÙŠÙ‚Ø§Ù ØªØªØ¨Ø¹ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©
function stopDriverLocationTracking() {
  if (locationWatchId !== null && navigator.geolocation) {
    navigator.geolocation.clearWatch(locationWatchId);
  }
  locationWatchId = null;
}

function formatDate(d) {
  if (!d) return "";
  return d.toLocaleString();
}
function escapeHtml(s) {
  if (!s) return "";
  return String(s).replace(/[&<>"]/g, function (c) {
    return { "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;" }[c];
  });
}
function getPaymentTypeLabel(o) {
  const pt = (o && o.paymentType)
    ? String(o.paymentType).toLowerCase()
    : "";

  if (pt === "cash") return t("paymentType_cash");
  if (pt === "online") return t("paymentType_online");
  return t("paymentType_unknown");
}

function formatCashAmount(o) {
  if (!o) return "";
  let amount = null;

  if (typeof o.cashAmount === "number") {
    amount = o.cashAmount;
  } else if (typeof o.orderPrice === "number") {
    amount = o.orderPrice;
  }

  if (amount == null || isNaN(amount)) return "";
  return amount.toFixed(2) + " â‚¬";
}
function getCashAmountNumeric(o) {
  if (!o) return 0;
  if (!isCashOrder(o)) return 0;

  // Ø£ÙˆÙ„ÙˆÙŠØ©: cashAmount Ø¥Ù† ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø© Ø±Ù‚Ù…ÙŠØ§Ù‹
  if (typeof o.cashAmount === "number") {
    return o.cashAmount;
  }

  // Ø¨Ø¯ÙŠÙ„: orderPrice Ù„Ùˆ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„ÙƒØ§Ø´ Ø¨Ø¯ÙˆÙ† cashAmount Ù…Ø³ØªÙ‚Ù„
  if (typeof o.orderPrice === "number") {
    return o.orderPrice;
  }

  return 0;
}

function isCashOrder(o) {
  if (!o) return false;

  if (typeof o.paymentType === "string" &&
      o.paymentType.toLowerCase() === "cash") {
    return true;
  }

  if (o.collectCash === true) return true;

  return false;
}

// ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø¹Ù†Ø¯ ÙˆØµÙˆÙ„ Ù†Ø¯Ø§Ø¡ Ø¬Ø¯ÙŠØ¯
function playNewCallSound() {
  if (!callSoundEl) return;

  try {
    callSoundEl.currentTime = 0;   // Ù…Ù† Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙƒÙ„ Ù…Ø±Ø©
    callSoundEl.volume = 1.0;      // ØªÙ‚Ø¯Ø± ØªÙ†Ù‚ØµÙ‡Ø§ Ù…Ø«Ù„Ø§Ù‹ 0.6 Ù„Ùˆ ØµÙˆØª Ø¹Ø§Ù„ÙŠ

    const p = callSoundEl.play();
    if (p && typeof p.catch === "function") {
      p.catch((err) => {
        console.warn("Ù„Ù… ÙŠØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª (Ù‚Ø¯ ÙŠÙ…Ù†Ø¹Ù‡ Ø§Ù„Ù…ØªØµÙØ­ Ø­ØªÙ‰ ÙŠÙ†Ù‚Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…):", err);
      });
    }
  } catch (e) {
    console.warn("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„Ù†Ø¯Ø§Ø¡:", e);
  }
}
// Ø¨Ø¯Ø¡ ØªÙƒØ±Ø§Ø± ØµÙˆØª Ø§Ù„Ù†Ø¯Ø§Ø¡ ÙƒÙ„ 5 Ø«ÙˆØ§Ù†Ù
function startNewCallSoundLoop(callId) {
  // Ø£ÙˆÙ‚Ù Ø£ÙŠ ØªØ§ÙŠÙ…Ø± Ù‚Ø¯ÙŠÙ…
  stopNewCallSoundLoop();

  currentRingingCallId = callId || null;

  // ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª ÙÙˆØ±Ø§Ù‹ Ø£ÙˆÙ„ Ù…Ø±Ø©
  playNewCallSound();

  // Ø«Ù… ØªÙƒØ±Ø§Ø± ÙƒÙ„ 5 Ø«ÙˆØ§Ù†Ù
  newCallSoundTimer = setInterval(() => {
    playNewCallSound();
  }, 5000);
}

// Ø¥ÙŠÙ‚Ø§Ù ØªÙƒØ±Ø§Ø± Ø§Ù„ØµÙˆØª (Ø§Ø®ØªÙŠØ§Ø±ÙŠÙ‹Ø§ Ù…Ù‚ÙŠÙ‘Ø¯ Ø¨Ù†Ø¯Ø§Ø¡ Ù…Ø¹ÙŠÙ‘Ù†)
function stopNewCallSoundLoop(callId) {
  // Ù„Ùˆ Ù…Ø±Ù‘Ø±Ù†Ø§ callId ØªØ£ÙƒØ¯ Ø¥Ù†Ù‡ Ù†ÙØ³ Ø§Ù„Ù†Ø¯Ø§Ø¡ Ø§Ù„Ø°ÙŠ ÙŠØ±Ù† Ø­Ø§Ù„ÙŠØ§Ù‹
  if (callId && currentRingingCallId && callId !== currentRingingCallId) {
    return;
  }

  if (newCallSoundTimer) {
    clearInterval(newCallSoundTimer);
    newCallSoundTimer = null;
  }
  currentRingingCallId = null;
}

// ØªØ±Ø¬Ù…Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ Ø­Ø³Ø¨ Ø§Ù„Ù€ status code
function getStatusLabel(status) {
  const s = (status || "accepted").toLowerCase();
  const map = {
    pending: "status_pending",
    accepted: "status_accepted",
    in_progress: "status_inProgress",
    heading_to_customer: "status_inProgress", // ğŸ‘ˆ Ù†ÙØ³ ØªØ±Ø¬Ù…Ø© "Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°"
    delivered: "status_delivered",
    cancelled: "status_cancelled",
    rejected: "status_rejected"
  };
  const key = map[s] || "status_unknown";
  return t(key);
}

/* Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚ */
function initDriverMap() {
  if (!driverMapContainer) return;

  const defaultCenter = { lat: 25.276987, lng: 55.296249 };
  let center = defaultCenter;

  if (
    currentDriverData &&
    typeof currentDriverData.lat === "number" &&
    typeof currentDriverData.lng === "number"
  ) {
    center = { lat: currentDriverData.lat, lng: currentDriverData.lng };
  }

  try {
    if (!driverMap && typeof google !== "undefined" && google.maps && google.maps.Map) {
     driverMap = new google.maps.Map(driverMapContainer, {
  center,
  zoom: 16,

  // â¬… Ù…Ù‡Ù… Ø¬Ø¯Ø§Ù‹: Ù†ÙØ³ Ø§Ù„Ù€ Map ID Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ø§Ù„Ø³ÙƒØ±Ø¨Øª
  mapId: "a07979cd0230b599b0df811d",

  // Ù†Ø¶Ù…Ù† Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù€ Vector Map
  renderingType: google.maps.RenderingType.VECTOR,

  disableDefaultUI: true,
  zoomControl: false,
  gestureHandling: "greedy",

  // ÙˆØ¶Ø¹ Ù…Ø¨Ø¯Ø¦ÙŠ Ù„Ù„Ù…Ù„Ø§Ø­Ø©
  tilt: 45,
  heading: 0,

  // ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ¯ÙˆÙŠØ± ÙˆØ§Ù„Ø¥Ù…Ø§Ù„Ø© Ø¨Ø§Ù„Ù€ Gestures / Ø§Ù„ÙƒÙŠØ¨ÙˆØ±Ø¯
  tiltInteractionEnabled: true,
  headingInteractionEnabled: true,
});
// ğŸ” ØªØ´Ø®ÙŠØµ Ù†ÙˆØ¹ Ø§Ù„Ø®Ø±ÙŠØ·Ø© ÙˆØ¯Ø¹Ù… Ø§Ù„ØªØ¯ÙˆÙŠØ±
try {
  console.log("supports setHeading?:", typeof driverMap.setHeading);
  if (typeof driverMap.getRenderingType === "function") {
    console.log("map renderingType:", driverMap.getRenderingType());
  }
} catch (e) {
  console.warn("debug map renderingType failed:", e);
}

    } else if (driverMap) {
      driverMap.setCenter(center);
    }

    // ØªÙ‡ÙŠØ¦Ø© Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…Ø³Ø§Ø± ÙˆØ¹Ø±Ø¶Ù‡ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
    if (typeof google !== "undefined" && google.maps) {
      if (!directionsService) {
        directionsService = new google.maps.DirectionsService();
      }
      if (!directionsRenderer) {
        directionsRenderer = new google.maps.DirectionsRenderer({
  suppressMarkers: true,
  preserveViewport: false,
  polylineOptions: {
    strokeOpacity: 0 // Ù†Ø®ÙÙŠ Ø®Ø· Google Ø§Ù„Ø£Ø²Ø±Ù‚ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
  }
});
directionsRenderer.setMap(driverMap);

      }

      // ØªÙ‡ÙŠØ¦Ø© Ø­Ù‚Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù…Ø¹ Google Places Autocomplete
      initCustomerAutocomplete();
    }
  } catch(e) {
    console.error("ØªØ¹Ø°Ø± ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø®Ø±ÙŠØ·Ø©:", e);
  }
}

function showDriverRouteToMerchant(startLat, startLng, merchantLat, merchantLng) {
  if (!driverMap || typeof google === "undefined" || !google.maps) return;
  if (merchantLat == null || merchantLng == null) return;

  if (!directionsService) {
    directionsService = new google.maps.DirectionsService();
  }

  const origin = { lat: startLat, lng: startLng };
  const destination = { lat: merchantLat, lng: merchantLng };

  directionsService.route(
    {
      origin,
      destination,
      travelMode: google.maps.TravelMode.DRIVING
    },
    (result, status) => {
      if (status === "OK") {
        // Ù†Ø¨Ù‚ÙŠ Ø§Ø³ØªØ®Ø¯Ø§Ù… DirectionsRenderer Ù„Ùˆ Ø­Ø§Ø¨ Ù„Ù…Ù„Ø§Ø¦Ù…Ø© Ø§Ù„Ù€ viewport
        if (directionsRenderer) {
          directionsRenderer.setDirections(result);
        }

        // Ø¨Ù†Ø§Ø¡ Ù…Ø³Ø§Ø± Ù…Ø®ØµØµ Ù…Ù† Ù†Ù‚Ø§Ø· Ø§Ù„Ø­Ø±ÙƒØ§Øª (steps.path)
        const route = result.routes[0];
        const path = [];
        route.legs.forEach((leg) => {
          leg.steps.forEach((step) => {
            step.path.forEach((p) => path.push(p));
          });
        });

        routePath = path;

        // ØªÙ†Ø¸ÙŠÙ Ø£ÙŠ Ø¨ÙˆÙ„ÙŠÙ„Ø§ÙŠÙ† Ø³Ø§Ø¨Ù‚
        if (remainingRoutePolyline) {
          remainingRoutePolyline.setMap(null);
        }

        remainingRoutePolyline = new google.maps.Polyline({
          path: routePath,
          strokeColor: "#4285F4",
          strokeOpacity: 0.9,
          strokeWeight: 5,
          map: driverMap
        });

        // Ù…Ø§Ø±ÙƒØ± Ø§Ù„Ù…ØªØ¬Ø±
        const destinationLatLng = { lat: merchantLat, lng: merchantLng };
        if (!merchantMarker) {
          merchantMarker = new google.maps.Marker({
            map: driverMap,
            position: destinationLatLng,
            icon: getMerchantMarkerIcon()
          });
        } else {
          merchantMarker.setPosition(destinationLatLng);
          merchantMarker.setMap(driverMap);
        }
      } else {
        console.error("ÙØ´Ù„ Ø±Ø³Ù… Ø§Ù„Ù…Ø³Ø§Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©:", status, result);
        driverMap.setCenter(destination);
      }
    }
  );
}

function showDriverRouteToCustomer(startLat, startLng, destLat, destLng) {
  if (!driverMap || typeof google === "undefined" || !google.maps) return;
  if (destLat == null || destLng == null) return;

  if (!directionsService) {
    directionsService = new google.maps.DirectionsService();
  }

  const origin = { lat: startLat, lng: startLng };
  const destination = { lat: destLat, lng: destLng };

  directionsService.route(
    {
      origin,
      destination,
      travelMode: google.maps.TravelMode.DRIVING
    },
    (result, status) => {
      if (status === "OK") {
        if (directionsRenderer) {
          directionsRenderer.setDirections(result);
        }

        const route = result.routes[0];
        const path = [];
        route.legs.forEach((leg) => {
          leg.steps.forEach((step) => {
            step.path.forEach((p) => path.push(p));
          });
        });

        routePath = path;

        if (remainingRoutePolyline) {
          remainingRoutePolyline.setMap(null);
        }

        remainingRoutePolyline = new google.maps.Polyline({
          path: routePath,
          strokeColor: "#4285F4",
          strokeOpacity: 0.9,
          strokeWeight: 5,
          map: driverMap
        });
      } else {
        console.error("ÙØ´Ù„ Ø±Ø³Ù… Ø§Ù„Ù…Ø³Ø§Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©:", status, result);
        driverMap.setCenter(destination);
      }
    }
  );
}

/* Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ù…ØªØ¬Ø± ÙˆØ§Ù„Ø¹Ù…ÙŠÙ„ Ù„Ù„Ù…Ø§Ø±ÙƒØ±Ø§Øª */
function getMerchantMarkerIcon() {
  if (typeof google === "undefined" || !google.maps) return null;
  return {
    url: MERCHANT_MARKER_ICON_PATH,              // Ù…Ù„Ù Ø§Ù„ØµÙˆØ±Ø©
    scaledSize: new google.maps.Size(52, 52),    // Ø­Ø¬Ù… Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
    origin: new google.maps.Point(0, 0),
    anchor: new google.maps.Point(26, 46)        // Ù†Ù‚Ø·Ø© Ø§Ù„Ø§Ø±ØªÙƒØ§Ø² (Ø£Ø³ÙÙ„ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹)
  };
}


/* ØªÙ‡ÙŠØ¦Ø© Google Places Autocomplete Ù„Ø­Ù‚Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„ */
function initCustomerAutocomplete() {
  if (!customerAddressInput) return;
  if (typeof google === "undefined" || !google.maps || !google.maps.places) return;

  if (customerAutocomplete) return; // ØªÙ… Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø³Ø§Ø¨Ù‚Ø§Ù‹

  customerAutocomplete = new google.maps.places.Autocomplete(customerAddressInput, {
    fields: ["formatted_address", "geometry"],
    types: ["geocode"]
  });

  customerAutocomplete.addListener("place_changed", () => {
    const place = customerAutocomplete.getPlace();
    if (!place || !place.geometry || !place.geometry.location) {
      alert(t("alert_address_geocode_failed"));

      return;
    }
    const lat = place.geometry.location.lat();
    const lng = place.geometry.location.lng();
    const address = place.formatted_address || customerAddressInput.value || "";
    setCustomerDestination(lat, lng, address);
  });
}

/* Ø¶Ø¨Ø· Ù†Ù‚Ø·Ø© ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø© + Ø­ÙØ¸Ù‡Ø§ ÙÙŠ Ø§Ù„Ù€ calls (Ø§Ù„Ø³Ø§Ø¦Ù‚ + Ø§Ù„ØªØ§Ø¬Ø±) */
async function setCustomerDestination(lat, lng, address) {
  if (!driverMap) return;

  customerDestination = { lat, lng, address };

  // Ù…Ø§Ø±ÙƒØ± Ø§Ù„Ø¹Ù…ÙŠÙ„ (Ø£ÙŠÙ‚ÙˆÙ†Ø© Ù…Ø³ØªØ®Ø¯Ù…)
  if (!customerMarker) {
    customerMarker = new google.maps.Marker({
      map: driverMap,
      position: { lat, lng },
      icon: getCustomerMarkerIcon()
    });
  } else {
    customerMarker.setPosition({ lat, lng });
    customerMarker.setMap(driverMap);
  }

  driverMap.panTo({ lat, lng });

  const activeCall = getCurrentActiveCall();
  if (activeCall) {
    try {
      await updateDriverCallAndMerchant(activeCall.id, {
        deliveryAddress: address,
        customerLat: lat,
        customerLng: lng
      });
    } catch (err) {
      console.error("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„:", err);
    }
  }
}

/* Ø¨Ø¯Ø¡ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù…Ù† Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø³Ø§Ø¦Ù‚ Ø§Ù„Ø­Ø§Ù„ÙŠ (Ù…Ø¹ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ â†’ heading_to_customer) */
function startCustomerNavigation() {
  if (
    !customerDestination ||
    customerDestination.lat == null ||
    customerDestination.lng == null
  ) {
    alert(t("alert_customer_address_required"));
    return;
  }

  if (!navigator.geolocation) {
    alert(t("alert_geo_not_supported"));
    return;
  }

  // ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù‡Ù†Ø§Ùƒ Ø·Ù„Ø¨ Ù†Ø´Ø· Ù„Ù†Ø±Ø¨Ø·Ù‡ Ø¨Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø­Ù„Ø©
  const activeCall = getCurrentActiveCall();
  if (!activeCall) {
    alert("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨ Ù†Ø´Ø· Ù…Ø±ØªØ¨Ø· Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø­Ø§Ù„ÙŠØ§Ù‹.");
    return;
  }
  const callId = activeCall.id;

  const geoOptions = {
    enableHighAccuracy: true,
    timeout: 20000,
    maximumAge: 5000
  };

  navigator.geolocation.getCurrentPosition(
    (pos) => {
      const startLat = pos.coords.latitude;
      const startLng = pos.coords.longitude;

      // Ø±Ø³Ù… Ù…Ø³Ø§Ø± Ù…Ù† Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø³Ø§Ø¦Ù‚ Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ù…ÙŠÙ„
      showDriverRouteToCustomer(
        startLat,
        startLng,
        customerDestination.lat,
        customerDestination.lng
      );

      // Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ø­ÙŠ Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ù…ÙŠÙ„ (Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…)
      stopGuidance(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ø¬Ø¯ÙŠØ¯
      navigationMode = "customer"; // âœ… Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ø­Ø§Ù„ÙŠ: Ø§Ù„Ø¹Ù…ÙŠÙ„
      startGuidance(customerDestination.lat, customerDestination.lng);

      // ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ ÙÙŠ drivers/{driverId}/calls + merchants/.../calls
      updateDriverCallAndMerchant(callId, {
        status: "heading_to_customer",
        headingToCustomerStartedAt: firebase.firestore.FieldValue.serverTimestamp()
      }).catch((err) => {
        console.error("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„ØªÙˆØ¬Ù‡ Ù„Ù„Ø¹Ù…ÙŠÙ„:", err);
      });

      // (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) Ø¥Ø®ÙØ§Ø¡ Ù„ÙˆØ­Ø© Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø¹Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡
      if (customerAddressPanel && !customerAddressPanel.classList.contains("hidden")) {
        customerAddressPanel.classList.add("hidden");
      }
    },
    (err) => {
      alert(t("alert_geo_failed_prefix") + err.message);
    },
    geoOptions
  );
}

// ÙØªØ­ Ø§Ù„Ù…Ù„Ø§Ø­Ø© Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ø­Ø§Ù„ÙŠ Ø¹Ù„Ù‰ Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚
function openExternalNavigationToCurrentTarget() {
  let destLat = null;
  let destLng = null;

  // 1) Ù„Ùˆ Ø­Ø§Ù„ÙŠÙ‹Ø§ Ù†Ù…Ø´ÙŠ Ø¨Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø¹Ù…ÙŠÙ„
  if (
    navigationMode === "customer" &&
    customerDestination &&
    typeof customerDestination.lat === "number" &&
    typeof customerDestination.lng === "number"
  ) {
    destLat = customerDestination.lat;
    destLng = customerDestination.lng;
  }
  // 2) Ù„Ùˆ Ø­Ø§Ù„ÙŠÙ‹Ø§ Ù†Ù…Ø´ÙŠ Ø¨Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ù…ØªØ¬Ø±
  else if (navigationMode === "merchant") {
    const activeCall = getCurrentActiveCall();
    if (
      activeCall &&
      typeof activeCall.merchantLat === "number" &&
      typeof activeCall.merchantLng === "number"
    ) {
      destLat = activeCall.merchantLat;
      destLng = activeCall.merchantLng;
    }
  }

  // 3) Ø§Ø­ØªÙŠØ§Ø·ÙŠ: Ù„Ùˆ Ù…Ø§ Ø¹Ù†Ø¯Ù†Ø§ navigationMode ÙˆØ§Ø¶Ø­
  if (destLat == null || destLng == null) {
    // Ø£ÙˆÙ„ÙˆÙŠØ©: Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù„Ùˆ Ù…ÙˆØ¬ÙˆØ¯
    if (
      customerDestination &&
      typeof customerDestination.lat === "number" &&
      typeof customerDestination.lng === "number"
    ) {
      destLat = customerDestination.lat;
      destLng = customerDestination.lng;
    } else {
      // Ø¨Ø¯ÙŠÙ„: Ø§Ù„Ù…ØªØ¬Ø± Ù…Ù† Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ù†Ø´Ø·
      const activeCall = getCurrentActiveCall();
      if (
        activeCall &&
        typeof activeCall.merchantLat === "number" &&
        typeof activeCall.merchantLng === "number"
      ) {
        destLat = activeCall.merchantLat;
        destLng = activeCall.merchantLng;
      }
    }
  }

  // 4) Ù„Ùˆ Ù„Ø§ Ø¹Ù…ÙŠÙ„ ÙˆÙ„Ø§ Ù…ØªØ¬Ø± â†’ Ù…Ø§ ÙÙŠ Ù‡Ø¯Ù
  if (destLat == null || destLng == null) {
        alert(t("alert_no_active_target"));

    return;
  }

  // 5) ÙØªØ­ Google Maps (Ø£Ùˆ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ) Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø¯Ù
  const url = `https://www.google.com/maps/dir/?api=1&destination=${destLat},${destLng}&travelmode=driving`;
  window.open(url, "_blank"); // ØªØ¨ÙˆÙŠØ¨ / ØªØ·Ø¨ÙŠÙ‚ Ø¬Ø¯ÙŠØ¯
}

/* ØªÙ†Ø¸ÙŠÙ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙˆÙ…Ø§Ø±ÙƒØ±Ø§ØªÙ‡ Ù…Ù† Ø§Ù„Ø®Ø±ÙŠØ·Ø© */
function clearCustomerDestination() {
  customerDestination = null;
  if (customerMarker) {
    customerMarker.setMap(null);
    customerMarker = null;
  }
  if (customerAddressInput) {
    customerAddressInput.value = "";
  }
  if (customerAddressPanel && !customerAddressPanel.classList.contains("hidden")) {
    customerAddressPanel.classList.add("hidden");
  }
}
function clearOrderRoute() {
  // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø®Ø· Ø§Ù„Ø£Ø²Ø±Ù‚ Ø§Ù„Ù…Ø±Ø³ÙˆÙ… Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
  if (remainingRoutePolyline) {
    remainingRoutePolyline.setMap(null);
    remainingRoutePolyline = null;
  }

  // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ù…ØµÙÙˆÙØ© Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø³Ø§Ø±
  routePath = [];

  // ØªØ£ÙƒØ¯ Ø£ÙŠØ¶Ø§Ù‹ Ù…Ù† Ù…Ø³Ø­ Ø£ÙŠ Ù…Ø³Ø§Ø± Ù…Ù† Ø§Ù„Ù€ DirectionsRenderer
  if (directionsRenderer) {
    directionsRenderer.setDirections({ routes: [] });
  }
}

function updateRouteProgress(currentLatLng) {
  if (!remainingRoutePolyline || !routePath || routePath.length === 0) return;
  if (!google.maps || !google.maps.geometry || !google.maps.geometry.spherical) return;

  let closestIndex = 0;
  let minDist = Infinity;

  for (let i = 0; i < routePath.length; i++) {
    const p = routePath[i];
    const d = google.maps.geometry.spherical.computeDistanceBetween(
      currentLatLng,
      p
    );
    if (d < minDist) {
      minDist = d;
      closestIndex = i;
    }
  }

  // Ù„Ùˆ Ø§Ù„Ø³Ø§Ø¦Ù‚ Ø¨Ø¹ÙŠØ¯ Ø¬Ø¯Ø§Ù‹ Ø¹Ù† Ø§Ù„Ù…Ø³Ø§Ø± (Ù…Ø«Ù„Ø§Ù‹ Ø£ÙƒØ«Ø± Ù…Ù† 80Ù…) Ù„Ø§ Ù†Ù‚ØµÙ‘ Ø´ÙŠØ¡
  if (minDist > 80) return;

  const remaining = routePath.slice(closestIndex);
  remainingRoutePolyline.setPath(remaining);
}
// Ù‡Ø§Ù„Ø© Ù…ØªÙˆÙ‡Ø¬Ø© (Ø´Ø§Ø¯Ùˆ Ø£Ø²Ø±Ù‚) Ø­ÙˆÙ„ Ù…Ø§Ø±ÙƒØ± Ø§Ù„Ø³Ø§Ø¦Ù‚
function updateDriverGlow(currentLatLng) {
  if (!driverMap || typeof google === "undefined" || !google.maps) return;
  if (!currentLatLng) return;

  // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¯ÙˆØ§Ø¦Ø± Ø¥Ù† Ù„Ù… ØªÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø©
  if (!driverGlowInner) {
    driverGlowInner = new google.maps.Circle({
      map: driverMap,
      center: currentLatLng,
      radius: 10,               // Ø³ÙŠØªÙ… Ø¶Ø¨Ø·Ù‡ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹
      strokeColor: "#89d9ee",
      strokeOpacity: 0,
      strokeWeight: 0,
      fillColor: "#89d9ee",
      fillOpacity: 5.55         // Ù…Ø±ÙƒØ² Ù‚ÙˆÙŠ (Ø´Ø§Ø¯Ùˆ Ù…Ø±ÙƒÙ‘Ø²)
    });
  } else {
    driverGlowInner.setCenter(currentLatLng);
  }

  if (!driverGlowOuter) {
    driverGlowOuter = new google.maps.Circle({
      map: driverMap,
      center: currentLatLng,
      radius: 20,
      strokeColor: "#89d9ee",
      strokeOpacity: 0.4,
      strokeWeight: 1,
      fillColor: "#89d9ee",
      fillOpacity: 0.30
    });
  } else {
    driverGlowOuter.setCenter(currentLatLng);
  }

  // Ø¨Ø¯Ø¡ Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø§Ù„Ù†Ø¨Ø¶
  startDriverGlowAnimation();
}

function startDriverGlowAnimation() {
  if (driverGlowPulseInterval) return; // Ø´ØºÙ‘Ø§Ù„ Ø£ØµÙ„Ø§Ù‹

  let t = 0; // Ù…Ù† 0 â†’ 1

  driverGlowPulseInterval = setInterval(() => {
    if (!driverGlowInner || !driverGlowOuter || !driverMap) return;

    const center = driverGlowInner.getCenter();
    if (!center) return;

    const zoom = driverMap.getZoom() || 16;
    const latRad = (center.lat() * Math.PI) / 180;
    const metersPerPixel =
      156543.03392 * Math.cos(latRad) / Math.pow(2, zoom);

    // ğŸŸ¦ Ø­Ø¬Ù… Ø§Ù„Ù‡Ø§Ù„Ø© Ø¨Ø§Ù„Ù†Ø³Ø¨Ø© Ù„Ù„Ù…Ø§Ø±ÙƒØ± (Ø¨Ø§Ù„Ø¨ÙƒØ³Ù„)
    const baseRadiusPx = 10;     // ÙŠØ­ÙŠØ· Ø¨Ø§Ù„Ù…Ø¤Ø´Ø± (Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø«Ø§Ø¨Øª)
    const extraRadiusPx = 20;    // Ù…Ø¯Ù‰ Ø§Ù„Ù†Ø¨Ø¶Ø© (Ø§Ù†ØªØ´Ø§Ø± Ø§Ù„Ø´Ø§Ø¯Ùˆ)

    const baseRadiusM = baseRadiusPx * metersPerPixel;
    const extraRadiusM = extraRadiusPx * metersPerPixel;

    // t ÙŠØªØ­Ø±Ùƒ Ù…Ù† 0 â†’ 1
    t += 0.03;
    if (t > 1) t = 0;

    // Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©: Ø«Ø§Ø¨ØªØ© ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹ Ø­ÙˆÙ„ Ø§Ù„Ù…Ø§Ø±ÙƒØ±
    driverGlowInner.setRadius(baseRadiusM);

    // Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ©: ØªØ¨Ø¯Ø£ Ù…Ù† inner ÙˆØªÙ†ØªØ´Ø±
    const outerRadius = baseRadiusM + extraRadiusM * t;
    driverGlowOuter.setRadius(outerRadius);

    // Ø´ÙØ§ÙÙŠØ© Ø§Ù„Ø´Ø§Ø¯Ùˆ Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ ØªÙ‚Ù„ Ù…Ø¹ Ø§Ù„Ø§Ù†ØªØ´Ø§Ø±
    const outerFillOpacity = 0.32 - 0.25 * t;
    const outerStrokeOpacity = 0.45 - 0.35 * t;

    driverGlowOuter.setOptions({
      fillOpacity: Math.max(0, outerFillOpacity),
      strokeOpacity: Math.max(0, outerStrokeOpacity)
    });
  }, 50); // ÙƒÙ„ 50ms â†’ Ù†Ø¨Ø¶Ø© Ù†Ø§Ø¹Ù…Ø©
}

function stopDriverGlow() {
  if (driverGlowPulseInterval) {
    clearInterval(driverGlowPulseInterval);
    driverGlowPulseInterval = null;
  }
  if (driverGlowInner) {
    driverGlowInner.setMap(null);
    driverGlowInner = null;
  }
  if (driverGlowOuter) {
    driverGlowOuter.setMap(null);
    driverGlowOuter = null;
  }
}

// Ø¥Ù†Ø´Ø§Ø¡/ØªØ­Ø¯ÙŠØ« Ù…Ø§Ø±ÙƒØ± Ø§Ù„Ø³Ø§Ø¦Ù‚ + Ø¥Ø¨Ù‚Ø§Ø¦Ù‡ ÙÙŠ ÙˆØ³Ø· Ø§Ù„Ø®Ø±ÙŠØ·Ø©
function ensureDriverMarker(lat, lng, heading) {
  if (!driverMap || typeof google === "undefined" || !google.maps) return;

  const currentLatLng = new google.maps.LatLng(lat, lng);

  if (!driverMarker) {
    const icon = {
      path: google.maps.SymbolPath.FORWARD_CLOSED_ARROW,
      scale: 5,
      strokeColor: "#ffffff",
      strokeWeight: 2,
      fillColor: "#4285F4",
      fillOpacity: 1,
      rotation: typeof heading === "number" ? heading : 0
    };
    driverMarker = new google.maps.Marker({
      map: driverMap,
      position: currentLatLng,
      icon
    });
  } else {
    driverMarker.setPosition(currentLatLng);
    if (typeof heading === "number") {
      const icon = driverMarker.getIcon();
      if (icon && typeof icon === "object") {
        icon.rotation = heading;
        driverMarker.setIcon(icon);
      }
    }
  }

  // Ù†Ø®Ù„ÙŠ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù…ØªÙ…Ø±ÙƒØ²Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø§Ø¦Ù‚
  driverMap.setCenter(currentLatLng);

  // Ø§Ù„Ù‡Ø§Ù„Ø© Ø§Ù„Ù…ØªÙˆÙ‡Ø¬Ø©
  updateDriverGlow(currentLatLng);
}

/* Ø¨Ø¯Ø¡/Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ø­ÙŠ Ø¹Ù„Ù‰ Ù†ÙØ³ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù…Ø¹ ØªØ¯ÙˆÙŠØ± Ø­Ø³Ø¨ Ø§Ù„Ø§ØªØ¬Ø§Ù‡ */
function startGuidance(targetLat, targetLng) {
  if (isGuidanceOn) return;
  if (!navigator.geolocation) {
    alert(t("alert_live_nav_not_supported"));
    return;
  }
  if (!driverMap) {
    alert(t("alert_map_not_ready"));
    return;
  }

  // Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ø­ÙŠ Ù†Ø³ØªØ®Ø¯Ù… watch ÙˆØ§Ø­Ø¯ ÙÙ‚Ø· (Ø®Ø§Øµ Ø¨Ø§Ù„Ù…Ù„Ø§Ø­Ø©)
  // Ù„Ø°Ù„Ùƒ Ù†ÙˆÙ‚Ù ØªØªØ¨Ø¹ Ø§Ù„Ø®Ù„ÙÙŠØ© Ø¥Ù† ÙƒØ§Ù† ÙŠØ¹Ù…Ù„
  stopDriverLocationTracking();

  navigationTarget = { lat: targetLat, lng: targetLng };
  isGuidanceOn = true;
  if (driverNavBtn) {
    driverNavBtn.dataset.active = "true";
  }

  const watchOptions = {
    enableHighAccuracy: true,
    maximumAge: 3000,
    timeout: 20000
  };

  navigationWatchId = navigator.geolocation.watchPosition(
    (pos) => {
      const lat = pos.coords.latitude;
      const lng = pos.coords.longitude;
      const heading =
        typeof pos.coords.heading === "number" && !isNaN(pos.coords.heading)
          ? pos.coords.heading
          : null;

      if (!driverMap) return;

      const currentLatLng = new google.maps.LatLng(lat, lng);

      // âœ… ØªØ­Ø¯ÙŠØ« Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø³Ø§Ø¦Ù‚ ÙÙŠ Firestore Ø£ÙŠØ¶Ø§Ù‹ (Ù†ÙØ³ Ø§Ù„Ù€ Throttle Ø§Ù„Ø³Ø§Ø¨Ù‚)
      handleDriverLocationUpdate(lat, lng);

      // Ù…Ø§Ø±ÙƒØ± Ø§Ù„Ø³Ø§Ø¦Ù‚ + Ø§Ù„Ù‡Ø§Ù„Ø© + ØªÙ…Ø±ÙƒØ² Ø§Ù„Ø®Ø±ÙŠØ·Ø©
      ensureDriverMarker(lat, lng, heading);

      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: Ù…Ø³Ø­ Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø°ÙŠ ØªÙ… Ù‚Ø·Ø¹Ù‡
      updateRouteProgress(currentLatLng);

      // ğŸŸ¦ Ù‡Ø§Ù„Ø© Ø´Ø§Ø¯Ùˆ Ø£Ø²Ø±Ù‚ Ø­ÙˆÙ„ Ø§Ù„Ø³Ø§Ø¦Ù‚
      updateDriverGlow(currentLatLng);

      // ØªØ¯ÙˆÙŠØ± Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø­Ø³Ø¨ Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø³Ø§Ø¦Ù‚ (Ø¥Ù† ÙƒØ§Ù† Ù…ØªÙˆÙØ±Ø§Ù‹)
      if (heading !== null && typeof driverMap.setHeading === "function") {
        driverMap.setHeading(heading);
        if (typeof driverMap.setTilt === "function") {
          driverMap.setTilt(45);
        }
      }
    },

    (err) => {
      console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ø­ÙŠ:", err);
    },
    watchOptions
  );
}

function stopGuidance() {
  isGuidanceOn = false;
  navigationTarget = null;
  navigationMode = null; // âœ… Ù…Ø§ Ø¹Ø§Ø¯ ÙÙŠ Ù‡Ø¯Ù Ø­Ø§Ù„ÙŠ

  if (navigationWatchId !== null && navigator.geolocation) {
    navigator.geolocation.clearWatch(navigationWatchId);
    navigationWatchId = null;
  }

  // Ù†Ø±Ø¬Ø¹ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù„ÙˆØ¶Ø¹ Ø¹Ø§Ø¯ÙŠ Ø¨Ø¯ÙˆÙ† tilt Ø£Ùˆ heading
  if (driverMap && typeof driverMap.setHeading === "function") {
    driverMap.setHeading(0);
    if (typeof driverMap.setTilt === "function") {
      driverMap.setTilt(0);
    }
  }

  if (driverNavBtn) {
    driverNavBtn.dataset.active = "false";
  }

  // Ù„Ùˆ Ø§Ù„Ø³Ø§Ø¦Ù‚ Ø­Ø§Ù„ÙŠØ§Ù‹ Ø£ÙˆÙÙ„Ø§ÙŠÙ† ÙÙ‚Ø· ÙˆÙ‚ØªÙ‡Ø§ Ù†Ù…Ø³Ø­ Ø§Ù„Ù…Ø§Ø±ÙƒØ± ÙˆØ§Ù„Ù‡Ø§Ù„Ø©
  if (!driverCurrentOnline) {
    if (driverMarker) {
      driverMarker.setMap(null);
      driverMarker = null;
    }
    if (typeof stopDriverGlow === "function") {
      stopDriverGlow();
    }
  } else {
    // Ø§Ù„Ø³Ø§Ø¦Ù‚ Ù…Ø§ Ø²Ø§Ù„ Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† Ø¨Ø¹Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ù…Ù„Ø§Ø­Ø© â†’ Ø±Ø¬Ù‘Ø¹ ØªØªØ¨Ø¹ Ø§Ù„Ø®Ù„ÙÙŠØ©
    startDriverLocationTracking();
  }
}

/* ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø®Ø±ÙŠØ·Ø© (Ø§Ù„Ù…Ø³Ø§Ø± + Ø§Ù„ØªÙˆØ¬ÙŠÙ‡) */
function clearRouteAndNavigation() {
  // Ø£ÙˆÙ„Ø§Ù‹: Ù…Ø³Ø­ Ø®Ø· Ø§Ù„Ø·Ø±ÙŠÙ‚ ÙˆØ§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ
  clearOrderRoute();

  // Ø«Ø§Ù†ÙŠØ§Ù‹: Ø¥Ø²Ø§Ù„Ø© Ù…Ø§Ø±ÙƒØ± Ø§Ù„Ù…ØªØ¬Ø±
  if (merchantMarker) {
    merchantMarker.setMap(null);
    merchantMarker = null;
  }

  // Ø«Ø§Ù„Ø«Ø§Ù‹: ØªÙ†Ø¸ÙŠÙ Ø¹Ù†ÙˆØ§Ù†/Ù…Ø§Ø±ÙƒØ± Ø§Ù„Ø¹Ù…ÙŠÙ„
  clearCustomerDestination();

  // Ø±Ø§Ø¨Ø¹Ø§Ù‹: Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ø­ÙŠ (Ù…Ø§Ø±ÙƒØ± Ø§Ù„Ø³Ø§Ø¦Ù‚ + heading)
  stopGuidance();
}

/* Ù…Ø³Ø§ÙØ© Ø§Ù„Ù…Ø³Ø§Ø± Ø¹Ø¨Ø± Directions API (Ù„Ù„Ø­Ø§Ø³Ø¨Ø© ÙÙ‚Ø·) */
function getRouteDistanceKm(origin, destination) {
  return new Promise((resolve) => {
    if (!directionsService) {
      directionsService = new google.maps.DirectionsService();
    }
    directionsService.route(
      {
        origin: origin,
        destination: destination,
        travelMode: google.maps.TravelMode.DRIVING
      },
      (result, status) => {
        if (
          status === "OK" &&
          result.routes &&
          result.routes.length > 0 &&
          result.routes[0].legs &&
          result.routes[0].legs.length > 0 &&
          result.routes[0].legs[0].distance
        ) {
          resolve(result.routes[0].legs[0].distance.value / 1000);
        } else {
          console.error("ÙØ´Ù„ Ø­Ø³Ø§Ø¨ Ù…Ø³Ø§Ø± Google Maps", status, result);
          resolve(0);
        }
      }
    );
  });
}
async function handleMerchantCancelDistanceCharge(call, currentLat, currentLng) {
  if (!call || !call.id) return;

  // Ù„Ø§Ø²Ù… ØªÙƒÙˆÙ† Ø¹Ù†Ø¯Ù†Ø§ Ù†Ù‚Ø·Ø© Ø§Ù†Ø·Ù„Ø§Ù‚ Ù…Ø³Ø¬Ù‘Ù„Ø© (Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…Ø´ÙˆØ§Ø±)
  if (call.driverStartLat == null || call.driverStartLng == null) {
    // Ù…Ø§ ÙÙŠ Ù†Ù‚Ø·Ø© Ø§Ù†Ø·Ù„Ø§Ù‚ â†’ Ù…Ø§ Ù†Ù‚Ø¯Ø± Ù†Ø­Ø³Ø¨ Ø§Ù„ØªØ¹ÙˆÙŠØ¶
    return;
  }

  const startPoint = {
    lat: call.driverStartLat,
    lng: call.driverStartLng
  };

  // Ø§Ø­Ø³Ø¨ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¨Ø§Ù„ÙƒÙŠÙ„ÙˆÙ…ØªØ± Ø¨ÙŠÙ† Ù†Ù‚Ø·Ø© Ø§Ù„Ø§Ù†Ø·Ù„Ø§Ù‚ ÙˆÙ…ÙˆÙ‚Ø¹ Ø§Ù„Ø³Ø§Ø¦Ù‚ Ø§Ù„Ø­Ø§Ù„ÙŠ
  const distanceKm = await getRouteDistanceKm(
    startPoint,
    { lat: currentLat, lng: currentLng }
  );

  if (!distanceKm || distanceKm <= 0) return;

  // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ³Ø¹ÙŠØ±: Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„ØªØ³Ø¹ÙŠØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ù…Ø¹ Ø§Ù„Ù†Ø¯Ø§Ø¡ØŒ ÙˆØ¥Ù„Ø§ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø³Ø§Ø¦Ù‚ Ø§Ù„Ø­Ø§Ù„ÙŠØ©
  const driverPricing = call.pricing || currentDriverData || {};
  const includeToMerchantSegment = !!driverPricing.includeToMerchantSegment;
  const useSamePriceForBoth =
    driverPricing.useSamePriceForBoth !== false;
  const pricePerKmDelivery =
    typeof driverPricing.pricePerKmDelivery === "number"
      ? driverPricing.pricePerKmDelivery
      : 0;
  let pricePerKmToMerchant =
    typeof driverPricing.pricePerKmToMerchant === "number"
      ? driverPricing.pricePerKmToMerchant
      : null;

  if (includeToMerchantSegment && (pricePerKmToMerchant == null || useSamePriceForBoth)) {
    pricePerKmToMerchant = pricePerKmDelivery;
  }

  // ğŸ‘‰ ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ù„ØºØ§Ø¡ Ù…Ù† Ø§Ù„Ù…Ø·Ø¹Ù…: Ù†Ø¹ØªØ¨Ø± ÙƒÙ„ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¬Ø²Ø¡ "Ø¥Ù„Ù‰ Ø§Ù„ØªØ§Ø¬Ø±"
  let perKm = 0;
  if (includeToMerchantSegment) {
    perKm = pricePerKmToMerchant || pricePerKmDelivery || 0;
  } else {
    // Ø§Ù„Ø³Ø§Ø¦Ù‚ Ù„Ù… ÙŠÙØ¹Ù‘Ù„ Ø§Ø­ØªØ³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„ØªØ§Ø¬Ø± â†’ Ù„Ø§ ØªØ¹ÙˆÙŠØ¶ Ù…Ø³Ø§ÙØ©
    perKm = 0;
  }

  if (!perKm || perKm <= 0) {
    // Ù…Ø§ ÙÙŠ Ø³Ø¹Ø± ØµØ§Ù„Ø­ Ù„ÙƒÙ„ ÙƒÙ… â†’ Ù„Ø§ Ø´ÙŠØ¡ Ù†Ø­Ø³Ø¨Ù‡
    return;
  }

  const freeKm =
    typeof driverPricing.freeKm === "number"
      ? driverPricing.freeKm
      : 0;

  let rawDistanceFee = distanceKm * perKm;
  let freeKmUsed = 0;

  // Ù†ÙØ³ Ù…Ù†Ø·Ù‚ Ø§Ù„ÙƒÙŠÙ„ÙˆÙ…ØªØ±Ø§Øª Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©
  if (freeKm > 0 && distanceKm > 0 && rawDistanceFee > 0) {
    freeKmUsed = Math.min(freeKm, distanceKm);
    const avgPerKm = rawDistanceFee / distanceKm;
    const discount = freeKmUsed * avgPerKm;
    rawDistanceFee = Math.max(rawDistanceFee - discount, 0);
  }

  const distanceFee = rawDistanceFee;

  // âš ï¸ Ù‡Ù†Ø§ Ø§Ù„Ù†Ù‚Ø·Ø© Ø§Ù„Ù…Ù‡Ù…Ø©: Ù„Ø§ Ù†Ø¶ÙŠÙ Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ â†’ baseFee = 0
  const totalFee = distanceFee;

    const patch = {
    // status ÙŠØ¨Ù‚Ù‰ "cancelled" ÙƒÙ…Ø§ Ù‡Ùˆ

    // â¬…ï¸ Ù‡Ø°Ø§ Ù…Ø§ ØªÙ‚Ø±Ø£Ù‡ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø·Ø¹Ù… ÙÙŠ ØµÙ†Ø¯ÙˆÙ‚ ØªÙƒØ§Ù„ÙŠÙ Ø§Ù„ØªÙˆØµÙŠÙ„
    deliveryFee: totalFee,

    distance: {
      driverToMerchantKm: distanceKm,
      merchantToDropoffKm: 0,
      totalKm: distanceKm,
      freeKmUsed: freeKmUsed
    },
    cost: {
      baseFee: 0,                 // Ø§Ø³ØªØ«Ù†Ø§Ø¡ Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù…Ù† Ø§Ù„Ø­Ø³Ø¨Ø©
      distanceFee: distanceFee,
      totalFee: totalFee,
      perKmDriverToMerchant: perKm,
      perKmMerchantToDropoff: 0,
      freeKm: freeKm
    }
  };

  // Ù†Ø­Ø¯Ù‘Ø« Ø³Ø¬Ù„ Ø§Ù„Ø³Ø§Ø¦Ù‚ + Ø³Ø¬Ù„ Ø§Ù„Ù…Ø·Ø¹Ù… Ù…Ø¹Ù‹Ø§
  await updateDriverCallAndMerchant(call.id, patch);
}

/* Ù‡Ù„ Ù„Ø¯Ù‰ Ø§Ù„Ø³Ø§Ø¦Ù‚ Ø·Ù„Ø¨ Ù†Ø´Ø·ØŸ */
function driverHasActiveJob() {
  if (!lastDriverCalls || !lastDriverCalls.length) return false;
  return lastDriverCalls.some((o) => {
    const s = (o.status || "pending").toLowerCase();
    return !(s === "delivered" || s === "cancelled" || s === "rejected");
  });
}
// âœ… Ø¥Ø¹Ø§Ø¯Ø© Ø­Ø³Ø§Ø¨ busy ÙÙŠ ÙˆØ«ÙŠÙ‚Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚ Ø§Ø¹ØªÙ…Ø§Ø¯Ø§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø© ÙÙ‚Ø·
async function recomputeDriverBusyFlag() {
  if (!driverUid) return;

  try {
    const activeSnap = await db
      .collection("drivers")
      .doc(driverUid)
      .collection("calls")
      .where("status", "in", [
        "pending",
        "accepted",
        "in_progress",
        "heading_to_customer"
      ])
      .limit(1)
      .get();

    const hasActive = !activeSnap.empty;

    await db.collection("drivers").doc(driverUid).update({
      busy: hasActive
    });
  } catch (e) {
    console.warn("ØªØ¹Ø°Ø± Ø¥Ø¹Ø§Ø¯Ø© Ø­Ø³Ø§Ø¨ Ø­Ø§Ù„Ø© busy Ù„Ù„Ø³Ø§Ø¦Ù‚:", e);
  }
}

/* Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ù†Ø´Ø· Ø§Ù„Ø­Ø§Ù„ÙŠ (Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù„ØªÙˆØ¬ÙŠÙ‡) */
function getCurrentActiveCall() {
  if (!lastDriverCalls || !lastDriverCalls.length) return null;

  const active = lastDriverCalls.filter((o) => {
    const s = (o.status || "pending").toLowerCase();
    return !(
      s === "delivered" ||
      s === "cancelled" ||
      s === "rejected"
    );
  });
  if (!active.length) return null;

  // 1) Ù„Ùˆ ÙÙŠ Ø§Ø®ØªÙŠØ§Ø± ÙŠØ¯ÙˆÙŠØŒ ÙˆÙ…ÙˆØ¬ÙˆØ¯ Ø¶Ù…Ù† Ø§Ù„Ù†Ø´Ø·Ø© â†’ Ù†Ø¹ÙŠØ¯Ù‡
  if (driverSelectedActiveCallId) {
    const selected = active.find((c) => c.id === driverSelectedActiveCallId);
    if (selected) {
      return selected;
    }
  }

  // 2) Ø®Ù„Ø§Ù Ø°Ù„Ùƒ: Ù†Ø¹Ø·ÙŠ Ø£ÙˆÙ„ÙˆÙŠØ© Ù„Ù„Ù€ in_progress
  const inProgress = active.find(
    (c) => (c.status || "").toLowerCase() === "in_progress"
  );
  return inProgress || active[0];
}

// â¬‡ï¸ Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ø¥Ø¶Ø§ÙÙŠ extraOrder Ù…Ù† Ø§Ù„Ø³Ø§Ø¦Ù‚ (Ø¥Ø¯Ø®Ø§Ù„ ÙŠØ¯ÙˆÙŠ)
// Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¬Ø¯ÙŠØ¯: Ù†Ø­Ø§ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹ Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ù†Ø¯Ø§Ø¡ Ø­Ù‚ÙŠÙ‚ÙŠ Ù…ÙˆØ¬ÙˆØ¯ Ù„Ù„ØªØ§Ø¬Ø±
// (source="assistant" Ùˆ status="auto_pending") Ø¨Ø¯ÙˆÙ† Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø¯Ø§Ø¡ Ø¬Ø¯ÙŠØ¯ Ù„Ù„ØªØ§Ø¬Ø±.
// Ù„Ùˆ Ù„Ù… Ù†Ø¬Ø¯ Ø´ÙŠØ¦Ø§Ù‹ØŒ Ù†Ø±Ø¬Ø¹ Ù„Ù…Ù†Ø·Ù‚ Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø¯Ø§Ø¡ Ø¬Ø¯ÙŠØ¯ ÙƒÙ…Ø§ ÙÙŠ Ø§Ù„Ø³Ø§Ø¨Ù‚.
async function createDriverExtraCallFromManual(price, isCash) {
  if (!driverUid) {
    alert(t("alert_currentDriverNotSet"));
    return;
  }

  // 1) Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ù†Ø´Ø· Ø§Ù„Ø­Ø§Ù„ÙŠ ÙƒÙ€ base
  const baseCall = getCurrentActiveCall && getCurrentActiveCall();
  if (!baseCall) {
    alert(t("extraOrders_no_active_call"));
    return;
  }

  const merchantId = baseCall.merchantId;
  if (!merchantId) {
    alert(t("extraOrders_missing_merchant"));
    return;
  }

  const now = firebase.firestore.FieldValue.serverTimestamp();

  // 2) Ù†Ù‚Ø±Ø£ Ø§Ù„ØªØ³Ø¹ÙŠØ±Ø© Ù…Ù† Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ø£Ùˆ Ù…Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ø§Ø¦Ù‚
  const driverPricingSource = baseCall.pricing || currentDriverData || {};
  const pricingMode = driverPricingSource.pricingMode || "per_km";

  const pricing = {
    pricingMode: pricingMode,
    baseFee:
      pricingMode === "per_km"
        ? (typeof driverPricingSource.baseFee === "number"
            ? driverPricingSource.baseFee
            : (typeof BASE_DELIVERY_FEE === "number" ? BASE_DELIVERY_FEE : 0))
        : 0,
    pricePerKmDelivery:
      typeof driverPricingSource.pricePerKmDelivery === "number"
        ? driverPricingSource.pricePerKmDelivery
        : null,
    includeToMerchantSegment: !!driverPricingSource.includeToMerchantSegment,
    useSamePriceForBoth: driverPricingSource.useSamePriceForBoth !== false,
    pricePerKmToMerchant:
      typeof driverPricingSource.pricePerKmToMerchant === "number"
        ? driverPricingSource.pricePerKmToMerchant
        : null,
    freeKm:
      typeof driverPricingSource.freeKm === "number"
        ? driverPricingSource.freeKm
        : 0
  };

  // 3) Ø¥Ø¹Ø¯Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒØ§Ø´ Ù…Ù† Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø³Ø§Ø¦Ù‚
  const manualOrderPrice = price;
  const manualCollectCash = !!isCash;
  const manualPaymentType = manualCollectCash ? "cash" : "online";
  const manualCashAmount = manualCollectCash ? manualOrderPrice : null;

  // 4) Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥ÙŠØ¬Ø§Ø¯ Ù†Ø¯Ø§Ø¡ ÙÙŠ Ø·Ø§Ø¨ÙˆØ± Ø§Ù„ØªØ§Ø¬Ø± Ù„Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ:
  //    merchants/{merchantId}/calls Ø­ÙŠØ« status="auto_pending" Ùˆ source="assistant"
  let queueCall = null;

  try {
    const queueSnap = await db
  .collectionGroup("calls")
  .where("merchantId", "==", merchantId)
  .where("status", "==", "auto_pending")
  .where("source", "==", "assistant")
  .orderBy("createdAt", "asc")
  .limit(1)
  .get();

    queueSnap.forEach((doc) => {
      const data = doc.data() || {};
      if ((data.source || "") !== "assistant") return;

      // Ù†Ø®ØªØ§Ø± Ø£Ù‚Ø¯Ù… Ù†Ø¯Ø§Ø¡ (Ø­Ø³Ø¨ createdAt) Ø¥Ù† ÙˆÙØ¬Ø¯
      if (!queueCall) {
        queueCall = {
          id: doc.id,
          ref: doc.ref,
          data
        };
      } else {
        const prev = queueCall.data.createdAt && queueCall.data.createdAt.toDate
          ? queueCall.data.createdAt.toDate().getTime()
          : 0;
        const cur = data.createdAt && data.createdAt.toDate
          ? data.createdAt.toDate().getTime()
          : 0;
        if (cur && (!prev || cur < prev)) {
          queueCall = {
            id: doc.id,
            ref: doc.ref,
            data
          };
        }
      }
    });
  } catch (e) {
    console.warn("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù‚Ø±Ø§Ø¡Ø© Ù†Ø¯Ø§Ø¡Ø§Øª Ø·Ø§Ø¨ÙˆØ± Ø§Ù„ØªØ§Ø¬Ø±:", e);
  }

  // Ù…Ø±Ø§Ø¬Ø¹ ÙˆØ«Ø§Ø¦Ù‚ Ø§Ù„Ø³Ø§Ø¦Ù‚ ÙˆØ§Ù„ØªØ§Ø¬Ø±
  const driverCallRef = queueCall
    ? db
        .collection("drivers")
        .doc(driverUid)
        .collection("calls")
        .doc(queueCall.id) // ğŸ‘ˆ Ù†ÙØ³ Ø§Ù„Ù€ id Ù„Ùˆ Ø§Ø³ØªÙ‡Ù„ÙƒÙ†Ø§ Ù†Ø¯Ø§Ø¡ Ù…Ù† Ø§Ù„Ø·Ø§Ø¨ÙˆØ±
    : db
        .collection("drivers")
        .doc(driverUid)
        .collection("calls")
        .doc(); // ğŸ‘ˆ id Ø¬Ø¯ÙŠØ¯ Ù„Ùˆ Ù„Ù… ÙŠÙˆØ¬Ø¯ Ø·Ø§Ø¨ÙˆØ±

  const newCallId = driverCallRef.id;

  const merchantCallRef = queueCall
    ? queueCall.ref                      // ğŸ‘ˆ Ù†Ø¯Ø§Ø¡ Ù…ÙˆØ¬ÙˆØ¯ (Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ)
    : db
        .collection("merchants")
        .doc(merchantId)
        .collection("calls")
        .doc(newCallId);                 // ğŸ‘ˆ Ù†Ø¯Ø§Ø¡ Ø¬Ø¯ÙŠØ¯ Ù„Ù„ØªØ§Ø¬Ø± (fallback)

  const merchantCallPath = merchantCallRef.path;

  // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ø§Ø¦Ù‚
  const driverFirstName =
    baseCall.driverFirstName ||
    (currentDriverData && currentDriverData.firstName) ||
    "";
  const driverLastName =
    baseCall.driverLastName ||
    (currentDriverData && currentDriverData.lastName) ||
    "";
  const driverPhone =
    baseCall.driverPhone ||
    (currentDriverData && currentDriverData.phone) ||
    "";

  // 5) Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´ØªØ±ÙƒØ© (Ø³ÙˆØ§Ø¡ Ø§Ø³ØªÙ‡Ù„ÙƒÙ†Ø§ Ù†Ø¯Ø§Ø¡ Ø£Ùˆ Ø£Ù†Ø´Ø£Ù†Ø§ Ø¬Ø¯ÙŠØ¯Ø§Ù‹)
  function buildCommonData(existingMerchantData) {
    const src = existingMerchantData || {};

    // Ø§Ù„Ø£ÙØ¶Ù„ÙŠØ© Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© Ù…Ù† Ø§Ù„ØªØ§Ø¬Ø± (Ù„Ùˆ Ù…ÙˆØ¬ÙˆØ¯Ø©)ØŒ
    // ÙˆØ¥Ù„Ø§ Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„ØªÙŠ Ø£Ø¯Ø®Ù„Ù‡Ø§ Ø§Ù„Ø³Ø§Ø¦Ù‚.
    const effectiveOrderPrice =
  typeof src.orderPrice === "number" && src.orderPrice > 0
    ? src.orderPrice
    : manualOrderPrice;

// ğŸ‘‡ Ù‡Ø°Ù‡ Ø§Ù„Ø«Ù„Ø§Ø«Ø© Ù†Ø¹ØªÙ…Ø¯ ÙÙŠÙ‡Ø§ Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ø¹Ù„Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø³Ø§Ø¦Ù‚ Ù„Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ
const effectiveCollectCash = manualCollectCash;
const effectivePaymentType = manualPaymentType;
const effectiveCashAmount  = manualCashAmount;

    return {
      // Ø­Ù‚ÙˆÙ„ Ø§Ù„ÙƒØ§Ø´
      cashAmount: effectiveCashAmount,
      collectCash: effectiveCollectCash,
      paymentType: effectivePaymentType,

      // Ø§Ù„ØªÙˆÙ‚ÙŠØª
      createdAt: src.createdAt || now,
      respondedAt: src.respondedAt || now,

      // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙˆØ§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† (Ù†Ø³ØªÙÙŠØ¯ Ù…Ù† Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ Ù„Ùˆ Ù…ÙˆØ¬ÙˆØ¯)
      customerName: src.customerName || "",
      deliveryAddress: src.deliveryAddress || "",

      // Ø§Ù„ØªØ§Ø¬Ø±
      merchantCallPath: merchantCallPath,
      merchantCity: src.merchantCity || baseCall.merchantCity || "",
      merchantId: merchantId,
      merchantLat:
        typeof src.merchantLat === "number"
          ? src.merchantLat
          : (typeof baseCall.merchantLat === "number" ? baseCall.merchantLat : null),
      merchantLng:
        typeof src.merchantLng === "number"
          ? src.merchantLng
          : (typeof baseCall.merchantLng === "number" ? baseCall.merchantLng : null),
      merchantName: src.merchantName || baseCall.merchantName || "",

      // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ø§Ø¦Ù‚
      driverFirstName: driverFirstName,
      driverId: driverUid,
      driverLastName: driverLastName,
      driverPhone: driverPhone,
      driverStartLat: src.driverStartLat || null,
      driverStartLng: src.driverStartLng || null,

      // Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø·Ù„Ø¨
      orderPrice: effectiveOrderPrice,
      orderValue:
        typeof src.orderValue === "number" ? src.orderValue : null,

      // Ø§Ù„ØªØ³Ø¹ÙŠØ±Ø©
      pricing: src.pricing || pricing,

      // Ù…Ù„Ø§Ø­Ø¸Ø§Øª
      notes: src.notes || "",

      // Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨
      status: "accepted",
      startedAt: src.startedAt || null,

      // Ø£Ø¹Ù„Ø§Ù… extraOrder
      type: "extraOrder",
      source: src.source || "driver_extra",
      extraOrder: true,
      baseCallId: baseCall.id || null
    };
  }

  try {
    if (queueCall) {
      // =============================
      // 6) Ù‡Ù†Ø§Ùƒ Ù†Ø¯Ø§Ø¡ ÙÙŠ Ø§Ù„Ø·Ø§Ø¨ÙˆØ± â†’ Ø§Ø³ØªÙ‡Ù„Ø§ÙƒÙ‡
      // =============================
      await db.runTransaction(async (tx) => {
        const freshSnap = await tx.get(queueCall.ref);
        if (!freshSnap.exists) {
          throw new Error("queue_call_missing");
        }
        const freshData = freshSnap.data() || {};

        const freshStatus = (freshData.status || "").toLowerCase();
        const freshSource = freshData.source || "";

        // Ù„Ùˆ Ù„Ù… ÙŠØ¹Ø¯ Auto Pending Ø£Ùˆ ØªØºÙŠØ± Ø§Ù„Ù…ØµØ¯Ø±ØŒ Ù†Ø¹ØªØ¨Ø±Ù‡ Ù…Ø³ØªÙ‡Ù„Ùƒ Ù…Ù† Ù…ÙƒØ§Ù† Ø¢Ø®Ø±
        if (freshStatus !== "auto_pending" || freshSource !== "assistant") {
          throw new Error("queue_call_already_taken");
        }

        // Ù†Ø¨Ù†ÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´ØªØ±ÙƒØ© Ù…Ø¹ Ø§Ù„Ø£Ø®Ø° Ø¨Ø¹ÙŠÙ† Ø§Ù„Ø§Ø¹ØªØ¨Ø§Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ù†Ø¯Ø§Ø¡ Ø§Ù„ØªØ§Ø¬Ø±
        const commonData = buildCommonData(freshData);

        const driverCallData = {
          ...commonData
        };

        const merchantCallData = {
          ...freshData,
          ...commonData,
          // Ù†Ø¶Ù…Ù† Ø£Ù† Ø§Ù„Ù…ØµØ¯Ø± Ø§Ù„Ø¢Ù† ÙŠØ´ÙŠØ± Ø£Ù†Ù‡ Ø£ØµØ¨Ø­ Ù†Ø¯Ø§Ø¡ Ø¹Ø§Ø¯ÙŠ (Ø£Ùˆ Ù†ØªØ±ÙƒÙ‡ assistant Ø­Ø³Ø¨ Ù„ÙˆØ¬ÙŠÙƒÙƒ)
          source: "assistant",
          driverUid: driverUid
        };

        // ØªØ­Ø¯ÙŠØ« Ù†Ø¯Ø§Ø¡ Ø§Ù„ØªØ§Ø¬Ø± Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯
        tx.set(queueCall.ref, merchantCallData, { merge: true });

        // Ø¥Ù†Ø´Ø§Ø¡/ØªØ­Ø¯ÙŠØ« Ù†Ø¯Ø§Ø¡ Ø§Ù„Ø³Ø§Ø¦Ù‚ Ø¨Ù†ÙØ³ Ø§Ù„Ù€ id
        tx.set(driverCallRef, driverCallData, { merge: true });

        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚ Ø¥Ù„Ù‰ busy
        const driverRef = db.collection("drivers").doc(driverUid);
        tx.update(driverRef, { busy: true });
      });
    } else {
      // =============================
      // 7) Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Ø¯Ø§Ø¡ Auto Pending Ù„Ù„ØªØ§Ø¬Ø± â†’ Ù†Ø±Ø¬Ø¹ Ù„Ù…Ù†Ø·Ù‚ Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø¯Ø§Ø¡ Ø¬Ø¯ÙŠØ¯
      // =============================
      const commonData = buildCommonData({});

      const driverCallData = {
        ...commonData
      };

      const merchantCallData = {
        ...commonData,
        driverUid: driverUid
      };

      await db.runTransaction(async (tx) => {
        tx.set(driverCallRef, driverCallData);
        tx.set(merchantCallRef, merchantCallData, { merge: true });

        const driverRef = db.collection("drivers").doc(driverUid);
        tx.update(driverRef, { busy: true });
      });
    }

    // 8) ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒØ§Ø´ Ø§Ù„Ù…Ø­Ù„ÙŠ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙÙˆØ±Ø§Ù‹
    driverCallsCache.push({
      id: newCallId,
      ...(queueCall ? buildCommonData(queueCall.data) : buildCommonData({})),
      _ref: driverCallRef
    });

    if (typeof renderDriverOrders === "function") {
      renderDriverOrders(driverCallsCache);
    }

    // 9) Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙŠØ¯ÙˆÙŠ + ØªØµÙÙŠØ± Ø§Ù„Ø­Ù‚ÙˆÙ„
    if (typeof resetDriverExtraManualForm === "function") {
      resetDriverExtraManualForm();
    }
    if (driverExtraManualPanel) {
      driverExtraManualPanel.classList.add("hidden");
    }
  } catch (err) {
    console.error("Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡/Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ:", err);

    // Ù„Ùˆ ÙƒØ§Ù† Ø§Ù„Ø®Ø·Ø£ Ø¨Ø³Ø¨Ø¨ Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ù†Ø¯Ø§Ø¡ Ù…Ù† Ø¬Ù‡Ø© Ø£Ø®Ø±Ù‰ØŒ Ù„Ø§ Ù†Ù†Ø´Ø¦ Ù†Ø¯Ø§Ø¡ Ø¬Ø¯ÙŠØ¯ Ù„Ù„ØªØ§Ø¬Ø±.
    if (
      err &&
      (err.message === "queue_call_missing" ||
        err.message === "queue_call_already_taken")
    ) {
      alert(t("extraOrders_consume_failed") || "Auto queue call is already taken.");
    } else {
      alert(
        (t("extraOrders_create_failed") || "Failed to create extra order") +
          (err && err.message ? ": " + err.message : "")
      );
    }
  }
}

/* ========== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØªØ³Ø¹ÙŠØ± Ø§Ù„ØªÙˆØµÙŠÙ„ (Ø¯Ø§Ø®Ù„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©) ========== */
function updatePricingFormUi() {
  const pricingModeSelect = document.getElementById("pricingModeSelect");
  const perKmBox = document.getElementById("perKmSettingsBox");
  const includeCheckbox = document.getElementById("includeToMerchantSegment");
  const useSameCheckbox = document.getElementById("useSamePriceForBoth");
  const toMerchantRow = document.getElementById("toMerchantRow");
  const baseFeeHint = document.getElementById("pricingBaseFeeHint");

  // ğŸ‘‡ Ø³Ø·Ø± Ø§Ù„Ù„ÙŠÙ†Ùƒ: Ø´Ø±Ø­ ØªØ³Ø¹ÙŠØ±Ø© Taussil (Ø§Ù„Ø¯ÙŠÙ Ø§Ù„Ø°ÙŠ Ø£Ø¹Ø·ÙŠØªÙ†ÙŠ Ø¥ÙŠØ§Ù‡)
  const taussilInfoRow = document.querySelector(".pricing-info-link");

  const mode = pricingModeSelect ? pricingModeSelect.value : "per_km";

  // 1) Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø¨Ù„ÙˆÙƒ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙƒÙŠÙ„ÙˆÙ…ØªØ± (Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ)
  if (perKmBox) {
    perKmBox.style.display = mode === "per_km" ? "block" : "none";
  }

  // 2) Ø³Ø·Ø± "Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ø§Ù„Ø«Ø§Ø¨Øª Ù„ÙƒÙ„ Ø·Ù„Ø¨ ÙŠØªÙ… ØªØ³Ù„ÙŠÙ…Ù‡: 3.50 â‚¬"
  //    ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· Ù…Ø¹ "ØªØ³Ø¹ÙŠØ±Ø© Ø®Ø§ØµØ©" (per_km)
  if (baseFeeHint) {
    baseFeeHint.style.display = mode === "per_km" ? "block" : "none";
  }

  // 3) Ø³Ø·Ø± Ù„ÙŠÙ†Ùƒ "Ø´Ø±Ø­ ØªØ³Ø¹ÙŠØ±Ø© Taussil" ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· Ù…Ø¹ "ØªØ³Ø¹ÙŠØ±Ø© Taussil" (independent_tiered)
  if (taussilInfoRow) {
    taussilInfoRow.style.display =
      mode === "independent_tiered" ? "block" : "none";
  }

  // 4) Ù…Ù†Ø·Ù‚ ØµÙ "Ø³Ø¹Ø± Ù…Ù† Ù…ÙˆÙ‚Ø¹ÙŠ Ø¥Ù„Ù‰ Ø§Ù„ØªØ§Ø¬Ø±"
  if (!includeCheckbox || !useSameCheckbox || !toMerchantRow) return;

  // ÙÙŠ ØªØ³Ø¹ÙŠØ±Ø© Taussil Ù„Ø§ Ù†Ø³ØªØ®Ø¯Ù… Ù‡Ø°Ø§ Ø§Ù„ØµÙ Ø¥Ø·Ù„Ø§Ù‚Ø§Ù‹
  if (mode !== "per_km") {
    toMerchantRow.style.display = "none";
    return;
  }

  // ÙÙŠ "ØªØ³Ø¹ÙŠØ±Ø© Ø®Ø§ØµØ©" ÙŠØ¨Ù‚Ù‰ Ø§Ù„Ù…Ù†Ø·Ù‚ ÙƒÙ…Ø§ ÙƒØ§Ù†
  if (!includeCheckbox.checked) {
    useSameCheckbox.disabled = true;
    toMerchantRow.style.display = "none";
  } else {
    useSameCheckbox.disabled = false;
    toMerchantRow.style.display =
      useSameCheckbox.checked ? "none" : "block";
  }
}

function populatePricingFormFromData() {
  const d = currentDriverData || {};
  const deliveryInput = document.getElementById("pricePerKmDelivery");
  const includeCheckbox = document.getElementById("includeToMerchantSegment");
  const useSameCheckbox = document.getElementById("useSamePriceForBoth");
  const toMerchantInput = document.getElementById("pricePerKmToMerchant");
  const freeKmInput = document.getElementById("freeKmInput");
  const baseFeeHint = document.getElementById("pricingBaseFeeHint");
  const pricingModeSelect = document.getElementById("pricingModeSelect");

  // âœ… Ø¶Ø¨Ø· Ù†ÙˆØ¹ Ø§Ù„ØªØ³Ø¹ÙŠØ± (Ø§ÙØªØ±Ø§Ø¶ÙŠ per_km)
  const mode = d.pricingMode || "per_km";
  if (pricingModeSelect) {
    pricingModeSelect.value = mode;
  }

  if (!deliveryInput || !includeCheckbox || !useSameCheckbox || !toMerchantInput || !freeKmInput) {
    return;
  }

  deliveryInput.value =
    d.pricePerKmDelivery != null ? d.pricePerKmDelivery : "";
  includeCheckbox.checked = !!d.includeToMerchantSegment;
  useSameCheckbox.checked = d.useSamePriceForBoth !== false;
  toMerchantInput.value =
    d.pricePerKmToMerchant != null ? d.pricePerKmToMerchant : "";
  freeKmInput.value = d.freeKm != null ? d.freeKm : 0;

  if (baseFeeHint) {
    const template = t("pricing_base_fee_hint");
    const feeText = BASE_DELIVERY_FEE.toFixed(2);
    baseFeeHint.textContent = template.replace("{fee}", feeText);
  }

  updatePricingFormUi();
}

async function savePricingSettings() {
// ğŸ”’ Ù…Ù†Ø¹ Ø§Ù„Ø³Ø§Ø¦Ù‚ Ø§Ù„Ù…Ø³ØªÙ‚Ù„ Ù…Ù† ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØªØ³Ø¹ÙŠØ±Ø© Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø´ØºÙˆÙ„Ø§Ù‹ Ø£Ùˆ Ù„Ø¯ÙŠÙ‡ Ø·Ù„Ø¨ Ù†Ø´Ø·
  const isIndependentDriver =
    currentDriverData && currentDriverData.driverType !== "employee";
  const isBusy = !!(currentDriverData && currentDriverData.busy);
  const hasActiveJob =
    typeof driverHasActiveJob === "function" && driverHasActiveJob();

  if (isIndependentDriver && (isBusy || hasActiveJob)) {
    alert(t("driver_pricing_locked_while_busy"));
    return;
  }
  const pricingModeSelect = document.getElementById("pricingModeSelect");
  const deliveryInput = document.getElementById("pricePerKmDelivery");
  const includeCheckbox = document.getElementById("includeToMerchantSegment");
  const useSameCheckbox = document.getElementById("useSamePriceForBoth");
  const toMerchantInput = document.getElementById("pricePerKmToMerchant");
  const freeKmInput = document.getElementById("freeKmInput");

  const mode = pricingModeSelect ? pricingModeSelect.value || "per_km" : "per_km";

  let updateData = {
    pricingMode: mode
  };

  if (mode === "independent_tiered") {
    // âœ… Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¬Ø¯ÙŠØ¯: Ù„Ø§ Ù†Ø­ØªØ§Ø¬ Ø£Ø³Ø¹Ø§Ø± Ø§Ù„ÙƒÙŠÙ„ÙˆÙ…ØªØ±
    updateData = {
      pricingMode: "independent_tiered",
      pricePerKmDelivery: null,
      includeToMerchantSegment: false,
      useSamePriceForBoth: true,
      pricePerKmToMerchant: null,
      freeKm: 0
    };
  } else {
    // ğŸ” Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù‚Ø¯ÙŠÙ… per_km ÙƒÙ…Ø§ ÙƒØ§Ù†
    let deliveryPrice = parseFloat(
      (deliveryInput.value || "").replace(",", ".")
    );
    if (isNaN(deliveryPrice) || deliveryPrice <= 0) {
      alert(t("pricing_error_delivery_price"));
      return;
    }

    const includeToMerchant = includeCheckbox.checked;
    const useSameForBoth = includeToMerchant
      ? useSameCheckbox.checked
      : false;

    let toMerchantPrice = null;
    if (includeToMerchant) {
      if (useSameForBoth) {
        toMerchantPrice = deliveryPrice;
      } else {
        let raw = parseFloat(
          (toMerchantInput.value || "").replace(",", ".")
        );
        if (isNaN(raw) || raw < 0) {
          alert(t("pricing_error_to_merchant_price"));
          return;
        }
        toMerchantPrice = raw;
      }
    }

    let freeKm = parseFloat(
      (freeKmInput.value || "").replace(",", ".")
    );
    if (isNaN(freeKm) || freeKm < 0) freeKm = 0;

    updateData = {
      pricingMode: "per_km",
      pricePerKmDelivery: deliveryPrice,
      includeToMerchantSegment: includeToMerchant,
      useSamePriceForBoth: useSameForBoth,
      pricePerKmToMerchant: includeToMerchant ? toMerchantPrice : null,
      freeKm: freeKm
    };
  }

  try {
    await db.collection("drivers").doc(driverUid).update(updateData);
    currentDriverData = currentDriverData || {};
    Object.assign(currentDriverData, updateData);
    alert(t("pricing_saved_success"));

    populatePricingFormFromData();
  } catch (err) {
    alert("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ³Ø¹ÙŠØ±: " + err.message);
  }
}



const savePricingBtn = document.getElementById("savePricingBtn");
if (savePricingBtn) {
  savePricingBtn.addEventListener("click", (e) => {
    e.preventDefault();          // ÙŠÙ…Ù†Ø¹ Ø£ÙŠ submit/reload
    savePricingSettings();       // Ù‡Ù†Ø§ ÙŠØªÙ… Ø§Ù„Ø­ÙØ¸ ÙØ¹Ù„ÙŠØ§Ù‹
  });
}

const includeCheckboxElm = document.getElementById("includeToMerchantSegment");
const useSameCheckboxElm = document.getElementById("useSamePriceForBoth");
const pricingModeSelect = document.getElementById("pricingModeSelect");
if (pricingModeSelect) {
  pricingModeSelect.addEventListener("change", updatePricingFormUi);
}

if (includeCheckboxElm && useSameCheckboxElm) {
  includeCheckboxElm.addEventListener("change", updatePricingFormUi);
  useSameCheckboxElm.addEventListener("change", updatePricingFormUi);
}
function showOrderCancelledByMerchantModal(call) {
  const title = t("orderCancelledByMerchant_title");
  const message = t("orderCancelledByMerchant_message");

  // 1) ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„Ø¥Ù„ØºØ§Ø¡ Ø¹Ù†Ø¯ Ø¸Ù‡ÙˆØ± Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
  if (orderCancelledSoundEl) {
    try {
      orderCancelledSoundEl.currentTime = 0;
      orderCancelledSoundEl.play();
    } catch (e) {
      console.warn("ØªØ¹Ø°Ø± ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨:", e);
    }
  }

  modalContent.innerHTML = `
    <div><strong>${escapeHtml(title)}</strong></div>
    <div class="small" style="margin-top:8px;">
      ${escapeHtml(message)}
    </div>
    <div class="btn-row" style="margin-top:14px;">
      <button id="orderCancelledConfirmBtn">
        ${t("orderCancelledByMerchant_confirmBtn")}
      </button>
    </div>
  `;

  if (orderModalEl) orderModalEl.classList.remove("hidden");
  modalBackdrop.style.display = "flex";
  window.scrollTo(0, 0);

  const btn = document.getElementById("orderCancelledConfirmBtn");
  if (btn) {
    btn.onclick = () => {
      // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªØ¬Ù…ÙŠØ¹ ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø­Ø§Ù„Ø© Ø¨Ø¹Ø¯ ÙƒÙ„ Ø´ÙŠØ¡
      const finishCleanup = async () => {
  if (driverUid) {
    try {
      await recomputeDriverBusyFlag();
    } catch (e) {
      console.warn("ØªØ¹Ø°Ø± Ø¥Ø¹Ø§Ø¯Ø© Ø­Ø³Ø§Ø¨ Ø­Ø§Ù„Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚ Ø¨Ø¹Ø¯ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ§Ø¬Ø±:", e);
    }
  }

  try {
    clearRouteAndNavigation();
  } catch (e) {}

  try {
    // Ø¥Ø¹Ø§Ø¯Ø© Ø±Ø³Ù… Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© (Ø¥Ø®ÙØ§Ø¡ ÙƒØ±Øª Ø§Ù„Ø·Ù„Ø¨ + Ø¥Ø±Ø¬Ø§Ø¹ ÙƒØ¨Ø³ÙˆÙ„Ø© Ø§Ù„Ø­Ø§Ù„Ø©)
    renderDriverOrders(lastDriverCalls || []);
  } catch (e) {}

  closeOrderModal();
};


      if (!navigator.geolocation) {
        // Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ â†’ Ù†Ù†Ø¸Ù ÙÙ‚Ø·
        alert(t("alert_geo_not_supported"));
        finishCleanup();
        return;
      }

      const geoOptions = {
        enableHighAccuracy: true,
        timeout: 20000,
        maximumAge: 5000
      };

      navigator.geolocation.getCurrentPosition(
        async (position) => {
          const currentLat = position.coords.latitude;
          const currentLng = position.coords.longitude;

          try {
            // ØªØ­Ø¯ÙŠØª Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø³Ø§Ø¦Ù‚ ÙÙŠ Firestore (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
            handleDriverLocationUpdate(currentLat, currentLng);

            // ğŸ’° Ø­Ø³Ø§Ø¨ Ù…Ø³Ø§ÙØ© Ø§Ù„ØªØ¹ÙˆÙŠØ¶ ÙˆØªÙƒÙ„ÙØªÙ‡Ø§ (Ø¨Ø¯ÙˆÙ† Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ)
            await handleMerchantCancelDistanceCharge(
              call,
              currentLat,
              currentLng
            );
          } catch (e) {
            console.error("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø³Ø§Ø¨ ØªØ¹ÙˆÙŠØ¶ Ø§Ù„Ø¥Ù„ØºØ§Ø¡ Ù…Ù† Ø§Ù„Ù…Ø·Ø¹Ù…:", e);
          }

          await finishCleanup();
        },
        async (err) => {
          console.warn("ØªØ¹Ø°Ø± Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø³Ø§Ø¦Ù‚ Ø¹Ù†Ø¯ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ§Ø¬Ø±:", err);
          alert(t("alert_geo_failed_prefix") + err.message);
          await finishCleanup();
        },
        geoOptions
      );
    };
  }
}
function showTaussilPricingInfoModal() {
  if (!modalContent || !modalBackdrop) return;

  function nl2brEsc(str) {
    return escapeHtml(str || "").replace(/\n/g, "<br>");
  }

  const title = t("pricing_taussil_info_title");
  const intro = t("pricing_taussil_info_intro");
  const ex1 = t("pricing_taussil_info_example1");
  const ex2 = t("pricing_taussil_info_example2");
  const note = t("pricing_taussil_info_note");

  modalContent.innerHTML = `
    <div><strong>${escapeHtml(title)}</strong></div>
    <div class="small" style="margin-top:8px;">
      ${nl2brEsc(intro)}
    </div>
    <div class="small" style="margin-top:10px;">
      ${nl2brEsc(ex1)}
    </div>
    <div class="small" style="margin-top:10px;">
      ${nl2brEsc(ex2)}
    </div>
    <div class="small" style="margin-top:10px;">
      ${nl2brEsc(note)}
    </div>
    <div class="btn-row" style="margin-top:14px;">
      <button class="secondary" onclick="closeOrderModal()">
        ${t("orderDetails_closeBtn")}
      </button>
    </div>
  `;

  if (orderModalEl) orderModalEl.classList.remove("hidden");
  modalBackdrop.style.display = "flex";
  window.scrollTo(0, 0);
}

/* ========== Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø§Ø¦Ù‚ Ù…Ù† drivers/{driverId}/calls ========== */
function listenDriverOrders(driverId) {
  if (driverOrdersListener) driverOrdersListener();

  driverOrdersListener = db
    .collection("drivers")
    .doc(driverId)
    .collection("calls")
    .onSnapshot((snapshot) => {
      const previousCalls = driverCallsCache || [];
      const allCalls = [];

      snapshot.forEach((doc) => {
        allCalls.push({ id: doc.id, ...doc.data(), _ref: doc.ref });
      });

      // Ø¨Ø¹Ø¯ Ø£ÙˆÙ„ Snapshot ÙÙ‚Ø· Ù†Ø¨Ø¯Ø£ Ù†Ø±Ø§Ù‚Ø¨ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
      if (driverOrdersInitialLoaded) {
        allCalls.forEach((call) => {
          const prev = previousCalls.find((p) => p.id === call.id);

          const nowStatus = (call.status || "").toLowerCase();
          const wasStatus = prev ? (prev.status || "").toLowerCase() : null;

          const nowCancelled = nowStatus === "cancelled";
          const wasCancelled = wasStatus === "cancelled";

          if (nowCancelled && !wasCancelled) {
            // Ù„Ùˆ Ø£Ù„ØºØ§Ù‡ Ø§Ù„Ø³Ø§Ø¦Ù‚ Ù†ÙØ³Ù‡ = Ù„Ø§ Ù†Ø¸Ù‡Ø± Ù…Ù†Ø¨Ø«Ù‚ Ø§Ù„ØªØ§Ø¬Ø±
            const cancelledBy = (call.cancelledBy || "").toLowerCase();
            const isDriverCancel = cancelledBy === "driver";

            // Ø£ÙŠ Ø¥Ù„ØºØ§Ø¡ Ù„ÙŠØ³ Ù…Ù† Ø§Ù„Ø³Ø§Ø¦Ù‚ Ù†Ø¹ØªØ¨Ø±Ù‡ Ù…Ù† Ø§Ù„ØªØ§Ø¬Ø± (Ø£Ùˆ Ù…Ù† Ø§Ù„Ø³ÙŠØ³ØªÙ…)
            if (!isDriverCancel) {
              // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…Ø³Ø§Ø± ÙˆØ§Ù„ØªÙˆØ¬ÙŠÙ‡ Ù…Ù† Ø§Ù„Ø®Ø±ÙŠØ·Ø©
              clearRouteAndNavigation();
              // Ù…Ù†Ø¨Ø«Ù‚ "ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„ØªØ§Ø¬Ø±"
              showOrderCancelledByMerchantModal(call);
            }
          }
        });
      }

      driverCallsCache = allCalls;
      driverOrdersInitialLoaded = true;

      renderDriverOrders(allCalls);
    });
}

/* Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù†Ø¯Ø§Ø¡Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© (pending) Ù…Ù† Ø§Ù„ØªØ¬Ø§Ø± (collectionGroup) */
function listenDriverCalls(driverId) {
  if (driverCallsListener) driverCallsListener();
  driverCallsListener = db
    .collectionGroup("calls")
    .where("driverId", "==", driverId)
    .where("status", "==", "pending")
    .onSnapshot((snapshot) => {
      snapshot.docChanges().forEach((change) => {
        if (change.type === "added") {
          const data = change.doc.data();
          const call = {
            id: change.doc.id,
            ref: change.doc.ref,
            ...data
          };

          // ğŸ”” Ø¨Ø¯Ø¡ ØªÙƒØ±Ø§Ø± ØµÙˆØª Ø§Ù„Ù†Ø¯Ø§Ø¡ ÙƒÙ„ 5 Ø«ÙˆØ§Ù†Ù Ù„Ù‡Ø°Ø§ Ø§Ù„Ù†Ø¯Ø§Ø¡
          startNewCallSoundLoop(call.id);

          // ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ù†Ø¯Ø§Ø¡ Ù„Ù„Ø³Ø§Ø¦Ù‚
          showCallModalForDriver(call);
        } else if (change.type === "removed") {
          // Ù„Ùˆ Ø®Ø±Ø¬ Ø§Ù„Ù†Ø¯Ø§Ø¡ Ù…Ù† Ø­Ø§Ù„Ø© pending (Ù…Ø«Ù„Ø§Ù‹ ØªÙ… Ù‚Ø¨ÙˆÙ„Ù‡/Ø±ÙØ¶Ù‡ ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨)
          const removedId = change.doc.id;
          stopNewCallSoundLoop(removedId);
		  closeOrderModal();
        }
      });
    });
}

/* ========== helper: ØªØ­Ø¯ÙŠØ« Ù†Ø¯Ø§Ø¡ Ø§Ù„Ø³Ø§Ø¦Ù‚ + Ù†Ø¯Ø§Ø¡ Ø§Ù„ØªØ§Ø¬Ø± Ù…Ø¹Ø§Ù‹ ========== */
async function updateDriverCallAndMerchant(callId, dataPatch) {
  if (!driverUid) return;
  try {
    const driverCallRef = db
      .collection("drivers")
      .doc(driverUid)
      .collection("calls")
      .doc(callId);

    const snap = await driverCallRef.get();
    if (!snap.exists) {
      console.warn("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø¯Ø§Ø¡ ÙÙŠ Ø³Ø¬Ù„ Ø§Ù„Ø³Ø§Ø¦Ù‚:", callId);
      return;
    }

    const callData = snap.data();
    const merchantCallPath = callData.merchantCallPath;

    await driverCallRef.update(dataPatch);

    if (merchantCallPath) {
      await db.doc(merchantCallPath).update(dataPatch);
    }
  } catch (err) {
    alert(t("alert_call_update_failed") + err.message);

  }
}

/* ========== ÙƒØ±Øª Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ù†Ø´Ø· ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (Bottom Sheet) ========== */
function renderDriverCurrentOrder(call) {
  if (!driverCurrentOrderEl) return;

  const isEmployee =
    currentDriverData && currentDriverData.driverType === "employee";

  // Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨ Ù†Ø´Ø· â†’ Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ÙƒØ±Øª
  if (!call) {
    driverCurrentOrderEl.classList.add("hidden");
    driverCurrentOrderEl.innerHTML = "";
    driverCurrentOrderEl.classList.remove("collapsed");
    driverCurrentOrderEl.classList.remove("cash-current-order");
    currentOrderCollapsed = false;
    return;
  }

  const statusLabel = escapeHtml(getStatusLabel(call.status));
  const isCash = isCashOrder(call);

  let feeValue = "â€”";
  if (call.cost && typeof call.cost.totalFee === "number") {
    feeValue = call.cost.totalFee.toFixed(2) + " â‚¬";
  } else if (call.deliveryFee != null) {
    feeValue = String(call.deliveryFee);
  }

  const feeHtml = isCash
    ? `<span class="cash-amount-highlight">${escapeHtml(feeValue)}</span>`
    : escapeHtml(feeValue);
// âœ… Ø¬Ø¯ÙŠØ¯: Ù‚Ø±Ø§Ø¡Ø© orderPrice ÙˆØªØ¬Ù‡ÙŠØ²Ù‡ Ù„Ù„Ø¹Ø±Ø¶
  const orderPrice =
    typeof call.orderPrice === "number" ? call.orderPrice : null; // âœ… Ø¬Ø¯ÙŠØ¯
  const orderPriceStr =
    orderPrice != null ? orderPrice.toFixed(2) + " â‚¬" : "";        // âœ… Ø¬Ø¯ÙŠØ¯

  let buttonsHtml = "";
  const statusCode = (call.status || "accepted").toLowerCase();

  if (
    statusCode === "accepted" ||
    statusCode === "in_progress" ||
    statusCode === "heading_to_customer"
  ) {
    // âœ… Ø¬Ø¯ÙŠØ¯: Ø²Ø± ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø¹Ø± + Ø²Ø± ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…
    buttonsHtml = `
      <button onclick="driverEditOrderPrice('${call.id}')">
        ${t("currentOrder_btn_editPrice")}
      </button>
      <button onclick="driverCompleteCall('${call.id}')">
        ${t("currentOrder_btn_delivered")}
      </button>
    `;
  }

  // âœ… Ø¬Ø¯ÙŠØ¯: Ø³Ø·Ø± Ù‚ÙŠÙ…Ø© orderPrice
  const orderPriceLineHtml = orderPriceStr
    ? `<div class="small">
         ${t("currentOrder_orderPrice")}: ${escapeHtml(orderPriceStr)}
       </div>`
    : "";

  // Ø³Ø·Ø± Ø§Ù„ØªÙƒÙ„ÙØ© ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· Ù„ØºÙŠØ± Ø§Ù„Ù…ÙˆØ¸Ù
  const costLineHtml = !isEmployee
    ? `<div class="small">
         ${t("currentOrder_expectedCost")}: ${feeHtml}
       </div>`
    : "";

  driverCurrentOrderEl.innerHTML = `
    <div class="driver-current-order-header">
      <div class="driver-current-order-header-text">
        <div><strong>#${call.id}</strong> â€” ${escapeHtml(call.merchantName || "")}</div>
        <span class="small">${statusLabel}</span>
      </div>
      <button type="button"
              class="driver-current-order-toggle"
              onclick="window.toggleCurrentOrderPanel && window.toggleCurrentOrderPanel()">
        â–¼
      </button>
    </div>
    <div class="driver-current-order-body">
      <div class="small">
        ${escapeHtml(call.deliveryAddress || "-")}
      </div>
	  ${orderPriceLineHtml} <!-- âœ… Ø¬Ø¯ÙŠØ¯: Ø³Ø·Ø± Ù‚ÙŠÙ…Ø© Ø§Ù„Ø·Ù„Ø¨ -->
      ${costLineHtml}
      <div class="btn-row">
        ${buttonsHtml}
      </div>
    </div>
  `;

  driverCurrentOrderEl.classList.toggle("cash-current-order", isCash);

  driverCurrentOrderEl.classList.remove("hidden");
  driverCurrentOrderEl.classList.add("collapsed");
  currentOrderCollapsed = true;

  const toggleBtn = driverCurrentOrderEl.querySelector(".driver-current-order-toggle");
  if (toggleBtn) {
    toggleBtn.textContent = "â–²";
  }
}

function toggleCurrentOrderPanel(forceCollapse) {
  if (!driverCurrentOrderEl || driverCurrentOrderEl.classList.contains("hidden")) return;

  if (typeof forceCollapse === "boolean") {
    currentOrderCollapsed = forceCollapse;
  } else {
    currentOrderCollapsed = !currentOrderCollapsed;
  }

  if (currentOrderCollapsed) {
    driverCurrentOrderEl.classList.add("collapsed");
  } else {
    driverCurrentOrderEl.classList.remove("collapsed");
  }

  const toggleBtn = driverCurrentOrderEl.querySelector(".driver-current-order-toggle");
  if (toggleBtn) {
    // Ù„Ù…Ø§ ÙŠÙƒÙˆÙ† Ø§Ù„ÙƒØ±Øª Ù…Ø·ÙˆÙŠ Ù†Ø¹Ø±Ø¶ Ø³Ù‡Ù… Ù„Ø£Ø¹Ù„Ù‰ Ù„ÙØªØ­Ù‡
    toggleBtn.textContent = currentOrderCollapsed ? "â–²" : "â–¼";
  }
}

// Ù†Ø¶Ù…Ù† ÙˆØ¬ÙˆØ¯Ù‡Ø§ Ø£ÙŠØ¶Ø§Ù‹ Ø¹Ù„Ù‰ window Ù„Ùˆ Ø§Ø­ØªØ¬Øª
window.toggleCurrentOrderPanel = toggleCurrentOrderPanel;
function updateCashFloatingBadge(call) {
  if (!cashFloatingBadgeEl) return;

  // Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨ Ù†Ø´Ø· Ø£Ùˆ Ø§Ù„Ø·Ù„Ø¨ Ù„ÙŠØ³ ÙƒØ§Ø´ â†’ Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø´Ø§Ø±Ø©
  if (!call || !isCashOrder(call)) {
    cashFloatingBadgeEl.classList.add("hidden");
    cashFloatingBadgeEl.textContent = "";
    return;
  }

  // Ø­Ø³Ø§Ø¨ Ù…Ø¨Ù„Øº Ø§Ù„ÙƒØ§Ø´
  let amount = null;

  if (typeof call.cashAmount === "number") {
    amount = call.cashAmount;
  } else if (typeof call.orderPrice === "number") {
    amount = call.orderPrice;
  }

  if (amount == null || isNaN(amount) || amount <= 0) {
    cashFloatingBadgeEl.classList.add("hidden");
    cashFloatingBadgeEl.textContent = "";
    return;
  }

  const formatted = amount.toFixed(2) + " â‚¬";

  cashFloatingBadgeEl.innerHTML = `
    <span class="cash-floating-badge-inner">${escapeHtml(formatted)}</span>
  `;
  cashFloatingBadgeEl.classList.remove("hidden");
}

/* ========== Ø¹Ø±Ø¶ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø§Ø¦Ù‚ (Ù…Ù† calls) + Ø§Ù„Ø¥Ø­ØµØ§Ø¡Ø§Øª ========== */
function renderDriverOrders(allCalls) {
  lastDriverCalls = allCalls || [];

  const active = lastDriverCalls.filter((c) => {
    const s = (c.status || "pending").toLowerCase();
    return !(
      s === "delivered" ||
      s === "cancelled" ||
      s === "rejected"
    );
  });
  // Ø²Ø± Ù…Ø¨Ø¯Ù‘Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø© + Ø§Ù„Ø´Ø§Ø±Ø©
  if (driverActiveSwitcherBtn) {
    if (active.length > 0) {
      driverActiveSwitcherBtn.classList.remove("hidden");
      if (driverActiveSwitcherBadge) {
        driverActiveSwitcherBadge.textContent = String(active.length);
      }
    } else {
      driverActiveSwitcherBtn.classList.add("hidden");
      if (driverActiveSwitcherBadge) {
        driverActiveSwitcherBadge.textContent = "";
      }
      // Ù„Ùˆ Ù…Ø§ Ø¹Ø§Ø¯ Ø¹Ù†Ø¯Ù†Ø§ Ø·Ù„Ø¨Ø§Øª Ù†Ø´Ø·Ø©ØŒ Ù†Ù„ØºÙŠ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙŠØ¯ÙˆÙŠ
      driverSelectedActiveCallId = null;
    }
  }
  // ØªØ£Ù…ÙŠÙ†: Ù„Ùˆ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ù…Ø­Ø¯Ù‘Ø¯ Ù„Ù… ÙŠØ¹Ø¯ Ø¶Ù…Ù† Ø§Ù„Ù†Ø´Ø·Ø©ØŒ Ù†Ø¹ÙŠØ¯ Ø¶Ø¨Ø· Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
  const activeIds = active.map((c) => c.id);
  if (driverSelectedActiveCallId && !activeIds.includes(driverSelectedActiveCallId)) {
    driverSelectedActiveCallId = null;
  }

  const completed = lastDriverCalls.filter((c) => {
    const s = (c.status || "pending").toLowerCase();
    return (
      s === "delivered" ||
      s === "cancelled" ||
      s === "rejected"
    );
  });

  const isEmployee =
    currentDriverData && currentDriverData.driverType === "employee";

  // 1) Ø§Ù„Ø¥Ø­ØµØ§Ø¡Ø§Øª Ø§Ù„Ø¹Ù„ÙˆÙŠØ© (Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙˆØ§Ù„Ø³Ø§Ø¨Ù‚Ø©)
  // Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒØ§Ø´ ÙÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
const activeCashTotal = active.reduce((sum, c) => {
  return sum + getCashAmountNumeric(c);
}, 0);

if (driverActiveCountEl) {
  // Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒØ§Ø´ Ù„ÙƒÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙƒØ§Ø´ (Ù†Ø´Ø·Ø© + Ø³Ø§Ø¨Ù‚Ø©)
  const totalCashAll = lastDriverCalls.reduce((sum, c) => {
    return sum + getCashAmountNumeric(c);
  }, 0);

  driverActiveCountEl.innerHTML =
    t("summary_active_orders") +
    "<br><strong>" +
    totalCashAll.toFixed(2) +
    " â‚¬</strong>";
}

  if (driverCompletedCountEl) {
    driverCompletedCountEl.innerHTML =
      t("summary_completed_orders") +
      "<br><strong>" +
      completed.length +
      "</strong>";
  }

  // 2) Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙŠÙ„ÙˆÙ…ØªØ±Ø§Øª Ù…Ù† Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©
  const totalKmAll = completed.reduce((sum, c) => {
    if (c.distance && typeof c.distance.totalKm === "number") {
      return sum + c.distance.totalKm;
    }
    return sum;
  }, 0);
  const totalKmText = totalKmAll.toFixed(2);
  const unit = t("distance_km_short");

  // 3) Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ (Ù„ØºÙŠØ± Ø§Ù„Ù…ÙˆØ¸Ù ÙÙ‚Ø·)
  const totalEarnings = completed.reduce((sum, c) => {
    if (c.cost && typeof c.cost.totalFee === "number") {
      return sum + c.cost.totalFee;
    }
    return sum + (c.deliveryFee || 0);
  }, 0);
  const earningsValue = totalEarnings.toFixed(2);

  // 4) ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©: Ù…ÙˆØ¸Ù â†’ Ø¥Ø¬Ù…Ø§Ù„ÙŠ ÙƒÙ…ØŒ ØºÙŠØ± Ù…ÙˆØ¸Ù â†’ Ø£Ø±Ø¨Ø§Ø­
  if (driverEarningsEl) {
    driverEarningsEl.style.display = "";
    if (isEmployee) {
      driverEarningsEl.innerHTML =
        t("summary_total_km") +
        "<br><strong>" +
        totalKmText +
        " " +
        unit +
        "</strong>";
    } else {
      driverEarningsEl.innerHTML =
        t("summary_earnings") +
        "<br><strong>" +
        earningsValue +
        " â‚¬</strong>";
    }
  }

  // 5) Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ ÙÙˆÙ‚ Ø§Ù„Ø®Ø±ÙŠØ·Ø©: Ù…ÙˆØ¸Ù â†’ Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§ØªØŒ ØºÙŠØ± Ù…ÙˆØ¸Ù â†’ Ø£Ø±Ø¨Ø§Ø­
  const ordersCount = (allCalls || []).length;
  if (driverEarningsFloatingEl) {
    if (isEmployee) {
      driverEarningsFloatingEl.innerHTML =
        t("summary_orders_count") +
        "<br><strong>" +
        ordersCount +
        "</strong>";
    } else {
      driverEarningsFloatingEl.innerHTML =
        t("summary_earnings") +
        "<br><strong>" +
        earningsValue +
        " â‚¬</strong>";
    }
  }

  // 6) ÙƒØ±Øª Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ù†Ø´Ø· (Ø£Ø³ÙÙ„ Ø§Ù„Ø´Ø§Ø´Ø©)
    const currentActiveCall = getCurrentActiveCall();

  // ÙƒØ±Øª Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ù†Ø´Ø· Ø£Ø³ÙÙ„ Ø§Ù„Ø´Ø§Ø´Ø©
  renderDriverCurrentOrder(currentActiveCall);

  // âœ… ØªØ­Ø¯ÙŠØ« Ø´Ø§Ø±Ø© Ø§Ù„ÙƒØ§Ø´ Ø§Ù„Ø¹Ø§Ø¦Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
  updateCashFloatingBadge(currentActiveCall);

  const currentActiveId = currentActiveCall ? currentActiveCall.id : null;

  // 7) Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ ÙƒØ¨Ø³ÙˆÙ„Ø© Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø³ÙÙ„ÙŠØ©
  if (driverBottomStatusEl) {
    if (active.length > 0) {
      driverBottomStatusEl.classList.add("hidden");
    } else {
      driverBottomStatusEl.classList.remove("hidden");
    }
  }

  // 8) ØªÙØ±ÙŠØº Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…
  if (driverActiveOrdersEl) driverActiveOrdersEl.innerHTML = "";
  if (driverCompletedOrdersEl) driverCompletedOrdersEl.innerHTML = "";

  const statusLabelTitle = t("orderCard_status");
  const addressLabelTitle = t("orderCard_address");
  const expectedCostTitle = t("orderCard_expectedCost");
  const totalDistanceTitle = t("orderCard_totalDistance");
  const finalCostTitle = t("orderCard_finalCost");

  // 9) Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© (Active)
  active.forEach((c) => {
    const card = document.createElement("div");
    const isCurrent = currentActiveId && c.id === currentActiveId;
    const isCash = isCashOrder(c);

    card.className =
      "order-card" +
      (isCurrent ? " order-card-current" : "") +
      (isCash ? " order-card-cash" : "");

    const statusLabel = escapeHtml(getStatusLabel(c.status));

    let feeValue = "â€”";
    if (c.cost && typeof c.cost.totalFee === "number") {
      feeValue = c.cost.totalFee.toFixed(2) + " â‚¬";
    } else if (c.deliveryFee != null) {
      feeValue = String(c.deliveryFee);
    }

    const feeHtml = isCash
      ? `<span class="cash-amount-highlight">${escapeHtml(feeValue)}</span>`
      : escapeHtml(feeValue);

    // Ø³Ø·Ø± Ø§Ù„ØªÙƒÙ„ÙØ© ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· Ù„ØºÙŠØ± Ø§Ù„Ù…ÙˆØ¸Ù
    const costLineActive = !isEmployee
      ? `${expectedCostTitle}: ${feeHtml}<br/>`
      : "";

    card.innerHTML = `
      <div>
        <strong>#${c.id}</strong><br/>
        <span class="small">${statusLabelTitle}: ${statusLabel}</span><br/>
        ${addressLabelTitle}: ${escapeHtml(c.deliveryAddress || "-")}<br/>
        ${costLineActive}
      </div>
    `;

    if (driverActiveOrdersEl) {
      driverActiveOrdersEl.appendChild(card);
    }

    card.addEventListener("click", () => {
      viewDriverCallDetails(c.id);
    });
  });

  // 10) Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© (Completed)
  completed.forEach((c) => {
    const card = document.createElement("div");
    const isCash = isCashOrder(c);
    card.className = "order-card" + (isCash ? " order-card-cash" : "");

    const statusLabel = escapeHtml(getStatusLabel(c.status));

    const totalKmLabel =
      c.distance && typeof c.distance.totalKm === "number"
        ? c.distance.totalKm.toFixed(2) + " " + unit
        : "â€”";

    let feeValue = "â€”";
    if (c.cost && typeof c.cost.totalFee === "number") {
      feeValue = c.cost.totalFee.toFixed(2) + " â‚¬";
    } else if (c.deliveryFee != null) {
      feeValue = String(c.deliveryFee);
    }

    const feeHtml = isCash
      ? `<span class="cash-amount-highlight">${escapeHtml(feeValue)}</span>`
      : escapeHtml(feeValue);

    // Ø³Ø·Ø± Ø§Ù„ØªÙƒÙ„ÙØ© ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· Ù„ØºÙŠØ± Ø§Ù„Ù…ÙˆØ¸Ù
    const costLineCompleted = !isEmployee
      ? `${finalCostTitle}: ${feeHtml}<br/>`
      : "";

    card.innerHTML = `
      <div>
        <strong>#${c.id}</strong><br/>
        <span class="small">${statusLabelTitle}: ${statusLabel}</span><br/>
        ${addressLabelTitle}: ${escapeHtml(c.deliveryAddress || "-")}<br/>
        ${totalDistanceTitle}: ${totalKmLabel}<br/>
        ${costLineCompleted}
      </div>
    `;

    if (driverCompletedOrdersEl) {
      driverCompletedOrdersEl.appendChild(card);
    }

    card.addEventListener("click", () => {
      viewDriverCallDetails(c.id);
    });
  });

  // 11) Ù†Øµ Ø§Ù„ÙƒØ¨Ø³ÙˆÙ„Ø© Ø§Ù„Ø³ÙÙ„ÙŠØ© (ÙƒÙ…Ø§ ÙƒØ§Ù†ØŒ ÙÙ‚Ø· ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ ÙˆØ§Ù„Ø·Ù„Ø¨Ø§Øª)
  if (driverStatusTextEl) {
    if (driverApprovalStatus !== "approved") {
      driverStatusTextEl.textContent = t("driver_not_approved_hint");
    } else if (active.length > 0) {
      if (active.length === 1) {
        driverStatusTextEl.textContent = t("status_active_one");
      } else {
        driverStatusTextEl.textContent = t("status_active_many").replace(
          "{count}",
          active.length
        );
      }
    } else {
      driverStatusTextEl.textContent = driverCurrentOnline
        ? t("status_hint_online")
        : t("status_hint_offline");
    }
  }
}
function showActiveOrdersSwitcher() {
  if (!modalContent || !modalBackdrop) return;

  const active = (lastDriverCalls || []).filter((c) => {
    const s = (c.status || "pending").toLowerCase();
    return !(
      s === "delivered" ||
      s === "cancelled" ||
      s === "rejected"
    );
  });

  const current = getCurrentActiveCall();
  const currentId = current ? current.id : null;

  let html = `<div><strong>${t("activeSwitcher_title")}</strong></div>`;

  if (!active.length) {
    html += `
      <div class="small" style="margin-top:8px;">
        ${t("activeSwitcher_empty")}
      </div>
    `;
  } else {
    html += `
      <div class="small" style="margin-top:8px;">
        ${t("activeSwitcher_hint")}
      </div>
      <div class="active-switcher-list">
    `;

    active.forEach((c) => {
      const isCurrent = currentId && c.id === currentId;
      const statusLabel = escapeHtml(getStatusLabel(c.status));
      const isCash = isCashOrder(c);

      const classes = [
        "active-switcher-card",
        isCurrent ? "active-switcher-card-current" : "",
        isCash ? "active-switcher-card-cash" : ""
      ].filter(Boolean).join(" ");

      html += `
        <div class="${classes}" data-call-id="${escapeHtml(c.id)}">
          <div class="asc-header">
            <strong>#${escapeHtml(c.id)}</strong>
            <span class="asc-status">${statusLabel}</span>
          </div>
          <div class="asc-merchant">
            ${escapeHtml(c.merchantName || "")}
          </div>
          <div class="asc-address small">
            ${escapeHtml(c.deliveryAddress || "-")}
          </div>
        </div>
      `;
    });

    html += `</div>`;
  }

  html += `
    <div class="btn-row" style="margin-top:12px;">
      <button class="secondary" onclick="closeOrderModal()">
        ${t("orderDetails_closeBtn")}
      </button>
    </div>
  `;

  modalContent.innerHTML = html;
  if (orderModalEl) orderModalEl.classList.remove("hidden");
  modalBackdrop.style.display = "flex";
  window.scrollTo(0, 0);

  // Ø±Ø¨Ø· Ø¶ØºØ· Ø§Ù„ÙƒØ±ÙˆØª Ø¨ØªØºÙŠÙŠØ± Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø­Ø§Ù„ÙŠ
  const cards = modalContent.querySelectorAll(".active-switcher-card");
  cards.forEach((cardEl) => {
    cardEl.addEventListener("click", () => {
      const id = cardEl.getAttribute("data-call-id");
      if (!id) return;

      // ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙŠØ¯ÙˆÙŠ
      driverSelectedActiveCallId = id;

      // Ø¥Ø¹Ø§Ø¯Ø© Ø±Ø³Ù… Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©: ÙƒØ±Øª Ø§Ù„Ø·Ù„Ø¨ + Ù‚ÙˆØ§Ø¦Ù… + Ø²Ø± Ø§Ù„Ø¨Ø§Ø¯Ø¬
      renderDriverOrders(lastDriverCalls || []);

      // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
      closeOrderModal();
    });
  });
}

/* ========== ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ (Ù…Ù† calls) Ù„Ù„Ø³Ø§Ø¦Ù‚ ========== */
window.viewDriverCallDetails = async function (callId) {
  if (!driverUid) {
    alert(t("alert_currentDriverNotSet"));
    return;
  }

  const isEmployee =
    currentDriverData && currentDriverData.driverType === "employee";

  try {
    const doc = await db
      .collection("drivers")
      .doc(driverUid)
      .collection("calls")
      .doc(callId)
      .get();

    if (!doc.exists) {
      alert(t("alert_orderNotInDriverLog"));
      return;
    }

    const o = { id: doc.id, ...doc.data() };
    const statusLabel = getStatusLabel(o.status);
    const distanceUnit = t("distance_km_short");

    let html = `<div><strong>${t("orderDetails_title")} #${escapeHtml(o.id)}</strong></div>`;
    html += `<div class="small">${t("orderDetails_status")}: ${escapeHtml(statusLabel)}</div>`;

    if (o.createdAt && o.createdAt.toDate) {
      html += `<div class="small">${t("orderDetails_createdAt")}: ${formatDate(o.createdAt.toDate())}</div>`;
    }
    if (o.startedAt && o.startedAt.toDate) {
      html += `<div class="small">${t("orderDetails_startedAt")}: ${formatDate(o.startedAt.toDate())}</div>`;
    }
    if (o.deliveredAt && o.deliveredAt.toDate) {
      html += `<div class="small">${t("orderDetails_deliveredAt")}: ${formatDate(o.deliveredAt.toDate())}</div>`;
    }

const distanceLabel =
      o.distance && typeof o.distance.totalKm === "number"
        ? o.distance.totalKm.toFixed(2) + " " + distanceUnit
        : "â€”";

    let feeLabel = "â€”";
    if (o.cost && typeof o.cost.totalFee === "number") {
      feeLabel = o.cost.totalFee.toFixed(2) + " â‚¬";
    } else if (o.deliveryFee != null) {
      feeLabel = escapeHtml(o.deliveryFee) + "";
    }
// âœ… Ø¬Ø¯ÙŠØ¯: ØªØ¬Ù‡ÙŠØ² orderPrice Ù„Ù„Ø¹Ø±Ø¶ ÙÙŠ Ø§Ù„ØªÙØ§ØµÙŠÙ„
    const orderPriceStr =
      typeof o.orderPrice === "number"
        ? o.orderPrice.toFixed(2) + " â‚¬"
        : ""; // âœ… Ø¬Ø¯ÙŠØ¯

    // âœ… Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒØ§Ø´ Ù„Ø¹Ø±Ø¶Ù‡Ø§
    const paymentTypeLabel = getPaymentTypeLabel(o);
    const cashAmountStr = formatCashAmount(o);

    html += `<div style="margin-top:8px;">`;
    html += `<div>${t("orderDetails_merchant")}: ${escapeHtml(o.merchantName || "-")} (${escapeHtml(o.merchantCity || "-")})</div>`;
    html += `<div>${t("orderDetails_customerName")}: ${escapeHtml(o.customerName || "-")}</div>`;
    html += `<div>${t("orderDetails_address")}: ${escapeHtml(o.deliveryAddress || "-")}</div>`;

    if (paymentTypeLabel) {
      html += `<div>${t("orderDetails_paymentType")}: ${escapeHtml(paymentTypeLabel)}</div>`;
    }
  if (cashAmountStr) {
    html += `<div class="small">${t("orderDetails_cashAmount")}: <span class="cash-amount-highlight">${escapeHtml(cashAmountStr)}</span></div>`;
  }
// âœ… Ø¬Ø¯ÙŠØ¯: Ø¹Ø±Ø¶ Ù‚ÙŠÙ…Ø© orderPrice ÙÙŠ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨
    if (orderPriceStr) {
      html += `<div>${t("orderDetails_orderPrice")}: ${escapeHtml(orderPriceStr)}</div>`;
    }
    html += `<div>${t("orderDetails_totalDistance")}: ${distanceLabel}</div>`;
    // Ø³Ø·Ø± ØªÙƒÙ„ÙØ© Ø§Ù„ØªÙˆØµÙŠÙ„ ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· Ù„ØºÙŠØ± Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
    if (!isEmployee) {
      html += `<div>${t("orderDetails_deliveryCost")}: ${feeLabel}</div>`;
    }
    html += `<div>${t("orderDetails_notes")}: ${escapeHtml(o.notes || "-")}</div>`;
    html += `</div>`;

    html += `<div class="btn-row">`;
    html += `<button class="secondary" onclick="closeOrderModal()">${t("orderDetails_closeBtn")}</button>`;
    html += `</div>`;

    modalContent.innerHTML = html;
    if (orderModalEl) orderModalEl.classList.remove("hidden");
    modalBackdrop.style.display = "flex";
    window.scrollTo(0, 0);
  } catch (err) {
    alert(t("alert_readOrderDetailsError") + err.message);
  }
};

/* ========== Ù†Ø¯Ø§Ø¡ Ø¬Ø¯ÙŠØ¯ ÙŠØµÙ„ Ù„Ù„Ø³Ø§Ø¦Ù‚ ========== */
function showCallModalForDriver(call) {
  const when =
    call.createdAt && call.createdAt.toDate
      ? formatDate(call.createdAt.toDate())
      : "";

  const paymentTypeLabel = getPaymentTypeLabel(call);
  const cashAmountStr = formatCashAmount(call);

  let html = `
    <div><strong>${t("newCall_title")}</strong></div>
    <div class="small">${t("newCall_merchant")}: ${escapeHtml(call.merchantName || "")}</div>
    <div class="small">${t("newCall_city")}: ${escapeHtml(call.merchantCity || "")}</div>
    <div class="small">${t("newCall_time")}: ${when}</div>
  `;

  if (paymentTypeLabel) {
    html += `<div class="small">${t("orderDetails_paymentType")}: ${escapeHtml(paymentTypeLabel)}</div>`;
  }
    if (cashAmountStr) {
    html += `<div class="small">${t("orderDetails_cashAmount")}: <span class="cash-amount-highlight">${escapeHtml(cashAmountStr)}</span></div>`;
  }


  html += `
    <div style="margin-top:10px;">${t("newCall_question")}</div>
    <div class="btn-row">
      <button id="acceptCallBtn">${t("newCall_btn_accept")}</button>
      <button id="rejectCallBtn" class="secondary">${t("newCall_btn_reject")}</button>
    </div>
  `;

  modalContent.innerHTML = html;
  if (orderModalEl) orderModalEl.classList.remove("hidden");
  modalBackdrop.style.display = "flex";
  window.scrollTo(0, 0);

  const acceptBtn = document.getElementById("acceptCallBtn");
  const rejectBtn = document.getElementById("rejectCallBtn");

  if (acceptBtn) {
  acceptBtn.onclick = async () => {
    try {
      const driverId = driverUid || call.driverId;
      if (!driverId) {
        alert(t("alert_cannotAcceptCallNoDriver"));
        return;
      }

      const driverRef = db.collection("drivers").doc(driverId);
      const driverCallRef = driverRef.collection("calls").doc(call.id);

      const driverPricing = currentDriverData || {};
// Ø§Ù„Ø´Ø±Ø· Ø§Ù„ÙˆØ­ÙŠØ¯: Ù…Ø§ ØªÙ… Ø­ÙØ¸Ù‡ ÙÙŠ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø³Ø§Ø¦Ù‚
const pricingMode = driverPricing.pricingMode || "per_km";

const pricing = {
  pricingMode: pricingMode,

  // Ø¹Ù†Ø¯ Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„Ø´Ø±ÙƒØ© (independent_tiered) Ù„Ø§ Ù†Ø³ØªØ®Ø¯Ù… baseFee Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹
  baseFee: pricingMode === "per_km" ? BASE_DELIVERY_FEE : 0,

  pricePerKmDelivery:
    typeof driverPricing.pricePerKmDelivery === "number"
      ? driverPricing.pricePerKmDelivery
      : null,
  includeToMerchantSegment: !!driverPricing.includeToMerchantSegment,
  useSamePriceForBoth: driverPricing.useSamePriceForBoth !== false,
  pricePerKmToMerchant:
    typeof driverPricing.pricePerKmToMerchant === "number"
      ? driverPricing.pricePerKmToMerchant
      : null,
  freeKm:
    typeof driverPricing.freeKm === "number"
      ? driverPricing.freeKm
      : 0
};

      // âœ… ØªØ¬Ù‡ÙŠØ² Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒØ§Ø´
      const orderPrice =
        typeof call.orderPrice === "number" ? call.orderPrice : null;

      const paymentType =
        call.paymentType ||
        (call.collectCash ? "cash" : "online");

      const cashAmount =
        typeof call.cashAmount === "number"
          ? call.cashAmount
          : (call.collectCash && orderPrice != null ? orderPrice : null);

      const driverCallData = {
        merchantId: call.merchantId,
        merchantName: call.merchantName || "",
        merchantCity: call.merchantCity || "",
        merchantLat: call.merchantLat || null,
        merchantLng: call.merchantLng || null,
        driverId: driverId,
        driverFirstName: call.driverFirstName || "",
        driverLastName: call.driverLastName || "",
        driverPhone: call.driverPhone || "",
        status: "accepted",
        createdAt:
          call.createdAt || firebase.firestore.FieldValue.serverTimestamp(),
        respondedAt: firebase.firestore.FieldValue.serverTimestamp(),
        merchantCallPath: call.ref.path,

        // âœ… Ù‡Ù†Ø§ Ù†Ø¶ÙŠÙ Ø­Ù‚ÙˆÙ„ Ø§Ù„ÙƒØ§Ø´ ÙÙŠ ÙˆØ«ÙŠÙ‚Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚
        orderPrice: orderPrice,
        collectCash: !!call.collectCash,
        paymentType: paymentType,
        cashAmount: cashAmount,

        deliveryFee: call.deliveryFee || 0,
        customerName: call.customerName || "",
        deliveryAddress: call.deliveryAddress || "",
        notes: call.notes || "",
        orderValue:
          typeof call.orderValue === "number" ? call.orderValue : null,
        pricing: pricing
      };


      // Ø¥Ù†Ø´Ø§Ø¡/ØªØ­Ø¯ÙŠØ« Ù†Ø¯Ø§Ø¡ Ø§Ù„Ø³Ø§Ø¦Ù‚
      await driverCallRef.set(driverCallData, { merge: true });

      // ØªØ­Ø¯ÙŠØ« Ù†Ø¯Ø§Ø¡ Ø§Ù„Ù…Ø·Ø¹Ù…
      await call.ref.update({
        status: "accepted",
        respondedAt: firebase.firestore.FieldValue.serverTimestamp(),
        pricing: pricing
      });

      await driverRef.update({
        busy: true
      });

      // ØªÙ… Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø§Ù„Ù†Ø¯Ø§Ø¡ (Ù‚Ø¨ÙˆÙ„) â†’ Ø¥ÙŠÙ‚Ø§Ù ØµÙˆØª Ø§Ù„Ø±Ù†ÙŠÙ†
      stopNewCallSoundLoop(call.id);

      // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
      closeOrderModal();

      // âœ… Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ù‚Ø¨ÙˆÙ„ Ù†Ø¨Ø¯Ø£ Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ "Ø§Ù„ØªÙˆØ¬Ù‡ Ø¥Ù„Ù‰ Ø§Ù„ØªØ§Ø¬Ø±"
      if (window.driverStartCall) {
        window.driverStartCall(call.id);
      }
    } catch (err) {
      alert(t("alert_acceptCallError") + err.message);
    }
  };
}

  if (rejectBtn) {
    rejectBtn.onclick = async () => {
      try {
        await call.ref.update({
          status: "rejected",
          respondedAt: firebase.firestore.FieldValue.serverTimestamp()
        });

                     if (driverUid) {
        await recomputeDriverBusyFlag();
      }

        // âœ… ØªÙ… Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø§Ù„Ù†Ø¯Ø§Ø¡ (Ø±ÙØ¶) -> Ø£ÙˆÙ‚Ù ØªÙƒØ±Ø§Ø± Ø§Ù„ØµÙˆØª
        stopNewCallSoundLoop(call.id);

        closeOrderModal();

      } catch (err) {
        alert(t("alert_rejectCallError") + err.message);
      }
    };
  }
}

/* ========== Ø£Ø²Ø±Ø§Ø± Ø£ÙƒØ´Ù† Ø§Ù„Ø³Ø§Ø¦Ù‚ (start / complete / cancel) ========== */
window.driverStartCall = function (callId) {
  const useCallAndStart = (call) => {
    if (!navigator.geolocation) {
      alert(t("alert_geo_not_supported"));
      return;
    }

    const geoOptions = {
      enableHighAccuracy: true,
      timeout: 20000,
      maximumAge: 5000
    };

    navigator.geolocation.getCurrentPosition(
      async function (position) {
        const lat = position.coords.latitude;
        const lng = position.coords.longitude;

        try {
          // ØªØ³Ø¬ÙŠÙ„ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…Ø´ÙˆØ§Ø± ÙˆÙ†Ù‚Ø·Ø© Ø§Ù„Ø§Ù†Ø·Ù„Ø§Ù‚
          await updateDriverCallAndMerchant(callId, {
            status: "in_progress",
            driverStartLat: lat,
            driverStartLng: lng,
            startedAt: firebase.firestore.FieldValue.serverTimestamp()
          });

          if (driverUid) {
            await db.collection("drivers").doc(driverUid).update({
              busy: true
            });
          }

          // ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ù…Ø³Ø§Ø± ÙˆØ§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ø­ÙŠ Ø¨Ø§ØªØ¬Ø§Ù‡ Ø§Ù„ØªØ§Ø¬Ø±
          if (call.merchantLat != null && call.merchantLng != null) {
            navigationMode = "merchant";

            showDriverRouteToMerchant(
              lat,
              lng,
              call.merchantLat,
              call.merchantLng
            );
            startGuidance(call.merchantLat, call.merchantLng);
          }

          // Ø·ÙŠÙ‘ ÙƒØ±Øª Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ù†Ø´Ø· Ø¨Ø¹Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„Ø±Ø­Ù„Ø©
          if (window.toggleCurrentOrderPanel) {
            toggleCurrentOrderPanel(true);
          }

          alert(t("alert_driverStartSuccess"));
        } catch (err) {
          alert(t("alert_driverStartError") + err.message);
        }
      },
      function (err) {
        alert(t("alert_geo_failed_prefix") + err.message);
      },
      geoOptions
    );
  };

  // Ù†Ø­Ø§ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹ Ù…Ù† Ø§Ù„ÙƒØ§Ø´
  let call = driverCallsCache.find(function (c) {
    return c.id === callId;
  });

  if (call) {
    useCallAndStart(call);
    return;
  }

  // Ù„Ùˆ Ù…Ø´ Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„ÙƒØ§Ø´ØŒ Ù†Ù‚Ø±Ø£Ù‡ Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ù† Firestore
  if (!driverUid) {
    alert(t("alert_currentDriverNotSet"));
    return;
  }

  db.collection("drivers")
    .doc(driverUid)
    .collection("calls")
    .doc(callId)
    .get()
    .then((doc) => {
      if (!doc.exists) {
        alert(t("alert_orderNotFound"));
        return;
      }
      const fetchedCall = { id: doc.id, ...doc.data() };
      useCallAndStart(fetchedCall);
    })
    .catch((err) => {
      alert(t("alert_readOrderDetailsError") + err.message);
    });
};

window.driverCompleteCall = function (callId) {
  const call = driverCallsCache.find(function (c) {
    return c.id === callId;
  });
  if (!call) {
    alert(t("alert_orderNotFound"));
    return;
  }

  if (!navigator.geolocation) {
    alert(t("alert_geo_not_supported"));
    return;
  }

  const geoOptions = {
    enableHighAccuracy: true,
    timeout: 20000,
    maximumAge: 5000
  };

  navigator.geolocation.getCurrentPosition(
    async function (position) {
      const dropLat = position.coords.latitude;
      const dropLng = position.coords.longitude;

      try {
        const driverPricing = call.pricing || currentDriverData || {};
        const pricingMode = driverPricing.pricingMode || "per_km";

        const includeToMerchantSegment =
          !!driverPricing.includeToMerchantSegment;
        const useSamePriceForBoth =
          driverPricing.useSamePriceForBoth !== false;

        const pricePerKmDelivery =
          typeof driverPricing.pricePerKmDelivery === "number"
            ? driverPricing.pricePerKmDelivery
            : 0;

        let pricePerKmToMerchant =
          typeof driverPricing.pricePerKmToMerchant === "number"
            ? driverPricing.pricePerKmToMerchant
            : null;

        if (
          includeToMerchantSegment &&
          (pricePerKmToMerchant == null || useSamePriceForBoth)
        ) {
          pricePerKmToMerchant = pricePerKmDelivery;
        }

        const freeKm =
          typeof driverPricing.freeKm === "number"
            ? driverPricing.freeKm
            : 0;

        // ============================
        // 1) Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§ÙØ§Øª Ù„Ù„ØªØ®Ø²ÙŠÙ†
        // ============================
        let d1Storage = 0; // driver -> merchant (ÙŠÙØ®Ø²Ù‘ÙÙ† Ø¯Ø§Ø¦Ù…Ø§Ù‹)
        let d2 = 0;        // merchant -> dropoff (ÙŠÙØ³ØªØ®Ø¯Ù… ÙÙŠ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø©)

        if (call.merchantLat != null && call.merchantLng != null) {
          // Ù…Ø³Ø§ÙØ© Ø§Ù„Ø³Ø§Ø¦Ù‚ Ù…Ù† Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø¥Ù„Ù‰ Ø§Ù„ØªØ§Ø¬Ø±
          if (call.driverStartLat != null && call.driverStartLng != null) {
            d1Storage = await getRouteDistanceKm(
              { lat: call.driverStartLat, lng: call.driverStartLng },
              { lat: call.merchantLat, lng: call.merchantLng }
            );
          }

          // Ù…Ø³Ø§ÙØ© Ø§Ù„ØªØ§Ø¬Ø± â†’ Ø§Ù„Ø¹Ù…ÙŠÙ„
          d2 = await getRouteDistanceKm(
            { lat: call.merchantLat, lng: call.merchantLng },
            { lat: dropLat, lng: dropLng }
          );
        }

        const totalKmStorage = d1Storage + d2;

        // ============================
        // 2) Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙƒÙ„ÙØ© Ø­Ø³Ø¨ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ³Ø¹ÙŠØ±
        // ============================
        let totalFee = 0;
        let baseFeeUsed = 0;
        let distanceFee = 0;
        let freeKmUsed = 0;
        let perKmEffective = 0;

        if (pricingMode === "independent_tiered") {
  // âœ… Ù†Ù…ÙˆØ°Ø¬ ØªØ³Ø¹ÙŠØ±Ø© Taussil:
  // - GrundgebÃ¼hr:
  //    * Bestellwert â‰¤ 25 â‚¬ â†’ 3,50 â‚¬
  //    * Bestellwert > 25 â‚¬ â†’ 14 % vom Bestellwert
  // - Ù…Ø³Ø§ÙØ© Ø§Ù„ØªØ³Ø¹ÙŠØ±: Ø§Ù„Ù…ØªØ¬Ø± â†’ Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙÙ‚Ø· (d2)
  //   * 0â€“7 km â†’ 0,50 â‚¬/km
  //   * 7â€“12 km â†’ 0,80 â‚¬/km
  //   * >12 km â†’ 1,00 â‚¬/km

  // Ù†Ø³ØªØ®Ø¯Ù… orderPrice (Ø³Ø¹Ø± Ø§Ù„Ø·Ù„Ø¨) Ø£ÙˆÙ„Ø§Ù‹ØŒ ÙˆÙ†Ø±Ø¬Ø¹ Ù„Ù€ orderValue Ø¹Ù†Ø¯ Ø§Ù„Ù„Ø²ÙˆÙ… ÙÙ‚Ø·
  const orderAmount =
    typeof call.orderPrice === "number"
      ? call.orderPrice
      : typeof call.orderValue === "number"
        ? call.orderValue
        : 0;

  if (orderAmount <= 25) {
    baseFeeUsed = 3.5;
  } else {
    baseFeeUsed = orderAmount * 0.14;
  }

  // Ù…Ø³Ø§ÙØ© Ø§Ù„ØªØ³Ø¹ÙŠØ± Ù‡ÙŠ Ø§Ù„Ù…ØªØ¬Ø± â†’ Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙÙ‚Ø·
  const kmForPricing = d2;

  // ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¹Ù„Ù‰ Ø§Ù„Ø«Ù„Ø§Ø« Ø´Ø±Ø§Ø¦Ø­
  const tier1Km = Math.min(kmForPricing, 7);                    // 0â€“7 km
  const tier2Km = Math.max(Math.min(kmForPricing, 12) - 7, 0);  // 7â€“12 km
  const tier3Km = Math.max(kmForPricing - 12, 0);               // > 12 km

  const tier1Cost = tier1Km * 0.5;
  const tier2Cost = tier2Km * 0.8;
  const tier3Cost = tier3Km * 1.0;

  distanceFee = tier1Cost + tier2Cost + tier3Cost;

  // Ù…ØªÙˆØ³Ø· Ù„ÙƒÙ„ ÙƒÙ… Ù„Ùˆ Ø­Ø§Ø¨ ØªØ¹Ø±Ø¶Ù‡ ÙÙŠ Ø§Ù„ØªÙØ§ØµÙŠÙ„ ÙÙ‚Ø·
  perKmEffective = kmForPricing > 0 ? distanceFee / kmForPricing : 0;

  totalFee = baseFeeUsed + distanceFee;
  freeKmUsed = 0; // Ù„Ø§ ÙŠÙˆØ¬Ø¯ freeKm ÙÙŠ ØªØ³Ø¹ÙŠØ±Ø© Taussil


        } else {
          // ğŸ” Ù†Ù…ÙˆØ°Ø¬ per_km Ø§Ù„Ù‚Ø¯ÙŠÙ… ÙƒÙ…Ø§ ÙƒØ§Ù†
          const baseFee =
            typeof driverPricing.baseFee === "number"
              ? driverPricing.baseFee
              : BASE_DELIVERY_FEE;

          const d1Cost = includeToMerchantSegment ? d1Storage : 0;
          const d2Cost = d2;

          let rawDistanceFee =
            d1Cost * (pricePerKmToMerchant || 0) +
            d2Cost * pricePerKmDelivery;

          distanceFee = rawDistanceFee;
          freeKmUsed = 0;

          if (freeKm > 0 && (d1Cost + d2Cost) > 0 && rawDistanceFee > 0) {
            freeKmUsed = Math.min(freeKm, (d1Cost + d2Cost));
            const avgPerKm = rawDistanceFee / (d1Cost + d2Cost);
            const discount = freeKmUsed * avgPerKm;
            distanceFee = Math.max(rawDistanceFee - discount, 0);
          }

          baseFeeUsed = baseFee;
          totalFee = baseFeeUsed + distanceFee;
          perKmEffective = 0; // ØºÙŠØ± Ù…Ù‡Ù… ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        }

        // ============================
        // 3) ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Firestore
        // ============================
        const patch = {
          status: "delivered",
          dropoffLat: dropLat,
          dropoffLng: dropLng,
          deliveredAt: firebase.firestore.FieldValue.serverTimestamp(),
          deliveryFee: totalFee,
          distance: {
            driverToMerchantKm: d1Storage,
            merchantToDropoffKm: d2,
            totalKm: totalKmStorage,
            freeKmUsed: freeKmUsed
          },
          cost: {
            pricingMode: pricingMode,
            baseFee: baseFeeUsed,
            distanceFee: distanceFee,
            totalFee: totalFee,
            perKmDriverToMerchant:
              pricingMode === "per_km"
                ? (pricePerKmToMerchant || 0)
                : 0,
            perKmMerchantToDropoff:
              pricingMode === "per_km"
                ? pricePerKmDelivery
                : perKmEffective,
            freeKm: pricingMode === "per_km" ? freeKm : 0
          }
        };

        await updateDriverCallAndMerchant(callId, patch);

        if (driverUid) {
          await recomputeDriverBusyFlag();
        }
        // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø®Ø±ÙŠØ·Ø© ÙˆØ§Ù„ØªÙˆØ¬ÙŠÙ‡
        clearRouteAndNavigation();

        // Ø·ÙŠÙ‘ ÙƒØ±Øª Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ù†Ø´Ø·
        if (window.toggleCurrentOrderPanel) {
          toggleCurrentOrderPanel(true);
        }

        alert(t("alert_completeDeliverySuccess"));
      } catch (err) {
        alert(t("alert_completeDeliveryError") + err.message);
      }
    },
    function (err) {
      alert(t("alert_geo_failed_prefix") + err.message);
    },
    geoOptions
  );
};
// âœ… Ø¬Ø¯ÙŠØ¯: ØªÙ…ÙƒÙŠÙ† Ø§Ù„Ø³Ø§Ø¦Ù‚ Ù…Ù† ØªØ¹Ø¯ÙŠÙ„ Ù‚ÙŠÙ…Ø© orderPrice Ù…Ù† Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ù†Ø´Ø·
window.driverEditOrderPrice = async function (callId) {
  const call = driverCallsCache.find(function (c) {
    return c.id === callId;
  });

  if (!call) {
    alert(t("alert_orderNotFound"));
    return;
  }

  // âœ… Ø¬Ø¯ÙŠØ¯: Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙƒÙ†Øµ Ø§ÙØªØ±Ø§Ø¶ÙŠ
  const currentValue =
    typeof call.orderPrice === "number"
      ? call.orderPrice.toFixed(2)
      : "";

  // âœ… Ø¬Ø¯ÙŠØ¯: Ø·Ù„Ø¨ Ù‚ÙŠÙ…Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù…Ù† Ø§Ù„Ø³Ø§Ø¦Ù‚
  const input = prompt(
    t("prompt_editOrderPrice") || "Neue Bestellsumme (in â‚¬):", // âœ… Ø¬Ø¯ÙŠØ¯
    currentValue
  );
  if (input === null) return; // Ø¥Ù„ØºØ§Ø¡ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…

  const normalized = input.replace(",", ".").trim(); // âœ… Ø¬Ø¯ÙŠØ¯
  const newVal = parseFloat(normalized);             // âœ… Ø¬Ø¯ÙŠØ¯

  if (isNaN(newVal) || newVal < 0) {
    alert(t("alert_invalid_orderPrice") || "UngÃ¼ltiger Betrag."); // âœ… Ø¬Ø¯ÙŠØ¯
    return;
  }

  const patch = {
    orderPrice: newVal // âœ… Ø¬Ø¯ÙŠØ¯
  };

  // âœ… Ø¬Ø¯ÙŠØ¯: Ù„Ùˆ Ø§Ù„Ø·Ù„Ø¨ ÙƒØ§Ø´ØŒ Ù†Ø®Ù„ÙŠ cashAmount ÙŠØ³Ø§ÙˆÙŠ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ù…Ø¹Ø¯Ù‘ÙÙ„Ø©
  if (isCashOrder(call)) {
    patch.cashAmount = newVal;
  }

  try {
    await updateDriverCallAndMerchant(callId, patch); // âœ… Ø¬Ø¯ÙŠØ¯
    alert(t("alert_orderPriceUpdated") || "Order price updated."); // âœ… Ø¬Ø¯ÙŠØ¯
  } catch (err) {
    alert(t("alert_call_update_failed") + err.message);
  }
};

window.driverCancelCall = async function (callId) {
  if (!confirm(t("confirm_cancel_order"))) return;


    try {
    await updateDriverCallAndMerchant(callId, {
      status: "cancelled",
      cancelledBy: "driver",
      cancelledAt: firebase.firestore.FieldValue.serverTimestamp()
    });

        if (driverUid) {
      await recomputeDriverBusyFlag();
    }

        // ØªÙ†Ø¸ÙŠÙ ÙƒØ§Ù…Ù„ Ù„Ù…Ø³Ø§Ø± Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ ÙˆØ£ÙŠ Ù†Ù‚Ø§Ø· Ø¹Ù…ÙŠÙ„/ØªØ§Ø¬Ø±
    clearRouteAndNavigation();

    // Ø·ÙŠÙ‘ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø·Ù„Ø¨ (Ø³ÙŠØªÙ… Ø¥Ø®ÙØ§Ø¤Ù‡Ø§ Ø¨Ø¹Ø¯ ØªØ­Ø¯ÙŠØ« snapshot)
    if (window.toggleCurrentOrderPanel) {
      toggleCurrentOrderPanel(true);
    }

  } catch (err) {
    alert(t("alert_call_update_failed") + err.message);

  }
};

/* ========== Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ ========== */
function closeOrderModal() {
  modalBackdrop.style.display = "none";
  modalContent.innerHTML = "";
  if (orderModalEl) orderModalEl.classList.add("hidden");
}

// ========== Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù„ØºØ© (ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ + Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©) ==========
const langSelect = document.getElementById("langSelect");        // Ø¯Ø§Ø®Ù„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©
const authLangSelect = document.getElementById("authLangSelect"); // ÙÙŠ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„

function handleLanguageChange(lang) {
  const finalLang = ["en", "de", "ar","tr"].includes(lang) ? lang : "en";

  try {
    localStorage.setItem("driverLang", finalLang);
  } catch (e) {}

  if (langSelect) langSelect.value = finalLang;
  if (authLangSelect) authLangSelect.value = finalLang;

  applyTranslations(finalLang);
}

if (langSelect) {
  langSelect.addEventListener("change", (e) => {
    handleLanguageChange(e.target.value || "en");
  });
}

if (authLangSelect) {
  authLangSelect.addEventListener("change", (e) => {
    handleLanguageChange(e.target.value || "en");
  });
}

// ØªØ´ØºÙŠÙ„ Ø§Ù„Ù„ØºØ© Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
(function initLanguage() {
  let saved = null;
  try {
    saved = localStorage.getItem("driverLang");
  } catch (err) {}

  if (!saved) {
    const browserLang = (navigator.language || "en")
      .slice(0, 2)
      .toLowerCase();
    saved = ["en", "de", "ar","tr"].includes(browserLang) ? browserLang : "en";
  }

  handleLanguageChange(saved || "en");
})();
// ÙØªØ­/Ø¥ØºÙ„Ø§Ù‚ Ø£Ø²Ø±Ø§Ø± manual / scan Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ©
if (driverExtraOrdersBtn) {
  driverExtraOrdersBtn.addEventListener("click", () => {
    document.body.classList.toggle("driver-extra-open");
  });
}
// Ø²Ø± Ù…Ø¨Ø¯Ù‘Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©: ÙŠÙØªØ­ Ù…Ù†Ø¨Ø«Ù‚ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø­Ø§Ù„ÙŠ
if (driverActiveSwitcherBtn) {
  driverActiveSwitcherBtn.addEventListener("click", () => {
    showActiveOrdersSwitcher();
  });
}

// Ø§Ø®ØªÙŠØ§Ø±ÙŠØ§Ù‹: Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…Ø±ÙˆØ­Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø£ÙŠ Ø²Ø± ÙØ±Ø¹ÙŠ
// ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙŠØ¯ÙˆÙŠ
if (driverExtraManualBtn) {
  driverExtraManualBtn.addEventListener("click", () => {
    document.body.classList.remove("driver-extra-open");

    if (driverExtraManualPanel) {
      driverExtraManualPanel.classList.remove("hidden");
    }

    if (driverExtraPriceInput) {
  driverExtraPriceInput.addEventListener("input", () => {
    driverExtraPriceInput.classList.remove("driver-extra-price-error");
    // Ø±Ø¬Ù‘Ø¹ Ø§Ù„Ù€ placeholder Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ Ù„Ùˆ ÙƒÙ†Øª ØªØ³ØªØ®Ø¯Ù…Ù‡
    driverExtraPriceInput.placeholder = t("extraOrders_price_placeholder");
  });
}

    if (driverExtraCashToggle) {
      driverExtraCashToggle.classList.remove("cash-on");
      driverExtraCashToggle.textContent = t("extraOrder_cash_off");
    }

    if (driverExtraConfirmBtn) {
      driverExtraConfirmBtn.textContent = t("extraOrder_confirm_btn");
    }
  });
}

// ØªØ¨Ø¯ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„ÙƒØ§Ø´ (Ø£Ø¨ÙŠØ¶ â†” Ø£Ø­Ù…Ø±)
if (driverExtraCashToggle) {
  driverExtraCashToggle.addEventListener("click", () => {
    const isOn = !driverExtraCashToggle.classList.contains("cash-on");
    driverExtraCashToggle.classList.toggle("cash-on", isOn);
    driverExtraCashToggle.textContent = isOn
      ? t("extraOrder_cash_on")
      : t("extraOrder_cash_off");

    // âœ… Ø§Ù„Ø³Ø·Ø± Ø§Ù„Ù…Ù‡Ù…: Ø±Ø¨Ø· Ø§Ù„Ø²Ø± Ø¨Ø§Ù„ÙÙ„Ø§Øº Ø§Ù„Ø°ÙŠ ÙŠØ³ØªØ®Ø¯Ù…Ù‡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©
    driverExtraIsCash = isOn;
  });
}


// Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø®Ø§Ø±Ø¬ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø£Ø¨ÙŠØ¶
if (driverExtraManualPanel) {
  driverExtraManualPanel.addEventListener("click", (e) => {
    if (e.target === driverExtraManualPanel) {
      driverExtraManualPanel.classList.add("hidden");
function closeDriverExtraManualPanel() {
  if (driverExtraManualPanel) {
    driverExtraManualPanel.classList.add("hidden");
  }
  // âœ… ÙƒÙ„ Ø¥ØºÙ„Ø§Ù‚ ÙŠØ¹ÙŠØ¯ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©
  resetDriverExtraManualForm();
}

    }
  });
}
/* ========== Clean up when leave ========== */
window.addEventListener("beforeunload", () => {
  if (driverOrdersListener) {
    driverOrdersListener();
    driverOrdersListener = null;
  }
  if (driverCallsListener) {
    driverCallsListener();
    driverCallsListener = null;
  }
  if (driverDocListener) {
    driverDocListener();
    driverDocListener = null;
  }

  // Ø­ÙØ¸ ÙˆÙ‚Øª Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¬Ù„Ø³Ø© Ø®Ù„Ø§Ù„ Ù¥ Ø¯Ù‚Ø§Ø¦Ù‚ ÙÙ‚Ø·
  if (driverUid && driverDashboard && !driverDashboard.classList.contains("hidden")) {
    try {
      localStorage.setItem("driverLastUid", driverUid);
      localStorage.setItem("driverLastClosedAt", Date.now().toString());
    } catch (e) {}
  }

  // Ø¥ÙŠÙ‚Ø§Ù ØªØªØ¨Ø¹ Ø§Ù„Ù…ÙˆÙ‚Ø¹ + ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
  stopDriverLocationTracking();
  stopMedianBackgroundLocation();   // ğŸ‘ˆ Ù‡Ù†Ø§ Ø£ÙŠØ¶Ø§Ù‹
  clearRouteAndNavigation();

  stopNewCallSoundLoop(); // Ù„Ø¥ÙŠÙ‚Ø§Ù Ø£ÙŠ ØªØ§ÙŠÙ…Ø± Ø´ØºÙ‘Ø§Ù„

  // Ù†Ø­Ø§ÙˆÙ„ ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¬Ù„Ø³Ø© (Ù‚Ø¯ Ù„Ø§ ØªÙƒØªÙ…Ù„ Ø¯Ø§Ø¦Ù…Ø§Ù‹ØŒ Ø¨Ø³ ØªØ³Ø§Ø¹Ø¯)
  releaseDriverSession();
});

</script>
</body>
</html>
